import{r as b,j as e,u as V,a as ne,c as se,g as re,P as ie}from"./index-ca62b98c.js";import{u as H,S as oe}from"./index-4c5f8c14.js";const ae=({participants:i,userId:r})=>{if(i=i.filter(u=>u._id!==r),i.length==0)return null;const c=i.length>1,y=i.slice(0,4);return e.jsx("div",{className:"card",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"group-pictures-container",children:y.map((u,l)=>e.jsx("div",{className:"profile",children:e.jsx("img",{src:u.avatar,alt:"Profile",className:"group-profile-picture"})},l))}),e.jsxs("div",{className:"profile-names",children:[y.length>0&&e.jsx("h3",{children:y.map(u=>u.fullname).join(", ")}),i.length>4&&e.jsxs("p",{className:"group-members-count",children:["+",i.length-4," more"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:i[0].avatar,alt:"Profile",className:"profile-picture"}),e.jsxs("h3",{children:[i[0].fullname+"  ",e.jsx("span",{className:i[0].isOnline?"online":"offline",children:"â€¢"})]}),i[0].bio&&e.jsx("p",{children:i[0].bio})]})})},ee=b.memo(ae);const Y=i=>new Promise((r,c)=>{fetch("/api/v1/rooms",{method:"GET",headers:{"content-type":"application/json",authorization:"Bearer "+i}}).then(y=>{if(y.ok)return y.json().then(u=>{r(u)});throw y.status==401&&(alert("Token expired"),sessionStorage.removeItem("token")),new Error("Failed to fetch rooms information")}).catch(y=>{c(y)})}),le=({userId:i,currentRoomIndex:r,token:c,onRoomChange:y,onUpdateStatus:u})=>{const[l,o]=b.useState([]),t=b.useRef(""),s=H(),v=V(),d=_=>{const w=_;"onl"+w!=t.current&&(t.current="onl"+w,o(T=>T&&T.map(g=>{const C=g.participants.map(j=>j._id===w?{...j,isOnline:!0}:j);return{...g,participants:C}})))},p=_=>{const w=_;"off"+w!=t.current&&(t.current="off"+w,o(T=>T&&T.map(g=>{const C=g.participants.map(j=>j._id===w?{...j,isOnline:!1}:j);return{...g,participants:C}})))},h=()=>{Y(c).then(_=>{o(_)}).catch(()=>{v("/auth")})},N=_=>{var T,g;const w=document.querySelectorAll(".chat-room");w==null||w.forEach(C=>{var j;(j=C.classList)==null||j.remove("active")}),(g=(T=w[_])==null?void 0:T.classList)==null||g.add("active"),y(_)};b.useEffect(()=>{l.length>0&&u(l)},[l]),b.useEffect(()=>{if(s)return s.on("onl",d),s.on("off",p),s.on("room",h),()=>{s.off("onl",d),s.off("off",p),s.off("room",h)}},[s]),b.useEffect(()=>{Y(c).then(_=>{o(_)}).catch(()=>{v("/auth")})},[]);const E=b.useMemo(()=>l.map((_,w)=>e.jsx("div",{className:`chat-room ${w==r?"active":""}`,onClick:()=>N(w),children:e.jsx(ee,{userId:i,participants:_.participants})},_._id)),[l]);return e.jsx("div",{id:"rooms-list",children:l&&l.length>0?e.jsx("div",{children:E}):e.jsx("p",{children:"No rooms to display"})})};const ce={light:{text:"#000",background:"#fff",theme:"#009688"},dark:{text:"#ffffff",background:"#000",theme:"#240063"}},ue=()=>{const[i,r]=b.useState(sessionStorage.getItem("theme")||"light");return b.useEffect(()=>{const c=ce[i];Object.entries(c).forEach(([y,u])=>{document.documentElement.style.setProperty(`--${y}-color`,u)}),sessionStorage.setItem("theme",i)},[i]),[i,r]},de=()=>{const[i,r]=ue(),c=i==="light",y=()=>{r(c?"dark":"light")};return e.jsxs("div",{className:"theme-switch-container",children:[e.jsx("input",{type:"checkbox",id:"switcher-input",checked:c,onChange:y}),e.jsxs("label",{className:`switcher-label ${c?"":"active"}`,htmlFor:"switcher-input",children:[e.jsx("i",{className:"fas fa-solid fa-sun"}),e.jsx("span",{className:"switcher-toggler"}),e.jsx("i",{className:"fas fa-solid fa-moon"})]})]})};var te={exports:{}};(function(i,r){(function(y,u){i.exports=u(b,ne)})(se,function(c,y){return function(u){var l={};function o(t){if(l[t])return l[t].exports;var s=l[t]={i:t,l:!1,exports:{}};return u[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=u,o.c=l,o.d=function(t,s,v){o.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:v})},o.r=function(t){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,s){if(s&1&&(t=o(t)),s&8||s&4&&typeof t=="object"&&t&&t.__esModule)return t;var v=Object.create(null);if(o.r(v),Object.defineProperty(v,"default",{enumerable:!0,value:t}),s&2&&typeof t!="string")for(var d in t)o.d(v,d,(function(p){return t[p]}).bind(null,d));return v},o.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(s,"a",s),s},o.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},o.p="",o(o.s=4)}([function(u,l,o){u.exports=o(5)()},function(u,l){u.exports=c},function(u,l){u.exports=y},function(u,l){u.exports=function(o,t,s){var v=o.direction,d=o.value;switch(v){case"top":return s.top+d<t.top&&s.bottom>t.bottom&&s.left<t.left&&s.right>t.right;case"left":return s.left+d<t.left&&s.bottom>t.bottom&&s.top<t.top&&s.right>t.right;case"bottom":return s.bottom-d>t.bottom&&s.left<t.left&&s.right>t.right&&s.top<t.top;case"right":return s.right-d>t.right&&s.left<t.left&&s.top<t.top&&s.bottom>t.bottom}}},function(u,l,o){o.r(l),o.d(l,"default",function(){return f});var t=o(1),s=o.n(t),v=o(2),d=o.n(v),p=o(0),h=o.n(p),N=o(3),E=o.n(N);function _(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_=function(x){return typeof x}:_=function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},_(a)}function w(a,m){if(!(a instanceof m))throw new TypeError("Cannot call a class as a function")}function T(a,m){for(var x=0;x<m.length;x++){var n=m[x];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function g(a,m,x){return m&&T(a.prototype,m),x&&T(a,x),a}function C(a,m){return m&&(_(m)==="object"||typeof m=="function")?m:P(a)}function j(a){return j=Object.setPrototypeOf?Object.getPrototypeOf:function(x){return x.__proto__||Object.getPrototypeOf(x)},j(a)}function P(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function z(a,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(m&&m.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),m&&U(a,m)}function U(a,m){return U=Object.setPrototypeOf||function(n,k){return n.__proto__=k,n},U(a,m)}function R(a,m,x){return m in a?Object.defineProperty(a,m,{value:x,enumerable:!0,configurable:!0,writable:!0}):a[m]=x,a}function W(a){return a.width===void 0&&(a.width=a.right-a.left),a.height===void 0&&(a.height=a.bottom-a.top),a}var f=function(a){z(m,a);function m(x){var n;return w(this,m),n=C(this,j(m).call(this,x)),R(P(n),"getContainer",function(){return n.props.containment||window}),R(P(n),"addEventListener",function(k,S,O,F){n.debounceCheck||(n.debounceCheck={});var L,$,M=function(){L=null,n.check()};F>-1?$=function(){L||(L=setTimeout(M,F||0))}:$=function(){clearTimeout(L),L=setTimeout(M,O||0)};var A={target:k,fn:$,getLastTimeout:function(){return L}};k.addEventListener(S,A.fn),n.debounceCheck[S]=A}),R(P(n),"startWatching",function(){n.debounceCheck||n.interval||(n.props.intervalCheck&&(n.interval=setInterval(n.check,n.props.intervalDelay)),n.props.scrollCheck&&n.addEventListener(n.getContainer(),"scroll",n.props.scrollDelay,n.props.scrollThrottle),n.props.resizeCheck&&n.addEventListener(window,"resize",n.props.resizeDelay,n.props.resizeThrottle),!n.props.delayedCall&&n.check())}),R(P(n),"stopWatching",function(){if(n.debounceCheck){for(var k in n.debounceCheck)if(n.debounceCheck.hasOwnProperty(k)){var S=n.debounceCheck[k];clearTimeout(S.getLastTimeout()),S.target.removeEventListener(k,S.fn),n.debounceCheck[k]=null}}n.debounceCheck=null,n.interval&&(n.interval=clearInterval(n.interval))}),R(P(n),"check",function(){var k=n.node,S,O;if(!k)return n.state;if(S=W(n.roundRectDown(k.getBoundingClientRect())),n.props.containment){var F=n.props.containment.getBoundingClientRect();O={top:F.top,left:F.left,bottom:F.bottom,right:F.right}}else O={top:0,left:0,bottom:window.innerHeight||document.documentElement.clientHeight,right:window.innerWidth||document.documentElement.clientWidth};var L=n.props.offset||{},$=_(L)==="object";$&&(O.top+=L.top||0,O.left+=L.left||0,O.bottom-=L.bottom||0,O.right-=L.right||0);var M={top:S.top>=O.top,left:S.left>=O.left,bottom:S.bottom<=O.bottom,right:S.right<=O.right},A=S.height>0&&S.width>0,I=A&&M.top&&M.left&&M.bottom&&M.right;if(A&&n.props.partialVisibility){var G=S.top<=O.bottom&&S.bottom>=O.top&&S.left<=O.right&&S.right>=O.left;typeof n.props.partialVisibility=="string"&&(G=M[n.props.partialVisibility]),I=n.props.minTopValue?G&&S.top<=O.bottom-n.props.minTopValue:G}typeof L.direction=="string"&&typeof L.value=="number"&&(console.warn("[notice] offset.direction and offset.value have been deprecated. They still work for now, but will be removed in next major version. Please upgrade to the new syntax: { %s: %d }",L.direction,L.value),I=E()(L,S,O));var K=n.state;return n.state.isVisible!==I&&(K={isVisible:I,visibilityRect:M},n.setState(K),n.props.onChange&&n.props.onChange(I)),K}),n.state={isVisible:null,visibilityRect:{}},n}return g(m,[{key:"componentDidMount",value:function(){this.node=d.a.findDOMNode(this),this.props.active&&this.startWatching()}},{key:"componentWillUnmount",value:function(){this.stopWatching()}},{key:"componentDidUpdate",value:function(n){this.node=d.a.findDOMNode(this),this.props.active&&!n.active?(this.setState({isVisible:null,visibilityRect:{}}),this.startWatching()):this.props.active||this.stopWatching()}},{key:"roundRectDown",value:function(n){return{top:Math.floor(n.top),left:Math.floor(n.left),bottom:Math.floor(n.bottom),right:Math.floor(n.right)}}},{key:"render",value:function(){return this.props.children instanceof Function?this.props.children({isVisible:this.state.isVisible,visibilityRect:this.state.visibilityRect}):s.a.Children.only(this.props.children)}}]),m}(s.a.Component);R(f,"defaultProps",{active:!0,partialVisibility:!1,minTopValue:0,scrollCheck:!1,scrollDelay:250,scrollThrottle:-1,resizeCheck:!1,resizeDelay:250,resizeThrottle:-1,intervalCheck:!0,intervalDelay:100,delayedCall:!1,offset:{},containment:null,children:s.a.createElement("span",null)}),R(f,"propTypes",{onChange:h.a.func,active:h.a.bool,partialVisibility:h.a.oneOfType([h.a.bool,h.a.oneOf(["top","right","bottom","left"])]),delayedCall:h.a.bool,offset:h.a.oneOfType([h.a.shape({top:h.a.number,left:h.a.number,bottom:h.a.number,right:h.a.number}),h.a.shape({direction:h.a.oneOf(["top","right","bottom","left"]),value:h.a.number})]),scrollCheck:h.a.bool,scrollDelay:h.a.number,scrollThrottle:h.a.number,resizeCheck:h.a.bool,resizeDelay:h.a.number,resizeThrottle:h.a.number,intervalCheck:h.a.bool,intervalDelay:h.a.number,containment:typeof window<"u"?h.a.instanceOf(window.Element):h.a.any,children:h.a.oneOfType([h.a.element,h.a.func]),minTopValue:h.a.number})},function(u,l,o){var t=o(6);function s(){}function v(){}v.resetWarningCache=s,u.exports=function(){function d(N,E,_,w,T,g){if(g!==t){var C=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw C.name="Invariant Violation",C}}d.isRequired=d;function p(){return d}var h={array:d,bool:d,func:d,number:d,object:d,string:d,symbol:d,any:d,arrayOf:p,element:d,elementType:d,instanceOf:p,node:d,objectOf:p,oneOf:p,oneOfType:p,shape:p,exact:p,checkPropTypes:v,resetWarningCache:s};return h.PropTypes=h,h}},function(u,l,o){var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";u.exports=t}])})})(te);var fe=te.exports;const X=re(fe),he=({content:i,timestamp:r})=>e.jsxs("div",{className:"message own",children:[e.jsx("div",{className:"message_wrapper",children:e.jsx("p",{children:i})}),e.jsx("p",{className:"message_timestamp",children:r})]}),me=({avatarSRC:i,content:r,timestamp:c})=>e.jsxs("div",{className:"message guest",children:[e.jsxs("div",{className:"message_wrapper",children:[e.jsx("img",{className:"inchat-avatar",src:i,alt:"Sender Avatar"}),e.jsx("p",{children:r})]}),e.jsx("p",{className:"message_timestamp",children:c})]});let J,q,B;const D=30,Q=(i,r,c,y)=>fetch(`/api/v1/rooms/${i}?limit=${c}&skip=${y}`,{method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer "+r}}).then(u=>{if(u.status===304)throw new Error("Already got this");if(u.ok)return u.json();throw u.status==401&&(alert("Token expired"),sessionStorage.removeItem("token")),new Error("Failed to fetch messages")}),pe=({room:i,token:r,profile:c})=>{const[y,u]=b.useState(""),[l,o]=b.useState(null),[t,s]=b.useState(),v=b.useRef(i._id),d=b.useRef(null),p=b.useRef(null),h=b.useRef(null),N=b.useRef(null),E=H(),_=V(),w=f=>{u(f.target.value),console.log("typing ...")},T=()=>{y.trim()!==""&&(E==null||E.emit("msg",[i._id,y,new Date]),J=!0,u(""))},g=f=>{if(f[1]===v.current){const a=f[0];if(a!==(c==null?void 0:c._id)&&!i.participants.some(n=>n._id===a))return;h.current&&(h.current.style.display="block");const m=f[2],x=f[3];B++,o(n=>n!==null?[...n,{sender:a,content:m,timestamp:x}]:[{sender:a,content:m,timestamp:x}])}else console.log("New message, room: "+f[1])},C=()=>{E==null||E.emit("meet",[i._id,new Date])},j=f=>{const a=`/meet/${f}?token=${r}&room=${i._id}`;window.open(a)},P=f=>{if(f[1]==i._id&&s(f[2]),f[0]==(c==null?void 0:c._id))return f[3]?void 0:j(f[2]);Notification.permission==="granted"?new Notification("Incoming Call",{body:"You have an incoming call. Do you want to join?",icon:"path/to/notification-icon.png",requireInteraction:!0}).addEventListener("click",()=>{j(f[2])}):Notification.permission!=="denied"&&Notification.requestPermission().then(a=>{a==="granted"&&P(f)})},z=()=>{s(null)},U=f=>{f.scrollIntoView({behavior:"smooth"}),h.current&&(h.current.style.display="none")},R=f=>{if(!f||!l||l.length==0)return;if(l.length>=B){d.current&&(d.current.style.display="none");return}let a,m=D;a=B-l.length-m,a<0&&(m+=a,a=0),Q(i._id,r,`${m}`,`${a}`).then(x=>{o(n=>n?x.messages.concat(n):x.messages),x.conversationLength&&(B=x.conversationLength),x.meeting_uuid?s(x.meeting_uuid):s(null)}).catch(()=>{_("/auth")})};b.useEffect(()=>{try{if(!r||!i)return;Q(i._id,r).then(f=>{o(f.messages),f.conversationLength&&(B=f.conversationLength),f.meeting_uuid?s(f.meeting_uuid):s(null)}).catch(()=>{_("/auth")})}catch(f){console.error(f)}},[r,i._id]),b.useEffect(()=>{if(E)return E.on("msg",g),E.on("meet",P),E.on("end_meet",z),()=>{E.off("msg",g),E.off("meet",P),E.off("end_meet",z)}},[E]),b.useEffect(()=>{v.current=i._id,d.current&&(d.current.style.display="none");const f=setTimeout(()=>{d.current&&N.current&&N.current.scrollHeight>N.current.clientHeight&&(d.current.style.display="flex")},1e3);return()=>{clearTimeout(f)}},[i._id]),b.useEffect(()=>{if(!(!p.current||!N.current||!l)){if(l.length<=D)return U(p.current);if(l[l.length-1].sender!=c._id){if(q)return U(p.current);N.current.scrollTop=300;return}if(J)return J=!1,U(p.current);N.current.scrollTop=300}},[l]);const W=b.useMemo(()=>e.jsx(e.Fragment,{children:Array.isArray(l)&&l.map((f,a)=>{if(f.sender&&f.sender==(c==null?void 0:c._id))return e.jsx(he,{content:f.content,timestamp:f.timestamp},a);{const m=i.participants.find(n=>n._id===f.sender),x=m?m.avatar:"";return e.jsx(me,{avatarSRC:x,content:f.content,timestamp:f.timestamp},a)}})}),[l]);return e.jsxs("div",{id:"chat-box",children:[e.jsxs("div",{id:"chat-box_topbar",className:"flex",children:[e.jsxs("div",{id:"chat-box_topbar_left",children:[e.jsx(ee,{userId:c==null?void 0:c._id,participants:i.participants}),e.jsx("button",{className:"btn",onClick:C,children:e.jsx("i",{className:"bx bxs-video"})}),t&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"This room is in a meeting"}),e.jsx("button",{onClick:()=>j(t),children:"Join"})]})]}),e.jsx(de,{})]}),e.jsxs("div",{ref:N,id:"messages-container",children:[e.jsx(X,{onChange:R,children:e.jsx("div",{ref:d,id:"topRef",children:e.jsx(ie,{size:50})})}),W,e.jsx(X,{onChange:f=>{q=f},children:e.jsx("div",{ref:p,children:"."})})]}),e.jsxs("button",{id:"btn_scroll",ref:h,onClick:()=>{p.current&&U(p.current)},children:[Array.isArray(l)&&l.length>1&&l[l.length-1].content,e.jsx("i",{className:"bx bx-down-arrow-alt"})]}),"?",e.jsxs("div",{id:"chat-box_input-container",children:[e.jsx("input",{type:"text",value:y,id:"input_message",onChange:w,onKeyDown:f=>{f.key=="Enter"&&T()}}),e.jsx("button",{onClick:T,className:"btn",children:e.jsx("i",{className:"bx bxs-send"})})]})]})},ge=({onChange:i,accept:r,id:c,icon:y})=>{const u=b.useRef(null),l=o=>{if(o.target.files){const t=o.target.files[0];i(t)}};return e.jsxs("label",{id:`btn_${c}`,htmlFor:c,children:[y,e.jsx("input",{id:c,type:"file",accept:r,ref:u,onChange:l,style:{display:"none"}})]})};const be=({token:i,profileData:r,onRefresh:c})=>{const[y,u]=b.useState(!1),[l,o]=b.useState(!1),t=b.useRef(null),s=b.useRef(null),v=b.useRef(null),d=V(),p=H();b.useEffect(()=>{if(p)return p.on("inv",c),()=>{p.off("inv",c)}},[p]),b.useEffect(()=>{s.current&&(l?s.current.classList.add("active"):s.current.classList.remove("active"))},[l]);const h=()=>{sessionStorage.removeItem("token"),d("/auth")},N=g=>{fetch(`/api/v1/rooms/${g}`,{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({accept:!0})})},E=g=>{fetch(`/api/v1/rooms/${g}`,{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({accept:!1})})},_=async()=>{if(!v.current)return;let g={};if(v.current.bio.value&&(g.bio=v.current.bio.value),v.current.fullname.value&&(g.fullname=v.current.fullname.value),v.current.password.value)if(g.password=v.current.password.value,v.current.current_password.value)g.current_password=v.current.current_password.value;else return alert("Please enter current password");if(t.current&&(g.avatar=t.current),!g.bio&&!g.fullname&&!g.password&&!g.avatar)return alert("Empty form");const C=await fetch("/api/v1/users/",{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify(g)});if(o(!1),C.ok)return alert("Updated successfully!"),c();const j=await C.json();if(j.message)return alert(j.message);alert("Error updating profile")},w=async()=>{if(window.confirm("Are you sure you want to delete your account?")){const C=window.prompt("Enter your password:");if(C!==null)try{const j={password:C},P=await fetch("/api/v1/users/",{method:"DELETE",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify(j)});if(P.ok)sessionStorage.removeItem("token"),alert("You deleted your account successfully"),d("/auth");else{const z=await P.json();z.message?alert(z.message):alert("Wrong password!")}}catch(j){console.error("Error deleting account:",j)}}},T=g=>{const C=new FormData;C.append("file",g),fetch(`/media/${r==null?void 0:r._id}/public?token=${i}`,{method:"POST",body:C}).then(j=>j.json()).then(j=>{console.log("File upload response:",j),t.current=j.url,_()}).catch(j=>{console.error("Error uploading file:",j)})};return e.jsxs("div",{id:"profile",children:[e.jsxs("div",{id:"profile_topbar",children:[e.jsx("img",{src:r==null?void 0:r.avatar,alt:"Profile",id:"profile_img",className:"cover"}),l?e.jsx(ge,{accept:"image/*",onChange:T,id:"upload-img",icon:e.jsx("i",{className:"bx bxs-camera"})}):e.jsxs("div",{children:[e.jsx("h3",{children:r==null?void 0:r.fullname}),(r==null?void 0:r.bio)&&e.jsx("p",{children:r==null?void 0:r.bio})]}),e.jsxs("div",{className:"flex",children:[l?e.jsx("button",{className:"btn",onClick:()=>o(!1),children:e.jsx("i",{className:"bx bxs-message-square-x"})}):e.jsx("button",{className:"btn",onClick:()=>o(!0),children:e.jsx("i",{className:"bx bxs-pencil"})}),e.jsx("button",{className:"btn",onClick:()=>u(g=>!g),children:y?e.jsx("i",{className:"bx bxs-message-square-x"}):e.jsxs("div",{id:"bell",children:[e.jsx("i",{className:"bx bxs-bell"}),r!=null&&r.invitations.length&&(r==null?void 0:r.invitations.length)>0?e.jsx("span",{id:"nofcount",children:r==null?void 0:r.invitations.length}):null]})}),y&&e.jsx("div",{id:"notify-container",children:r&&r.invitations.length>0?r.invitations.map(g=>e.jsxs("div",{children:[e.jsx("p",{children:g}),e.jsx("button",{onClick:()=>N(g),children:"Accept"}),e.jsx("button",{onClick:()=>E(g),children:"Refuse"})]},g)):e.jsx("p",{children:"No invitations"})}),e.jsx("button",{id:"logout-btn",className:"btn",onClick:h,children:e.jsx("i",{className:"bx bx-log-in"})})]})]}),e.jsxs("div",{ref:s,id:"profile_editor",children:[e.jsxs("form",{id:"profile_form",ref:v,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fullname",children:"Your name:"}),e.jsx("input",{type:"text",id:"fullname",name:"fullname",placeholder:r==null?void 0:r.fullname})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bio",children:"Bio:"}),e.jsx("input",{type:"text",id:"bio",name:"bio",placeholder:r==null?void 0:r.bio})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"current_password",children:"Current password:"}),e.jsx("input",{type:"password",id:"current_password",name:"current_password"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",children:"New password:"}),e.jsx("input",{type:"password",id:"password",name:"password"})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{id:"btn_delete-account",onClick:w,children:"Delete account"}),e.jsx("button",{id:"btn_submit-edit",onClick:_,children:"Save"})]})]})]})},xe=b.memo(be);const ve=({token:i,onChoose:r})=>{const c=b.useRef(null),[y,u]=b.useState([]),l=()=>{var v;const s=(v=c.current)==null?void 0:v.value;s&&fetch(`/api/v1/search/${s}`,{headers:{"content-type":"application/json",authorization:"Bearer "+i}}).then(d=>{if(d.ok)return d.json().then(p=>{u(p)});console.log(d.status)})},o=s=>{s.key==="Enter"&&l()},t=s=>{c.current&&!c.current.contains(s.target)&&(u([]),c.current.value="")};return b.useEffect(()=>(document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}),[]),e.jsxs("div",{id:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search for users...",ref:c,onKeyPress:o}),e.jsx("button",{className:"btn",onClick:l,children:e.jsx("i",{className:"bx bx-search"})}),y.length>0&&e.jsx("div",{id:"search_dropdown",children:y.map(s=>e.jsxs("div",{onClick:()=>{r({_id:s._id,fullname:s.fullname})},children:[e.jsx("img",{className:"profile-picture",src:s.avatar,alt:"Avatar"}),s.fullname]},s._id))})]})};const ye=({token:i})=>{const[r,c]=b.useState([]),y=o=>{if(r.some(t=>t._id==o._id))return alert("already selected this user");c(t=>[...t,o])},u=o=>{console.log("remove user from users list"),o>=0&&o<r.length&&c(t=>t.filter((v,d)=>d!==o))},l=async()=>{if(r.length==0)return alert("Please select a user");const o=r.map(t=>t._id);try{(await fetch("/api/v1/rooms",{method:"POST",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({invited:o})})).ok?c([]):alert("deo biet sao bug luon")}catch(t){console.error(t)}};return e.jsxs("div",{id:"room-maker",children:[e.jsx(ve,{token:i,onChoose:y}),r.length>0&&e.jsxs("div",{className:"flex",children:[e.jsx("div",{id:"chosenList",className:"flex",children:r.map((o,t)=>e.jsxs("div",{className:"chosenUser flex",children:[e.jsxs("p",{children:[" ",o.fullname]}),e.jsx("span",{onClick:()=>u(t),children:"X"})]},o.fullname))}),e.jsx("button",{className:"btn",onClick:l,children:e.jsx("i",{className:"bx bxs-message-square-add"})})]})]})};function je(){return e.jsxs("svg",{id:"bgrn-svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 700 700",preserveAspectRatio:"none",children:[e.jsxs("g",{mask:'url("#SvgjsMask1020")',fill:"none",children:[e.jsx("rect",{width:"700",height:"700",x:"0",y:"0",fill:'url("#SvgjsLinearGradient1021")'}),e.jsx("path",{d:"M700 0L426.65 0L700 81.54z",fill:"rgba(255, 255, 255, 0.2)"}),e.jsx("path",{d:"M426.65 0L700 81.54L700 267.52L414.62 0z",fill:"rgba(255, 255, 255, .13)"}),e.jsx("path",{d:"M414.62 0L700 267.52L700 452.46L156.39 0z",fill:"rgba(255, 255, 255, .1)"}),e.jsx("path",{d:"M156.39 0L700 452.46L700 490.96L83.34999999999998 0z",fill:"rgba(255, 255, 255, .1)"}),e.jsx("path",{d:"M0 700L154.99 700L0 376.93z",fill:"rgba(0, 0, 0, .1)"}),e.jsx("path",{d:"M0 376.93L154.99 700L303.17 700L0 371.8z",fill:"rgba(0, 0, 0, .175)"}),e.jsx("path",{d:"M0 371.8L303.17 700L525.89 700L0 229.98000000000002z",fill:"rgba(0, 0, 0, .25)"}),e.jsx("path",{d:"M0 229.98000000000002L525.89 700L592.96 700L0 184.46z",fill:"rgba(0, 0, 0, .325)"})]}),e.jsxs("defs",{children:[e.jsx("mask",{id:"SvgjsMask1020",children:e.jsx("rect",{width:"700",height:"700",fill:"#ffffff"})}),e.jsxs("linearGradient",{x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"userSpaceOnUse",id:"SvgjsLinearGradient1021",children:[e.jsx("stop",{id:"stop_1",offset:"0"}),e.jsx("stop",{id:"stop_2",offset:"1"})]})]})]})}const Z=i=>fetch("/api/v1/users/",{method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer "+i}}).then(r=>{if(r.ok)return r.json();throw r.status==401&&(alert("Token expired"),sessionStorage.removeItem("token"),window.location.reload()),new Error("Failed to fetch user profile")}),Ee=({token:i})=>{const[r,c]=b.useState(null),[y,u]=b.useState([]),[l,o]=b.useState(0),t=V(),s=async()=>{try{const p=await Z(i);c(p)}catch{t("/auth")}},v=p=>{o(p)},d=p=>{u(p)};return b.useEffect(()=>{i&&Z(i).then(p=>{c(p)}).catch(p=>{console.error(p),t("/auth")})},[i]),e.jsx("div",{id:"main-page",className:"flex",children:r?e.jsxs(oe,{token:i,children:[e.jsxs("div",{id:"main-page_container",children:[e.jsxs("section",{id:"section-left",children:[e.jsx(xe,{token:i,profileData:r,onRefresh:s}),e.jsx(ye,{token:i}),e.jsx(le,{userId:r._id,currentRoomIndex:l,token:i,onRoomChange:v,onUpdateStatus:d})]}),e.jsx("section",{id:"section-right",children:y.length>0&&e.jsx(pe,{profile:r,token:i,room:y[l]})})]}),e.jsx(je,{})]}):e.jsx("div",{children:"Loading skeleton ..."})})};export{Ee as default,Z as getProfile};
