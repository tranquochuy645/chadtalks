import{r as x,j as e,u as G,a as se,c as re,g as ie,P as oe}from"./index-255f8a3d.js";import{g as H}from"./getSocket-3ac81373.js";const ae=({participants:i,userId:r})=>{if(i=i.filter(f=>f._id!==r),i.length==0)return null;const l=i.length>1,v=i.slice(0,4);return e.jsx("div",{className:"card",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"group-pictures-container",children:v.map((f,u)=>e.jsx("div",{className:"profile",children:e.jsx("img",{src:f.avatar,alt:"Profile",className:"group-profile-picture"})},u))}),e.jsxs("div",{className:"profile-names",children:[v.length>0&&e.jsx("h3",{children:v.map(f=>f.fullname).join(", ")}),i.length>4&&e.jsxs("p",{className:"group-members-count",children:["+",i.length-4," more"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:i[0].avatar,alt:"Profile",className:"profile-picture"}),e.jsxs("h3",{children:[i[0].fullname+"  ",e.jsx("span",{className:i[0].isOnline?"online":"offline",children:"â€¢"})]}),i[0].bio&&e.jsx("p",{children:i[0].bio})]})})},te=x.memo(ae);const Y=i=>new Promise((r,l)=>{fetch("/api/v1/rooms",{method:"GET",headers:{"content-type":"application/json",authorization:"Bearer "+i}}).then(v=>{if(v.ok)return v.json().then(f=>{r(f)});throw v.status==401&&(alert("Token expired"),sessionStorage.removeItem("token")),new Error("Failed to fetch rooms information")}).catch(v=>{l(v)})}),le=({userId:i,currentRoomIndex:r,token:l,onRoomChange:v,onUpdateStatus:f})=>{const[u,o]=x.useState([]),t=x.useRef(""),s=x.useRef(null),y=G(),h=_=>{const j=_;"onl"+j!=t.current&&(t.current="onl"+j,o(S=>S&&S.map(N=>{const p=N.participants.map(w=>w._id===j?{...w,isOnline:!0}:w);return{...N,participants:p}})))},m=_=>{const j=_;"off"+j!=t.current&&(t.current="off"+j,o(S=>S&&S.map(N=>{const p=N.participants.map(w=>w._id===j?{...w,isOnline:!1}:w);return{...N,participants:p}})))},g=()=>{Y(l).then(_=>{o(_)}).catch(()=>{y("/auth")})},R=_=>{var S,N;const j=document.querySelectorAll(".chat-room");j==null||j.forEach(p=>{var w;(w=p.classList)==null||w.remove("active")}),(N=(S=j[_])==null?void 0:S.classList)==null||N.add("active"),v(_)};x.useEffect(()=>{u.length>0&&f(u)},[u]),x.useEffect(()=>(l&&Y(l).then(_=>{o(_);const j=H(l);j.on("onl",h),j.on("off",m),j.on("room",g),s.current=j}).catch(()=>{y("/auth")}),()=>{var _;(_=s.current)==null||_.disconnect()}),[l]);const z=x.useMemo(()=>u.map((_,j)=>e.jsx("div",{className:`chat-room ${j==r?"active":""}`,onClick:()=>R(j),children:e.jsx(te,{userId:i,participants:_.participants})},_._id)),[u]);return e.jsx("div",{id:"rooms-list",children:u&&u.length>0?e.jsx("div",{children:z}):e.jsx("p",{children:"No rooms to display"})})};const ce={light:{text:"#000",background:"#fff",theme:"#009688"},dark:{text:"#ffffff",background:"#000",theme:"#240063"}},ue=()=>{const[i,r]=x.useState(sessionStorage.getItem("theme")||"light");return x.useEffect(()=>{const l=ce[i];Object.entries(l).forEach(([v,f])=>{document.documentElement.style.setProperty(`--${v}-color`,f)}),sessionStorage.setItem("theme",i)},[i]),[i,r]},de=()=>{const[i,r]=ue(),l=i==="light",v=()=>{r(l?"dark":"light")};return e.jsxs("div",{className:"theme-switch-container",children:[e.jsx("input",{type:"checkbox",id:"switcher-input",checked:l,onChange:v}),e.jsxs("label",{className:`switcher-label ${l?"":"active"}`,htmlFor:"switcher-input",children:[e.jsx("i",{className:"fas fa-solid fa-sun"}),e.jsx("span",{className:"switcher-toggler"}),e.jsx("i",{className:"fas fa-solid fa-moon"})]})]})};var ne={exports:{}};(function(i,r){(function(v,f){i.exports=f(x,se)})(re,function(l,v){return function(f){var u={};function o(t){if(u[t])return u[t].exports;var s=u[t]={i:t,l:!1,exports:{}};return f[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=f,o.c=u,o.d=function(t,s,y){o.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:y})},o.r=function(t){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,s){if(s&1&&(t=o(t)),s&8||s&4&&typeof t=="object"&&t&&t.__esModule)return t;var y=Object.create(null);if(o.r(y),Object.defineProperty(y,"default",{enumerable:!0,value:t}),s&2&&typeof t!="string")for(var h in t)o.d(y,h,(function(m){return t[m]}).bind(null,h));return y},o.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(s,"a",s),s},o.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},o.p="",o(o.s=4)}([function(f,u,o){f.exports=o(5)()},function(f,u){f.exports=l},function(f,u){f.exports=v},function(f,u){f.exports=function(o,t,s){var y=o.direction,h=o.value;switch(y){case"top":return s.top+h<t.top&&s.bottom>t.bottom&&s.left<t.left&&s.right>t.right;case"left":return s.left+h<t.left&&s.bottom>t.bottom&&s.top<t.top&&s.right>t.right;case"bottom":return s.bottom-h>t.bottom&&s.left<t.left&&s.right>t.right&&s.top<t.top;case"right":return s.right-h>t.right&&s.left<t.left&&s.top<t.top&&s.bottom>t.bottom}}},function(f,u,o){o.r(u),o.d(u,"default",function(){return E});var t=o(1),s=o.n(t),y=o(2),h=o.n(y),m=o(0),g=o.n(m),R=o(3),z=o.n(R);function _(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_=function(b){return typeof b}:_=function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},_(a)}function j(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")}function S(a,c){for(var b=0;b<c.length;b++){var n=c[b];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function N(a,c,b){return c&&S(a.prototype,c),b&&S(a,b),a}function p(a,c){return c&&(_(c)==="object"||typeof c=="function")?c:T(a)}function w(a){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(b){return b.__proto__||Object.getPrototypeOf(b)},w(a)}function T(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function I(a,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),c&&k(a,c)}function k(a,c){return k=Object.setPrototypeOf||function(n,U){return n.__proto__=U,n},k(a,c)}function M(a,c,b){return c in a?Object.defineProperty(a,c,{value:b,enumerable:!0,configurable:!0,writable:!0}):a[c]=b,a}function d(a){return a.width===void 0&&(a.width=a.right-a.left),a.height===void 0&&(a.height=a.bottom-a.top),a}var E=function(a){I(c,a);function c(b){var n;return j(this,c),n=p(this,w(c).call(this,b)),M(T(n),"getContainer",function(){return n.props.containment||window}),M(T(n),"addEventListener",function(U,C,L,F){n.debounceCheck||(n.debounceCheck={});var O,V,B=function(){O=null,n.check()};F>-1?V=function(){O||(O=setTimeout(B,F||0))}:V=function(){clearTimeout(O),O=setTimeout(B,L||0)};var W={target:U,fn:V,getLastTimeout:function(){return O}};U.addEventListener(C,W.fn),n.debounceCheck[C]=W}),M(T(n),"startWatching",function(){n.debounceCheck||n.interval||(n.props.intervalCheck&&(n.interval=setInterval(n.check,n.props.intervalDelay)),n.props.scrollCheck&&n.addEventListener(n.getContainer(),"scroll",n.props.scrollDelay,n.props.scrollThrottle),n.props.resizeCheck&&n.addEventListener(window,"resize",n.props.resizeDelay,n.props.resizeThrottle),!n.props.delayedCall&&n.check())}),M(T(n),"stopWatching",function(){if(n.debounceCheck){for(var U in n.debounceCheck)if(n.debounceCheck.hasOwnProperty(U)){var C=n.debounceCheck[U];clearTimeout(C.getLastTimeout()),C.target.removeEventListener(U,C.fn),n.debounceCheck[U]=null}}n.debounceCheck=null,n.interval&&(n.interval=clearInterval(n.interval))}),M(T(n),"check",function(){var U=n.node,C,L;if(!U)return n.state;if(C=d(n.roundRectDown(U.getBoundingClientRect())),n.props.containment){var F=n.props.containment.getBoundingClientRect();L={top:F.top,left:F.left,bottom:F.bottom,right:F.right}}else L={top:0,left:0,bottom:window.innerHeight||document.documentElement.clientHeight,right:window.innerWidth||document.documentElement.clientWidth};var O=n.props.offset||{},V=_(O)==="object";V&&(L.top+=O.top||0,L.left+=O.left||0,L.bottom-=O.bottom||0,L.right-=O.right||0);var B={top:C.top>=L.top,left:C.left>=L.left,bottom:C.bottom<=L.bottom,right:C.right<=L.right},W=C.height>0&&C.width>0,A=W&&B.top&&B.left&&B.bottom&&B.right;if(W&&n.props.partialVisibility){var K=C.top<=L.bottom&&C.bottom>=L.top&&C.left<=L.right&&C.right>=L.left;typeof n.props.partialVisibility=="string"&&(K=B[n.props.partialVisibility]),A=n.props.minTopValue?K&&C.top<=L.bottom-n.props.minTopValue:K}typeof O.direction=="string"&&typeof O.value=="number"&&(console.warn("[notice] offset.direction and offset.value have been deprecated. They still work for now, but will be removed in next major version. Please upgrade to the new syntax: { %s: %d }",O.direction,O.value),A=z()(O,C,L));var D=n.state;return n.state.isVisible!==A&&(D={isVisible:A,visibilityRect:B},n.setState(D),n.props.onChange&&n.props.onChange(A)),D}),n.state={isVisible:null,visibilityRect:{}},n}return N(c,[{key:"componentDidMount",value:function(){this.node=h.a.findDOMNode(this),this.props.active&&this.startWatching()}},{key:"componentWillUnmount",value:function(){this.stopWatching()}},{key:"componentDidUpdate",value:function(n){this.node=h.a.findDOMNode(this),this.props.active&&!n.active?(this.setState({isVisible:null,visibilityRect:{}}),this.startWatching()):this.props.active||this.stopWatching()}},{key:"roundRectDown",value:function(n){return{top:Math.floor(n.top),left:Math.floor(n.left),bottom:Math.floor(n.bottom),right:Math.floor(n.right)}}},{key:"render",value:function(){return this.props.children instanceof Function?this.props.children({isVisible:this.state.isVisible,visibilityRect:this.state.visibilityRect}):s.a.Children.only(this.props.children)}}]),c}(s.a.Component);M(E,"defaultProps",{active:!0,partialVisibility:!1,minTopValue:0,scrollCheck:!1,scrollDelay:250,scrollThrottle:-1,resizeCheck:!1,resizeDelay:250,resizeThrottle:-1,intervalCheck:!0,intervalDelay:100,delayedCall:!1,offset:{},containment:null,children:s.a.createElement("span",null)}),M(E,"propTypes",{onChange:g.a.func,active:g.a.bool,partialVisibility:g.a.oneOfType([g.a.bool,g.a.oneOf(["top","right","bottom","left"])]),delayedCall:g.a.bool,offset:g.a.oneOfType([g.a.shape({top:g.a.number,left:g.a.number,bottom:g.a.number,right:g.a.number}),g.a.shape({direction:g.a.oneOf(["top","right","bottom","left"]),value:g.a.number})]),scrollCheck:g.a.bool,scrollDelay:g.a.number,scrollThrottle:g.a.number,resizeCheck:g.a.bool,resizeDelay:g.a.number,resizeThrottle:g.a.number,intervalCheck:g.a.bool,intervalDelay:g.a.number,containment:typeof window<"u"?g.a.instanceOf(window.Element):g.a.any,children:g.a.oneOfType([g.a.element,g.a.func]),minTopValue:g.a.number})},function(f,u,o){var t=o(6);function s(){}function y(){}y.resetWarningCache=s,f.exports=function(){function h(R,z,_,j,S,N){if(N!==t){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}h.isRequired=h;function m(){return h}var g={array:h,bool:h,func:h,number:h,object:h,string:h,symbol:h,any:h,arrayOf:m,element:h,elementType:h,instanceOf:m,node:h,objectOf:m,oneOf:m,oneOfType:m,shape:m,exact:m,checkPropTypes:y,resetWarningCache:s};return g.PropTypes=g,g}},function(f,u,o){var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";f.exports=t}])})})(ne);var he=ne.exports;const X=ie(he);let P,J,q,$;const Q=30,Z=(i,r,l,v)=>fetch(`/api/v1/rooms/${i}?limit=${l}&skip=${v}`,{method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer "+r}}).then(f=>{if(f.status===304)throw new Error("Already got this");if(f.ok)return f.json();throw f.status==401&&(alert("Token expired"),sessionStorage.removeItem("token")),new Error("Failed to fetch messages")}),fe=({room:i,token:r,profile:l})=>{const[v,f]=x.useState(""),[u,o]=x.useState(null),[t,s]=x.useState(),y=x.useRef(i._id),h=x.useRef(null),m=x.useRef(null),g=x.useRef(null),R=x.useRef(null),z=G(),_=d=>{f(d.target.value),console.log("typing ...")},j=()=>{v.trim()!==""&&(P==null||P.emit("msg",[i._id,v,new Date]),J=!0,f(""))},S=d=>{if(d[1]===y.current){const E=d[0];if(E!==(l==null?void 0:l._id)&&!i.participants.some(b=>b._id===E))return;g.current&&(g.current.style.display="block");const a=d[2],c=d[3];$++,o(b=>b!==null?[...b,{sender:E,content:a,timestamp:c}]:[{sender:E,content:a,timestamp:c}])}else console.log("New message, room: "+d[1])},N=()=>{P==null||P.emit("meet",[i._id,new Date])},p=d=>{const E=`/meet/${d}?token=${r}&room=${i._id}`;window.open(E)},w=d=>{if(d[1]==i._id&&s(d[2]),d[0]==(l==null?void 0:l._id))return d[3]?void 0:p(d[2]);Notification.permission==="granted"?new Notification("Incoming Call",{body:"You have an incoming call. Do you want to join?",icon:"path/to/notification-icon.png",requireInteraction:!0}).addEventListener("click",()=>{p(d[2])}):Notification.permission!=="denied"&&Notification.requestPermission().then(E=>{E==="granted"&&w(d)})},T=()=>{s(null)},I=d=>{d.scrollIntoView({behavior:"smooth"}),g.current&&(g.current.style.display="none")},k=d=>{if(!d||!u||u.length==0)return;if(u.length>=$){h.current&&(h.current.style.display="none");return}let E,a=Q;E=$-u.length-a,E<0&&(a+=E,E=0),Z(i._id,r,`${a}`,`${E}`).then(c=>{o(b=>b?c.messages.concat(b):c.messages),c.conversationLength&&($=c.conversationLength),c.meeting_uuid?s(c.meeting_uuid):s(null)}).catch(()=>{z("/auth")})};x.useEffect(()=>{try{if(!r||!i)return;Z(i._id,r).then(d=>{o(d.messages),d.conversationLength&&($=d.conversationLength),d.meeting_uuid?s(d.meeting_uuid):s(null)}).catch(()=>{z("/auth")})}catch(d){console.error(d)}},[r,i._id]),x.useEffect(()=>{r&&(P=H(r),P==null||P.on("msg",S),P==null||P.on("meet",w),P==null||P.on("end_meet",T))},[r]),x.useEffect(()=>{y.current=i._id,h.current&&(h.current.style.display="none");const d=setTimeout(()=>{h.current&&R.current&&R.current.scrollHeight>R.current.clientHeight&&(h.current.style.display="flex")},1e3);return()=>{clearTimeout(d)}},[i._id]),x.useEffect(()=>{if(!(!m.current||!R.current||!u)){if(u.length<=Q)return I(m.current);if(u[u.length-1].sender!=l._id){if(q)return I(m.current);R.current.scrollTop=300;return}if(J)return J=!1,I(m.current);R.current.scrollTop=300}},[u]);const M=x.useMemo(()=>e.jsx(e.Fragment,{children:Array.isArray(u)&&u.map((d,E)=>{let a;if(d.sender&&d.sender==(l==null?void 0:l._id))a=l.avatar;else{const c=i.participants.find(b=>b._id===d.sender);a=c?c.avatar:""}return e.jsxs("div",{className:`message ${d.sender==(l==null?void 0:l._id)?"own":"guest"}`,children:[e.jsxs("div",{className:"message_wrapper",children:[d.sender!=(l==null?void 0:l._id)&&a&&e.jsx("img",{className:"inchat-avatar",src:a,alt:"Sender Avatar"}),e.jsx("p",{children:d.content})]}),e.jsx("p",{className:"message_timestamp",children:d.timestamp})]},E)})}),[u]);return e.jsxs("div",{id:"chat-box",children:[e.jsxs("div",{id:"chat-box_topbar",className:"flex",children:[e.jsxs("div",{id:"chat-box_topbar_left",children:[e.jsx(te,{userId:l==null?void 0:l._id,participants:i.participants}),e.jsx("button",{className:"btn",onClick:N,children:e.jsx("i",{className:"bx bxs-video"})}),t&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"This room is in a meeting"}),e.jsx("button",{onClick:()=>p(t),children:"Join"})]})]}),e.jsx(de,{})]}),e.jsxs("div",{ref:R,id:"messages-container",children:[e.jsx(X,{onChange:k,children:e.jsx("div",{ref:h,id:"topRef",children:e.jsx(oe,{size:50})})}),M,e.jsx(X,{onChange:d=>{q=d},children:e.jsx("div",{ref:m,children:"."})})]}),e.jsxs("button",{id:"btn_scroll",ref:g,onClick:()=>{m.current&&I(m.current)},children:[u&&u[u.length-1].content," ",e.jsx("i",{className:"bx bx-down-arrow-alt"})]}),"?",e.jsxs("div",{id:"chat-box_input-container",children:[e.jsx("input",{type:"text",value:v,id:"input_message",onChange:_,onKeyDown:d=>{d.key=="Enter"&&j()}}),e.jsx("button",{onClick:j,className:"btn",children:e.jsx("i",{className:"bx bxs-send"})})]})]})};const me=({token:i,profileData:r,onRefresh:l})=>{const[v,f]=x.useState(!1),[u,o]=x.useState(!1),t=x.useRef(null),s=x.useRef(null),y=x.useRef(null),h=x.useRef(null),m=x.useRef(null),g=G();x.useEffect(()=>{if(i){const p=H(i);p.on("inv",l),y.current=p}return()=>{var p;(p=y.current)==null||p.disconnect()}},[i]),x.useEffect(()=>{h.current&&(u?h.current.classList.add("active"):h.current.classList.remove("active"))},[u]);const R=()=>{sessionStorage.removeItem("token"),g("/auth")},z=p=>{fetch(`/api/v1/rooms/${p}`,{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({accept:!0})})},_=p=>{fetch(`/api/v1/rooms/${p}`,{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({accept:!1})})},j=async()=>{if(!m.current)return;let p={};if(m.current.bio.value&&(p.bio=m.current.bio.value),m.current.fullname.value&&(p.fullname=m.current.fullname.value),m.current.password.value)if(p.password=m.current.password.value,m.current.current_password.value)p.current_password=m.current.current_password.value;else return alert("Please enter current password");if(s.current&&(p.avatar=s.current),!p.bio&&!p.fullname&&!p.password&&!p.avatar)return alert("Empty form");const w=await fetch("/api/v1/users/",{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify(p)});if(o(!1),w.ok)return alert("Updated successfully!"),l();const T=await w.json();if(T.message)return alert(T.message);alert("Error updating profile")},S=async()=>{if(window.confirm("Are you sure you want to delete your account?")){const w=window.prompt("Enter your password:");if(w!==null)try{const T={password:w},I=await fetch("/api/v1/users/",{method:"DELETE",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify(T)});if(I.ok)sessionStorage.removeItem("token"),alert("You deleted your account successfully"),g("/auth");else{const k=await I.json();k.message?alert(k.message):alert("Wrong password!")}}catch(T){console.error("Error deleting account:",T)}}},N=()=>{if(t!=null&&t.current&&t.current.length>0){const p=t.current.files[0],w=new FileReader;w.onload=async T=>{var I;if((I=T.target)!=null&&I.result){const k=new Image;k.onload=async()=>{const M=document.createElement("canvas"),d=200,E=200;let a=k.width,c=k.height;a>d&&(c*=d/a,a=d),c>E&&(a*=E/c,c=E),M.width=a,M.height=c;const b=M.getContext("2d");b==null||b.drawImage(k,0,0,a,c);const n=M.toDataURL("image/jpeg");s.current=n},k.src=T.target.result}},w.readAsDataURL(p)}};return e.jsxs("div",{id:"profile",children:[e.jsxs("div",{id:"profile_topbar",children:[e.jsx("img",{src:r==null?void 0:r.avatar,alt:"Profile",id:"profile_img",className:"cover"}),u?e.jsxs("label",{id:"btn_upload-img",htmlFor:"upload-img",children:[e.jsx("i",{className:"bx bxs-camera"}),e.jsx("input",{id:"upload-img",type:"file",accept:"image/*",ref:t,onChange:N})]}):e.jsxs("div",{children:[e.jsx("h3",{children:r==null?void 0:r.fullname}),(r==null?void 0:r.bio)&&e.jsx("p",{children:r==null?void 0:r.bio})]}),e.jsxs("div",{className:"flex",children:[u?e.jsx("button",{className:"btn",onClick:()=>o(!1),children:e.jsx("i",{className:"bx bxs-message-square-x"})}):e.jsx("button",{className:"btn",onClick:()=>o(!0),children:e.jsx("i",{className:"bx bxs-pencil"})}),e.jsx("button",{className:"btn",onClick:()=>f(p=>!p),children:v?e.jsx("i",{className:"bx bxs-message-square-x"}):e.jsxs("div",{id:"bell",children:[e.jsx("i",{className:"bx bxs-bell"}),r!=null&&r.invitations.length&&(r==null?void 0:r.invitations.length)>0?e.jsx("span",{id:"nofcount",children:r==null?void 0:r.invitations.length}):null]})}),v&&e.jsx("div",{id:"notify-container",children:r&&r.invitations.length>0?r.invitations.map(p=>e.jsxs("div",{children:[e.jsx("p",{children:p}),e.jsx("button",{onClick:()=>z(p),children:"Accept"}),e.jsx("button",{onClick:()=>_(p),children:"Refuse"})]},p)):e.jsx("p",{children:"No invitations"})}),e.jsx("button",{id:"logout-btn",className:"btn",onClick:R,children:e.jsx("i",{className:"bx bx-log-in"})})]})]}),e.jsxs("div",{ref:h,id:"profile_editor",children:[e.jsxs("form",{id:"profile_form",ref:m,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fullname",children:"Your name:"}),e.jsx("input",{type:"text",id:"fullname",name:"fullname",placeholder:r==null?void 0:r.fullname})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bio",children:"Bio:"}),e.jsx("input",{type:"text",id:"bio",name:"bio",placeholder:r==null?void 0:r.bio})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"current_password",children:"Current password:"}),e.jsx("input",{type:"password",id:"current_password",name:"current_password"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",children:"New password:"}),e.jsx("input",{type:"password",id:"password",name:"password"})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{id:"btn_delete-account",onClick:S,children:"Delete account"}),e.jsx("button",{id:"btn_submit-edit",onClick:j,children:"Save"})]})]})]})},pe=x.memo(me);const ge=({token:i,onChoose:r})=>{const l=x.useRef(null),[v,f]=x.useState([]),u=()=>{var y;const s=(y=l.current)==null?void 0:y.value;s&&fetch(`/api/v1/search/${s}`,{headers:{"content-type":"application/json",authorization:"Bearer "+i}}).then(h=>{if(h.ok)return h.json().then(m=>{f(m)});console.log(h.status)})},o=s=>{s.key==="Enter"&&u()},t=s=>{l.current&&!l.current.contains(s.target)&&(f([]),l.current.value="")};return x.useEffect(()=>(document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}),[]),e.jsxs("div",{id:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search for users...",ref:l,onKeyPress:o}),e.jsx("button",{className:"btn",onClick:u,children:e.jsx("i",{className:"bx bx-search"})}),v.length>0&&e.jsx("div",{id:"search_dropdown",children:v.map(s=>e.jsxs("div",{onClick:()=>{r({_id:s._id,fullname:s.fullname})},children:[e.jsx("img",{className:"profile-picture",src:s.avatar,alt:"Avatar"}),s.fullname]},s._id))})]})};const be=({token:i})=>{const[r,l]=x.useState([]),v=o=>{if(r.some(t=>t._id==o._id))return alert("already selected this user");l(t=>[...t,o])},f=o=>{console.log("remove user from users list"),o>=0&&o<r.length&&l(t=>t.filter((y,h)=>h!==o))},u=async()=>{if(r.length==0)return alert("Please select a user");const o=r.map(t=>t._id);try{(await fetch("/api/v1/rooms",{method:"POST",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({invited:o})})).ok?l([]):alert("deo biet sao bug luon")}catch(t){console.error(t)}};return e.jsxs("div",{id:"room-maker",children:[e.jsx(ge,{token:i,onChoose:v}),r.length>0&&e.jsxs("div",{className:"flex",children:[e.jsx("div",{id:"chosenList",className:"flex",children:r.map((o,t)=>e.jsxs("div",{className:"chosenUser flex",children:[e.jsxs("p",{children:[" ",o.fullname]}),e.jsx("span",{onClick:()=>f(t),children:"X"})]},o.fullname))}),e.jsx("button",{className:"btn",onClick:u,children:e.jsx("i",{className:"bx bxs-message-square-add"})})]})]})};function xe(){return e.jsxs("svg",{id:"bgrn-svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 700 700",preserveAspectRatio:"none",children:[e.jsxs("g",{mask:'url("#SvgjsMask1020")',fill:"none",children:[e.jsx("rect",{width:"700",height:"700",x:"0",y:"0",fill:'url("#SvgjsLinearGradient1021")'}),e.jsx("path",{d:"M700 0L426.65 0L700 81.54z",fill:"rgba(255, 255, 255, 0.2)"}),e.jsx("path",{d:"M426.65 0L700 81.54L700 267.52L414.62 0z",fill:"rgba(255, 255, 255, .13)"}),e.jsx("path",{d:"M414.62 0L700 267.52L700 452.46L156.39 0z",fill:"rgba(255, 255, 255, .1)"}),e.jsx("path",{d:"M156.39 0L700 452.46L700 490.96L83.34999999999998 0z",fill:"rgba(255, 255, 255, .1)"}),e.jsx("path",{d:"M0 700L154.99 700L0 376.93z",fill:"rgba(0, 0, 0, .1)"}),e.jsx("path",{d:"M0 376.93L154.99 700L303.17 700L0 371.8z",fill:"rgba(0, 0, 0, .175)"}),e.jsx("path",{d:"M0 371.8L303.17 700L525.89 700L0 229.98000000000002z",fill:"rgba(0, 0, 0, .25)"}),e.jsx("path",{d:"M0 229.98000000000002L525.89 700L592.96 700L0 184.46z",fill:"rgba(0, 0, 0, .325)"})]}),e.jsxs("defs",{children:[e.jsx("mask",{id:"SvgjsMask1020",children:e.jsx("rect",{width:"700",height:"700",fill:"#ffffff"})}),e.jsxs("linearGradient",{x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"userSpaceOnUse",id:"SvgjsLinearGradient1021",children:[e.jsx("stop",{id:"stop_1",offset:"0"}),e.jsx("stop",{id:"stop_2",offset:"1"})]})]})]})}const ee=i=>fetch("/api/v1/users/",{method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer "+i}}).then(r=>{if(r.ok)return r.json();throw r.status==401&&(alert("Token expired"),sessionStorage.removeItem("token"),window.location.reload()),new Error("Failed to fetch user profile")}),je=({token:i})=>{const[r,l]=x.useState(null),[v,f]=x.useState([]),[u,o]=x.useState(0),t=G(),s=async()=>{try{const m=await ee(i);l(m)}catch{t("/auth")}},y=m=>{o(m)},h=m=>{f(m)};return x.useEffect(()=>{i&&ee(i).then(m=>{l(m)}).catch(m=>{console.error(m),t("/auth")})},[i]),e.jsx("div",{id:"main-page",className:"flex",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"main-page_container",children:[e.jsxs("section",{id:"section-left",children:[e.jsx(pe,{token:i,profileData:r,onRefresh:s}),e.jsx(be,{token:i}),e.jsx(le,{userId:r._id,currentRoomIndex:u,token:i,onRoomChange:y,onUpdateStatus:h})]}),e.jsx("section",{id:"section-right",children:v.length>0&&e.jsx(fe,{profile:r,token:i,room:v[u]})})]}),e.jsx(xe,{})]}):e.jsx("div",{children:"Loading skeleton ..."})})};export{je as default,ee as getProfile};
