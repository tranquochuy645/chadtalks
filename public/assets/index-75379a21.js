import{r as b,j as e,u as G,a as se,c as re,g as ie,P as oe}from"./index-75c0a4b6.js";import{g as Y}from"./getSocket-3ac81373.js";const ae=({participants:i,userId:n})=>{if(i=i.filter(h=>h._id!==n),i.length==0)return null;const a=i.length>1,v=i.slice(0,4);return e.jsx("div",{className:"card",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"group-pictures-container",children:v.map((h,l)=>e.jsx("div",{className:"profile",children:e.jsx("img",{src:h.avatar,alt:"Profile",className:"group-profile-picture"})},l))}),e.jsxs("div",{className:"profile-names",children:[v.length>0&&e.jsx("h3",{children:v.map(h=>h.fullname).join(", ")}),i.length>4&&e.jsxs("p",{className:"group-members-count",children:["+",i.length-4," more"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:i[0].avatar,alt:"Profile",className:"profile-picture"}),e.jsxs("h3",{children:[i[0].fullname+"  ",e.jsx("span",{className:i[0].isOnline?"online":"offline",children:"â€¢"})]}),i[0].bio&&e.jsx("p",{children:i[0].bio})]})})},te=b.memo(ae);const X=i=>new Promise((n,a)=>{fetch("/api/v1/rooms",{method:"GET",headers:{"content-type":"application/json",authorization:"Bearer "+i}}).then(v=>{if(v.ok)return v.json().then(h=>{n(h)});throw v.status==401&&(alert("Token expired"),sessionStorage.removeItem("token")),new Error("Failed to fetch rooms information")}).catch(v=>{a(v)})}),le=({userId:i,currentRoomIndex:n,token:a,onRoomChange:v,onUpdateStatus:h})=>{const[l,o]=b.useState([]),t=b.useRef(""),s=b.useRef(null),y=G(),u=_=>{const j=_;"onl"+j!=t.current&&(t.current="onl"+j,o(T=>T&&T.map(P=>{const f=P.participants.map(w=>w._id===j?{...w,isOnline:!0}:w);return{...P,participants:f}})))},m=_=>{const j=_;"off"+j!=t.current&&(t.current="off"+j,o(T=>T&&T.map(P=>{const f=P.participants.map(w=>w._id===j?{...w,isOnline:!1}:w);return{...P,participants:f}})))},g=()=>{X(a).then(_=>{o(_)}).catch(()=>{y("/auth")})},R=_=>{var T,P;const j=document.querySelectorAll(".chat-room");j==null||j.forEach(f=>{var w;(w=f.classList)==null||w.remove("active")}),(P=(T=j[_])==null?void 0:T.classList)==null||P.add("active"),v(_)};b.useEffect(()=>{l.length>0&&h(l)},[l]),b.useEffect(()=>(a&&X(a).then(_=>{o(_);const j=Y(a);j.on("onl",u),j.on("off",m),j.on("room",g),s.current=j}).catch(()=>{y("/auth")}),()=>{var _;(_=s.current)==null||_.disconnect()}),[a]);const M=b.useMemo(()=>l.map((_,j)=>e.jsx("div",{className:`chat-room ${j==n?"active":""}`,onClick:()=>R(j),children:e.jsx(te,{userId:i,participants:_.participants})},_._id)),[l]);return e.jsx("div",{id:"rooms-list",children:l&&l.length>0?e.jsx("div",{children:M}):e.jsx("p",{children:"No rooms to display"})})};const ce={light:{text:"#000",background:"#fff",theme:"#009688"},dark:{text:"#ffffff",background:"#000",theme:"#240063"}},ue=()=>{const[i,n]=b.useState(sessionStorage.getItem("theme")||"light");return b.useEffect(()=>{const a=ce[i];Object.entries(a).forEach(([v,h])=>{document.documentElement.style.setProperty(`--${v}-color`,h)}),sessionStorage.setItem("theme",i)},[i]),[i,n]},de=()=>{const[i,n]=ue(),a=i==="light",v=()=>{n(a?"dark":"light")};return e.jsxs("div",{className:"theme-switch-container",children:[e.jsx("input",{type:"checkbox",id:"switcher-input",checked:a,onChange:v}),e.jsxs("label",{className:`switcher-label ${a?"":"active"}`,htmlFor:"switcher-input",children:[e.jsx("i",{className:"fas fa-solid fa-sun"}),e.jsx("span",{className:"switcher-toggler"}),e.jsx("i",{className:"fas fa-solid fa-moon"})]})]})};var ne={exports:{}};(function(i,n){(function(v,h){i.exports=h(b,se)})(re,function(a,v){return function(h){var l={};function o(t){if(l[t])return l[t].exports;var s=l[t]={i:t,l:!1,exports:{}};return h[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=h,o.c=l,o.d=function(t,s,y){o.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:y})},o.r=function(t){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,s){if(s&1&&(t=o(t)),s&8||s&4&&typeof t=="object"&&t&&t.__esModule)return t;var y=Object.create(null);if(o.r(y),Object.defineProperty(y,"default",{enumerable:!0,value:t}),s&2&&typeof t!="string")for(var u in t)o.d(y,u,(function(m){return t[m]}).bind(null,u));return y},o.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(s,"a",s),s},o.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},o.p="",o(o.s=4)}([function(h,l,o){h.exports=o(5)()},function(h,l){h.exports=a},function(h,l){h.exports=v},function(h,l){h.exports=function(o,t,s){var y=o.direction,u=o.value;switch(y){case"top":return s.top+u<t.top&&s.bottom>t.bottom&&s.left<t.left&&s.right>t.right;case"left":return s.left+u<t.left&&s.bottom>t.bottom&&s.top<t.top&&s.right>t.right;case"bottom":return s.bottom-u>t.bottom&&s.left<t.left&&s.right>t.right&&s.top<t.top;case"right":return s.right-u>t.right&&s.left<t.left&&s.top<t.top&&s.bottom>t.bottom}}},function(h,l,o){o.r(l),o.d(l,"default",function(){return C});var t=o(1),s=o.n(t),y=o(2),u=o.n(y),m=o(0),g=o.n(m),R=o(3),M=o.n(R);function _(c){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_=function(x){return typeof x}:_=function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},_(c)}function j(c,d){if(!(c instanceof d))throw new TypeError("Cannot call a class as a function")}function T(c,d){for(var x=0;x<d.length;x++){var r=d[x];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(c,r.key,r)}}function P(c,d,x){return d&&T(c.prototype,d),x&&T(c,x),c}function f(c,d){return d&&(_(d)==="object"||typeof d=="function")?d:E(c)}function w(c){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(x){return x.__proto__||Object.getPrototypeOf(x)},w(c)}function E(c){if(c===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c}function I(c,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(d&&d.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),d&&A(c,d)}function A(c,d){return A=Object.setPrototypeOf||function(r,k){return r.__proto__=k,r},A(c,d)}function U(c,d,x){return d in c?Object.defineProperty(c,d,{value:x,enumerable:!0,configurable:!0,writable:!0}):c[d]=x,c}function p(c){return c.width===void 0&&(c.width=c.right-c.left),c.height===void 0&&(c.height=c.bottom-c.top),c}var C=function(c){I(d,c);function d(x){var r;return j(this,d),r=f(this,w(d).call(this,x)),U(E(r),"getContainer",function(){return r.props.containment||window}),U(E(r),"addEventListener",function(k,S,L,F){r.debounceCheck||(r.debounceCheck={});var O,$,z=function(){O=null,r.check()};F>-1?$=function(){O||(O=setTimeout(z,F||0))}:$=function(){clearTimeout(O),O=setTimeout(z,L||0)};var V={target:k,fn:$,getLastTimeout:function(){return O}};k.addEventListener(S,V.fn),r.debounceCheck[S]=V}),U(E(r),"startWatching",function(){r.debounceCheck||r.interval||(r.props.intervalCheck&&(r.interval=setInterval(r.check,r.props.intervalDelay)),r.props.scrollCheck&&r.addEventListener(r.getContainer(),"scroll",r.props.scrollDelay,r.props.scrollThrottle),r.props.resizeCheck&&r.addEventListener(window,"resize",r.props.resizeDelay,r.props.resizeThrottle),!r.props.delayedCall&&r.check())}),U(E(r),"stopWatching",function(){if(r.debounceCheck){for(var k in r.debounceCheck)if(r.debounceCheck.hasOwnProperty(k)){var S=r.debounceCheck[k];clearTimeout(S.getLastTimeout()),S.target.removeEventListener(k,S.fn),r.debounceCheck[k]=null}}r.debounceCheck=null,r.interval&&(r.interval=clearInterval(r.interval))}),U(E(r),"check",function(){var k=r.node,S,L;if(!k)return r.state;if(S=p(r.roundRectDown(k.getBoundingClientRect())),r.props.containment){var F=r.props.containment.getBoundingClientRect();L={top:F.top,left:F.left,bottom:F.bottom,right:F.right}}else L={top:0,left:0,bottom:window.innerHeight||document.documentElement.clientHeight,right:window.innerWidth||document.documentElement.clientWidth};var O=r.props.offset||{},$=_(O)==="object";$&&(L.top+=O.top||0,L.left+=O.left||0,L.bottom-=O.bottom||0,L.right-=O.right||0);var z={top:S.top>=L.top,left:S.left>=L.left,bottom:S.bottom<=L.bottom,right:S.right<=L.right},V=S.height>0&&S.width>0,B=V&&z.top&&z.left&&z.bottom&&z.right;if(V&&r.props.partialVisibility){var K=S.top<=L.bottom&&S.bottom>=L.top&&S.left<=L.right&&S.right>=L.left;typeof r.props.partialVisibility=="string"&&(K=z[r.props.partialVisibility]),B=r.props.minTopValue?K&&S.top<=L.bottom-r.props.minTopValue:K}typeof O.direction=="string"&&typeof O.value=="number"&&(console.warn("[notice] offset.direction and offset.value have been deprecated. They still work for now, but will be removed in next major version. Please upgrade to the new syntax: { %s: %d }",O.direction,O.value),B=M()(O,S,L));var J=r.state;return r.state.isVisible!==B&&(J={isVisible:B,visibilityRect:z},r.setState(J),r.props.onChange&&r.props.onChange(B)),J}),r.state={isVisible:null,visibilityRect:{}},r}return P(d,[{key:"componentDidMount",value:function(){this.node=u.a.findDOMNode(this),this.props.active&&this.startWatching()}},{key:"componentWillUnmount",value:function(){this.stopWatching()}},{key:"componentDidUpdate",value:function(r){this.node=u.a.findDOMNode(this),this.props.active&&!r.active?(this.setState({isVisible:null,visibilityRect:{}}),this.startWatching()):this.props.active||this.stopWatching()}},{key:"roundRectDown",value:function(r){return{top:Math.floor(r.top),left:Math.floor(r.left),bottom:Math.floor(r.bottom),right:Math.floor(r.right)}}},{key:"render",value:function(){return this.props.children instanceof Function?this.props.children({isVisible:this.state.isVisible,visibilityRect:this.state.visibilityRect}):s.a.Children.only(this.props.children)}}]),d}(s.a.Component);U(C,"defaultProps",{active:!0,partialVisibility:!1,minTopValue:0,scrollCheck:!1,scrollDelay:250,scrollThrottle:-1,resizeCheck:!1,resizeDelay:250,resizeThrottle:-1,intervalCheck:!0,intervalDelay:100,delayedCall:!1,offset:{},containment:null,children:s.a.createElement("span",null)}),U(C,"propTypes",{onChange:g.a.func,active:g.a.bool,partialVisibility:g.a.oneOfType([g.a.bool,g.a.oneOf(["top","right","bottom","left"])]),delayedCall:g.a.bool,offset:g.a.oneOfType([g.a.shape({top:g.a.number,left:g.a.number,bottom:g.a.number,right:g.a.number}),g.a.shape({direction:g.a.oneOf(["top","right","bottom","left"]),value:g.a.number})]),scrollCheck:g.a.bool,scrollDelay:g.a.number,scrollThrottle:g.a.number,resizeCheck:g.a.bool,resizeDelay:g.a.number,resizeThrottle:g.a.number,intervalCheck:g.a.bool,intervalDelay:g.a.number,containment:typeof window<"u"?g.a.instanceOf(window.Element):g.a.any,children:g.a.oneOfType([g.a.element,g.a.func]),minTopValue:g.a.number})},function(h,l,o){var t=o(6);function s(){}function y(){}y.resetWarningCache=s,h.exports=function(){function u(R,M,_,j,T,P){if(P!==t){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}u.isRequired=u;function m(){return u}var g={array:u,bool:u,func:u,number:u,object:u,string:u,symbol:u,any:u,arrayOf:m,element:u,elementType:u,instanceOf:m,node:u,objectOf:m,oneOf:m,oneOfType:m,shape:m,exact:m,checkPropTypes:y,resetWarningCache:s};return g.PropTypes=g,g}},function(h,l,o){var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";h.exports=t}])})})(ne);var he=ne.exports;const q=ie(he);let N,H,D,W;const Q=30,Z=(i,n,a,v)=>fetch(`/api/v1/rooms/${i}?limit=${a}&skip=${v}`,{method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer "+n}}).then(h=>{if(h.status===304)throw new Error("Already got this");if(h.ok)return h.json();throw h.status==401&&(alert("Token expired"),sessionStorage.removeItem("token")),new Error("Failed to fetch messages")}),fe=({room:i,token:n,profile:a})=>{const[v,h]=b.useState(""),[l,o]=b.useState(null),[t,s]=b.useState(),y=b.useRef(i._id),u=b.useRef(null),m=b.useRef(null),g=b.useRef(null),R=b.useRef(null),M=G(),_=p=>{h(p.target.value),console.log("typing ...")},j=()=>{v.trim()!==""&&(N==null||N.emit("msg",[i._id,v,new Date]),H=!0,h(""))},T=p=>{if(p[1]===y.current){const C=p[0];if(C!==(a==null?void 0:a._id)&&!i.participants.some(x=>x._id===C))return;g.current&&(g.current.style.display="block");const c=p[2],d=p[3];W++,o(x=>x!==null?[...x,{sender:C,content:c,timestamp:d}]:[{sender:C,content:c,timestamp:d}])}else console.log("New message, room: "+p[1])},P=()=>{N==null||N.emit("meet",[i._id,new Date])},f=p=>{const C=`/meet/${p}?token=${n}&room=${i._id}`;window.open(C)},w=p=>{if(p[1]==i._id&&s(p[2]),p[0]==(a==null?void 0:a._id))return p[3]?void 0:f(p[2]);Notification.permission==="granted"?new Notification("Incoming Call",{body:"You have an incoming call. Do you want to join?",icon:"path/to/notification-icon.png",requireInteraction:!0}).addEventListener("click",()=>{f(p[2])}):Notification.permission!=="denied"&&Notification.requestPermission().then(C=>{C==="granted"&&w(p)})},E=()=>{s(null)},I=p=>{p.scrollIntoView({behavior:"smooth"}),g.current&&(g.current.style.display="none")},A=p=>{if(!p||!l||l.length==0)return;if(l.length>=W){u.current&&(u.current.style.display="none");return}let C,c=Q;C=W-l.length-c,C<0&&(c+=C,C=0),Z(i._id,n,`${c}`,`${C}`).then(d=>{o(x=>x?d.messages.concat(x):d.messages),d.conversationLength&&(W=d.conversationLength),d.meeting_uuid?s(d.meeting_uuid):s(null)}).catch(()=>{M("/auth")})};b.useEffect(()=>{try{if(!n||!i)return;Z(i._id,n).then(p=>{o(p.messages),p.conversationLength&&(W=p.conversationLength),p.meeting_uuid?s(p.meeting_uuid):s(null)}).catch(()=>{M("/auth")})}catch(p){console.error(p)}},[n,i._id]),b.useEffect(()=>{n&&(N=Y(n),N==null||N.on("msg",T),N==null||N.on("meet",w),N==null||N.on("end_meet",E))},[n]),b.useEffect(()=>{y.current=i._id,u.current&&(u.current.style.display="none");const p=setTimeout(()=>{u.current&&R.current&&R.current.scrollHeight>R.current.clientHeight&&(u.current.style.display="flex")},1e3);return()=>{clearTimeout(p)}},[i._id]),b.useEffect(()=>{if(!(!m.current||!R.current||!l)){if(l.length<=Q)return I(m.current);if(l[l.length-1].sender!=a._id){if(D)return I(m.current);R.current.scrollTop=300;return}if(H)return H=!1,I(m.current);R.current.scrollTop=300}},[l]);const U=b.useMemo(()=>e.jsx(e.Fragment,{children:Array.isArray(l)&&l.map((p,C)=>{let c;if(p.sender&&p.sender==(a==null?void 0:a._id))c=a.avatar;else{const d=i.participants.find(x=>x._id===p.sender);c=d?d.avatar:""}return e.jsxs("div",{className:`message ${p.sender==(a==null?void 0:a._id)?"own":"guest"}`,children:[e.jsxs("div",{className:"message_wrapper",children:[p.sender!=(a==null?void 0:a._id)&&c&&e.jsx("img",{className:"inchat-avatar",src:c,alt:"Sender Avatar"}),e.jsx("p",{children:p.content})]}),e.jsx("p",{className:"message_timestamp",children:p.timestamp})]},C)})}),[l]);return e.jsxs("div",{id:"chat-box",children:[e.jsxs("div",{id:"chat-box_topbar",className:"flex",children:[e.jsxs("div",{id:"chat-box_topbar_left",children:[e.jsx(te,{userId:a==null?void 0:a._id,participants:i.participants}),e.jsx("button",{className:"btn",onClick:P,children:e.jsx("i",{className:"bx bxs-video"})}),t&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"This room is in a meeting"}),e.jsx("button",{onClick:()=>f(t),children:"Join"})]})]}),e.jsx(de,{})]}),e.jsxs("div",{ref:R,id:"messages-container",children:[e.jsx(q,{onChange:A,children:e.jsx("div",{ref:u,id:"topRef",children:e.jsx(oe,{size:50})})}),U,e.jsx(q,{onChange:p=>{D=p},children:e.jsx("div",{ref:m,children:"."})})]}),e.jsxs("button",{id:"btn_scroll",ref:g,onClick:()=>{m.current&&I(m.current)},children:[Array.isArray(l)&&l.length>1&&l[l.length-1].content,e.jsx("i",{className:"bx bx-down-arrow-alt"})]}),"?",e.jsxs("div",{id:"chat-box_input-container",children:[e.jsx("input",{type:"text",value:v,id:"input_message",onChange:_,onKeyDown:p=>{p.key=="Enter"&&j()}}),e.jsx("button",{onClick:j,className:"btn",children:e.jsx("i",{className:"bx bxs-send"})})]})]})};const me=({token:i,profileData:n,onRefresh:a})=>{const[v,h]=b.useState(!1),[l,o]=b.useState(!1),t=b.useRef(null),s=b.useRef(null),y=b.useRef(null),u=b.useRef(null),m=b.useRef(null),g=G();b.useEffect(()=>{if(i){const f=Y(i);f.on("inv",a),y.current=f}return()=>{var f;(f=y.current)==null||f.disconnect()}},[i]),b.useEffect(()=>{u.current&&(l?u.current.classList.add("active"):u.current.classList.remove("active"))},[l]);const R=()=>{sessionStorage.removeItem("token"),g("/auth")},M=f=>{fetch(`/api/v1/rooms/${f}`,{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({accept:!0})})},_=f=>{fetch(`/api/v1/rooms/${f}`,{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({accept:!1})})},j=async()=>{if(!m.current)return;let f={};if(m.current.bio.value&&(f.bio=m.current.bio.value),m.current.fullname.value&&(f.fullname=m.current.fullname.value),m.current.password.value)if(f.password=m.current.password.value,m.current.current_password.value)f.current_password=m.current.current_password.value;else return alert("Please enter current password");if(s.current&&(f.avatar=s.current),!f.bio&&!f.fullname&&!f.password&&!f.avatar)return alert("Empty form");const w=await fetch("/api/v1/users/",{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify(f)});if(o(!1),w.ok)return alert("Updated successfully!"),a();const E=await w.json();if(E.message)return alert(E.message);alert("Error updating profile")},T=async()=>{if(window.confirm("Are you sure you want to delete your account?")){const w=window.prompt("Enter your password:");if(w!==null)try{const E={password:w},I=await fetch("/api/v1/users/",{method:"DELETE",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify(E)});if(I.ok)sessionStorage.removeItem("token"),alert("You deleted your account successfully"),g("/auth");else{const A=await I.json();A.message?alert(A.message):alert("Wrong password!")}}catch(E){console.error("Error deleting account:",E)}}},P=()=>{var f;if(t.current&&((f=t.current.files)==null?void 0:f.length)>0){const w=new FormData;w.append("file",t.current.files[0]),fetch(`/media/${n==null?void 0:n._id}/public?token=${i}`,{method:"POST",body:w}).then(E=>E.json()).then(E=>{console.log("File upload response:",E),s.current=E.url,j()}).catch(E=>{console.error("Error uploading file:",E)})}};return e.jsxs("div",{id:"profile",children:[e.jsxs("div",{id:"profile_topbar",children:[e.jsx("img",{src:n==null?void 0:n.avatar,alt:"Profile",id:"profile_img",className:"cover"}),l?e.jsxs("label",{id:"btn_upload-img",htmlFor:"upload-img",children:[e.jsx("i",{className:"bx bxs-camera"}),e.jsx("input",{id:"upload-img",type:"file",accept:"image/*",ref:t,onChange:P})]}):e.jsxs("div",{children:[e.jsx("h3",{children:n==null?void 0:n.fullname}),(n==null?void 0:n.bio)&&e.jsx("p",{children:n==null?void 0:n.bio})]}),e.jsxs("div",{className:"flex",children:[l?e.jsx("button",{className:"btn",onClick:()=>o(!1),children:e.jsx("i",{className:"bx bxs-message-square-x"})}):e.jsx("button",{className:"btn",onClick:()=>o(!0),children:e.jsx("i",{className:"bx bxs-pencil"})}),e.jsx("button",{className:"btn",onClick:()=>h(f=>!f),children:v?e.jsx("i",{className:"bx bxs-message-square-x"}):e.jsxs("div",{id:"bell",children:[e.jsx("i",{className:"bx bxs-bell"}),n!=null&&n.invitations.length&&(n==null?void 0:n.invitations.length)>0?e.jsx("span",{id:"nofcount",children:n==null?void 0:n.invitations.length}):null]})}),v&&e.jsx("div",{id:"notify-container",children:n&&n.invitations.length>0?n.invitations.map(f=>e.jsxs("div",{children:[e.jsx("p",{children:f}),e.jsx("button",{onClick:()=>M(f),children:"Accept"}),e.jsx("button",{onClick:()=>_(f),children:"Refuse"})]},f)):e.jsx("p",{children:"No invitations"})}),e.jsx("button",{id:"logout-btn",className:"btn",onClick:R,children:e.jsx("i",{className:"bx bx-log-in"})})]})]}),e.jsxs("div",{ref:u,id:"profile_editor",children:[e.jsxs("form",{id:"profile_form",ref:m,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fullname",children:"Your name:"}),e.jsx("input",{type:"text",id:"fullname",name:"fullname",placeholder:n==null?void 0:n.fullname})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bio",children:"Bio:"}),e.jsx("input",{type:"text",id:"bio",name:"bio",placeholder:n==null?void 0:n.bio})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"current_password",children:"Current password:"}),e.jsx("input",{type:"password",id:"current_password",name:"current_password"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",children:"New password:"}),e.jsx("input",{type:"password",id:"password",name:"password"})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{id:"btn_delete-account",onClick:T,children:"Delete account"}),e.jsx("button",{id:"btn_submit-edit",onClick:j,children:"Save"})]})]})]})},pe=b.memo(me);const ge=({token:i,onChoose:n})=>{const a=b.useRef(null),[v,h]=b.useState([]),l=()=>{var y;const s=(y=a.current)==null?void 0:y.value;s&&fetch(`/api/v1/search/${s}`,{headers:{"content-type":"application/json",authorization:"Bearer "+i}}).then(u=>{if(u.ok)return u.json().then(m=>{h(m)});console.log(u.status)})},o=s=>{s.key==="Enter"&&l()},t=s=>{a.current&&!a.current.contains(s.target)&&(h([]),a.current.value="")};return b.useEffect(()=>(document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}),[]),e.jsxs("div",{id:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search for users...",ref:a,onKeyPress:o}),e.jsx("button",{className:"btn",onClick:l,children:e.jsx("i",{className:"bx bx-search"})}),v.length>0&&e.jsx("div",{id:"search_dropdown",children:v.map(s=>e.jsxs("div",{onClick:()=>{n({_id:s._id,fullname:s.fullname})},children:[e.jsx("img",{className:"profile-picture",src:s.avatar,alt:"Avatar"}),s.fullname]},s._id))})]})};const be=({token:i})=>{const[n,a]=b.useState([]),v=o=>{if(n.some(t=>t._id==o._id))return alert("already selected this user");a(t=>[...t,o])},h=o=>{console.log("remove user from users list"),o>=0&&o<n.length&&a(t=>t.filter((y,u)=>u!==o))},l=async()=>{if(n.length==0)return alert("Please select a user");const o=n.map(t=>t._id);try{(await fetch("/api/v1/rooms",{method:"POST",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({invited:o})})).ok?a([]):alert("deo biet sao bug luon")}catch(t){console.error(t)}};return e.jsxs("div",{id:"room-maker",children:[e.jsx(ge,{token:i,onChoose:v}),n.length>0&&e.jsxs("div",{className:"flex",children:[e.jsx("div",{id:"chosenList",className:"flex",children:n.map((o,t)=>e.jsxs("div",{className:"chosenUser flex",children:[e.jsxs("p",{children:[" ",o.fullname]}),e.jsx("span",{onClick:()=>h(t),children:"X"})]},o.fullname))}),e.jsx("button",{className:"btn",onClick:l,children:e.jsx("i",{className:"bx bxs-message-square-add"})})]})]})};function xe(){return e.jsxs("svg",{id:"bgrn-svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 700 700",preserveAspectRatio:"none",children:[e.jsxs("g",{mask:'url("#SvgjsMask1020")',fill:"none",children:[e.jsx("rect",{width:"700",height:"700",x:"0",y:"0",fill:'url("#SvgjsLinearGradient1021")'}),e.jsx("path",{d:"M700 0L426.65 0L700 81.54z",fill:"rgba(255, 255, 255, 0.2)"}),e.jsx("path",{d:"M426.65 0L700 81.54L700 267.52L414.62 0z",fill:"rgba(255, 255, 255, .13)"}),e.jsx("path",{d:"M414.62 0L700 267.52L700 452.46L156.39 0z",fill:"rgba(255, 255, 255, .1)"}),e.jsx("path",{d:"M156.39 0L700 452.46L700 490.96L83.34999999999998 0z",fill:"rgba(255, 255, 255, .1)"}),e.jsx("path",{d:"M0 700L154.99 700L0 376.93z",fill:"rgba(0, 0, 0, .1)"}),e.jsx("path",{d:"M0 376.93L154.99 700L303.17 700L0 371.8z",fill:"rgba(0, 0, 0, .175)"}),e.jsx("path",{d:"M0 371.8L303.17 700L525.89 700L0 229.98000000000002z",fill:"rgba(0, 0, 0, .25)"}),e.jsx("path",{d:"M0 229.98000000000002L525.89 700L592.96 700L0 184.46z",fill:"rgba(0, 0, 0, .325)"})]}),e.jsxs("defs",{children:[e.jsx("mask",{id:"SvgjsMask1020",children:e.jsx("rect",{width:"700",height:"700",fill:"#ffffff"})}),e.jsxs("linearGradient",{x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"userSpaceOnUse",id:"SvgjsLinearGradient1021",children:[e.jsx("stop",{id:"stop_1",offset:"0"}),e.jsx("stop",{id:"stop_2",offset:"1"})]})]})]})}const ee=i=>fetch("/api/v1/users/",{method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer "+i}}).then(n=>{if(n.ok)return n.json();throw n.status==401&&(alert("Token expired"),sessionStorage.removeItem("token"),window.location.reload()),new Error("Failed to fetch user profile")}),je=({token:i})=>{const[n,a]=b.useState(null),[v,h]=b.useState([]),[l,o]=b.useState(0),t=G(),s=async()=>{try{const m=await ee(i);a(m)}catch{t("/auth")}},y=m=>{o(m)},u=m=>{h(m)};return b.useEffect(()=>{i&&ee(i).then(m=>{a(m)}).catch(m=>{console.error(m),t("/auth")})},[i]),e.jsx("div",{id:"main-page",className:"flex",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"main-page_container",children:[e.jsxs("section",{id:"section-left",children:[e.jsx(pe,{token:i,profileData:n,onRefresh:s}),e.jsx(be,{token:i}),e.jsx(le,{userId:n._id,currentRoomIndex:l,token:i,onRoomChange:y,onUpdateStatus:u})]}),e.jsx("section",{id:"section-right",children:v.length>0&&e.jsx(fe,{profile:n,token:i,room:v[l]})})]}),e.jsx(xe,{})]}):e.jsx("div",{children:"Loading skeleton ..."})})};export{je as default,ee as getProfile};
