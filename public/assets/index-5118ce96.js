import{r as b,j as e,u as $,a as ne,c as se,g as re,P as ie}from"./index-ec45066b.js";import{g as J}from"./getSocket-3ac81373.js";const oe=({participants:o,userId:r})=>{if(o=o.filter(d=>d._id!==r),o.length==0)return null;const l=o.length>1,v=o.slice(0,4);return e.jsx("div",{className:"card",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"group-pictures-container",children:v.map((d,x)=>e.jsx("div",{className:"profile",children:e.jsx("img",{src:d.avatar,alt:"Profile",className:"group-profile-picture"})},x))}),e.jsxs("div",{className:"profile-names",children:[v.length>0&&e.jsx("h3",{children:v.map(d=>d.fullname).join(", ")}),o.length>4&&e.jsxs("p",{className:"group-members-count",children:["+",o.length-4," more"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:o[0].avatar,alt:"Profile",className:"profile-picture"}),e.jsxs("h3",{children:[o[0].fullname+"  ",e.jsx("span",{className:o[0].isOnline?"online":"offline",children:"â€¢"})]}),o[0].bio&&e.jsx("p",{children:o[0].bio})]})})},ee=b.memo(oe);const H=o=>new Promise((r,l)=>{fetch("/api/v1/rooms",{method:"GET",headers:{"content-type":"application/json",authorization:"Bearer "+o}}).then(v=>{if(v.ok)return v.json().then(d=>{r(d)});throw v.status==401&&(alert("Token expired"),sessionStorage.removeItem("token")),new Error("Failed to fetch rooms information")}).catch(v=>{l(v)})}),ae=({userId:o,currentRoomIndex:r,token:l,onRoomChange:v,onUpdateStatus:d})=>{const[x,s]=b.useState([]),t=b.useRef(""),i=b.useRef(null),y=$(),p=j=>{const _=j;"onl"+_!=t.current&&(t.current="onl"+_,s(C=>C&&C.map(N=>{const g=N.participants.map(w=>w._id===_?{...w,isOnline:!0}:w);return{...N,participants:g}})))},f=j=>{const _=j;"off"+_!=t.current&&(t.current="off"+_,s(C=>C&&C.map(N=>{const g=N.participants.map(w=>w._id===_?{...w,isOnline:!1}:w);return{...N,participants:g}})))},h=()=>{H(l).then(j=>{s(j)}).catch(()=>{y("/auth")})},M=j=>{var C,N;const _=document.querySelectorAll(".chat-room");_==null||_.forEach(g=>{var w;(w=g.classList)==null||w.remove("active")}),(N=(C=_[j])==null?void 0:C.classList)==null||N.add("active"),v(j)};b.useEffect(()=>{x.length>0&&d(x)},[x]),b.useEffect(()=>(l&&H(l).then(j=>{s(j);const _=J(l);_.on("onl",p),_.on("off",f),_.on("room",h),i.current=_}).catch(()=>{y("/auth")}),()=>{var j;(j=i.current)==null||j.disconnect()}),[l]);const k=b.useMemo(()=>x.map((j,_)=>e.jsx("div",{className:`chat-room ${_==r?"active":""}`,onClick:()=>M(_),children:e.jsx(ee,{userId:o,participants:j.participants})},j._id)),[x]);return e.jsx("div",{id:"rooms-list",children:x&&x.length>0?e.jsx("div",{children:k}):e.jsx("p",{children:"No rooms to display"})})};const le={light:{text:"#000",background:"#d5e356",theme:"#ffffff"},dark:{text:"#ffffff",background:"#000",theme:"#240063"}},ce=()=>{const[o,r]=b.useState(sessionStorage.getItem("theme")||"light");return b.useEffect(()=>{const l=le[o];Object.entries(l).forEach(([v,d])=>{document.documentElement.style.setProperty(`--${v}-color`,d)}),sessionStorage.setItem("theme",o)},[o]),[o,r]},ue=()=>{const[o,r]=ce(),l=o==="light",v=()=>{r(l?"dark":"light")};return e.jsxs("div",{className:"theme-switch-container",children:[e.jsx("input",{type:"checkbox",id:"switcher-input",checked:l,onChange:v}),e.jsxs("label",{className:`switcher-label ${l?"":"active"}`,htmlFor:"switcher-input",children:[e.jsx("i",{className:"fas fa-solid fa-sun"}),e.jsx("span",{className:"switcher-toggler"}),e.jsx("i",{className:"fas fa-solid fa-moon"})]})]})};var te={exports:{}};(function(o,r){(function(v,d){o.exports=d(b,ne)})(se,function(l,v){return function(d){var x={};function s(t){if(x[t])return x[t].exports;var i=x[t]={i:t,l:!1,exports:{}};return d[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=d,s.c=x,s.d=function(t,i,y){s.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:y})},s.r=function(t){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,i){if(i&1&&(t=s(t)),i&8||i&4&&typeof t=="object"&&t&&t.__esModule)return t;var y=Object.create(null);if(s.r(y),Object.defineProperty(y,"default",{enumerable:!0,value:t}),i&2&&typeof t!="string")for(var p in t)s.d(y,p,(function(f){return t[f]}).bind(null,p));return y},s.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.p="",s(s.s=4)}([function(d,x,s){d.exports=s(5)()},function(d,x){d.exports=l},function(d,x){d.exports=v},function(d,x){d.exports=function(s,t,i){var y=s.direction,p=s.value;switch(y){case"top":return i.top+p<t.top&&i.bottom>t.bottom&&i.left<t.left&&i.right>t.right;case"left":return i.left+p<t.left&&i.bottom>t.bottom&&i.top<t.top&&i.right>t.right;case"bottom":return i.bottom-p>t.bottom&&i.left<t.left&&i.right>t.right&&i.top<t.top;case"right":return i.right-p>t.right&&i.left<t.left&&i.top<t.top&&i.bottom>t.bottom}}},function(d,x,s){s.r(x),s.d(x,"default",function(){return u});var t=s(1),i=s.n(t),y=s(2),p=s.n(y),f=s(0),h=s.n(f),M=s(3),k=s.n(M);function j(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?j=function(m){return typeof m}:j=function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},j(a)}function _(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")}function C(a,c){for(var m=0;m<c.length;m++){var n=c[m];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function N(a,c,m){return c&&C(a.prototype,c),m&&C(a,m),a}function g(a,c){return c&&(j(c)==="object"||typeof c=="function")?c:S(a)}function w(a){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(m){return m.__proto__||Object.getPrototypeOf(m)},w(a)}function S(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function U(a,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),c&&L(a,c)}function L(a,c){return L=Object.setPrototypeOf||function(n,I){return n.__proto__=I,n},L(a,c)}function R(a,c,m){return c in a?Object.defineProperty(a,c,{value:m,enumerable:!0,configurable:!0,writable:!0}):a[c]=m,a}function A(a){return a.width===void 0&&(a.width=a.right-a.left),a.height===void 0&&(a.height=a.bottom-a.top),a}var u=function(a){U(c,a);function c(m){var n;return _(this,c),n=g(this,w(c).call(this,m)),R(S(n),"getContainer",function(){return n.props.containment||window}),R(S(n),"addEventListener",function(I,E,T,F){n.debounceCheck||(n.debounceCheck={});var O,V,z=function(){O=null,n.check()};F>-1?V=function(){O||(O=setTimeout(z,F||0))}:V=function(){clearTimeout(O),O=setTimeout(z,T||0)};var W={target:I,fn:V,getLastTimeout:function(){return O}};I.addEventListener(E,W.fn),n.debounceCheck[E]=W}),R(S(n),"startWatching",function(){n.debounceCheck||n.interval||(n.props.intervalCheck&&(n.interval=setInterval(n.check,n.props.intervalDelay)),n.props.scrollCheck&&n.addEventListener(n.getContainer(),"scroll",n.props.scrollDelay,n.props.scrollThrottle),n.props.resizeCheck&&n.addEventListener(window,"resize",n.props.resizeDelay,n.props.resizeThrottle),!n.props.delayedCall&&n.check())}),R(S(n),"stopWatching",function(){if(n.debounceCheck){for(var I in n.debounceCheck)if(n.debounceCheck.hasOwnProperty(I)){var E=n.debounceCheck[I];clearTimeout(E.getLastTimeout()),E.target.removeEventListener(I,E.fn),n.debounceCheck[I]=null}}n.debounceCheck=null,n.interval&&(n.interval=clearInterval(n.interval))}),R(S(n),"check",function(){var I=n.node,E,T;if(!I)return n.state;if(E=A(n.roundRectDown(I.getBoundingClientRect())),n.props.containment){var F=n.props.containment.getBoundingClientRect();T={top:F.top,left:F.left,bottom:F.bottom,right:F.right}}else T={top:0,left:0,bottom:window.innerHeight||document.documentElement.clientHeight,right:window.innerWidth||document.documentElement.clientWidth};var O=n.props.offset||{},V=j(O)==="object";V&&(T.top+=O.top||0,T.left+=O.left||0,T.bottom-=O.bottom||0,T.right-=O.right||0);var z={top:E.top>=T.top,left:E.left>=T.left,bottom:E.bottom<=T.bottom,right:E.right<=T.right},W=E.height>0&&E.width>0,B=W&&z.top&&z.left&&z.bottom&&z.right;if(W&&n.props.partialVisibility){var G=E.top<=T.bottom&&E.bottom>=T.top&&E.left<=T.right&&E.right>=T.left;typeof n.props.partialVisibility=="string"&&(G=z[n.props.partialVisibility]),B=n.props.minTopValue?G&&E.top<=T.bottom-n.props.minTopValue:G}typeof O.direction=="string"&&typeof O.value=="number"&&(console.warn("[notice] offset.direction and offset.value have been deprecated. They still work for now, but will be removed in next major version. Please upgrade to the new syntax: { %s: %d }",O.direction,O.value),B=k()(O,E,T));var K=n.state;return n.state.isVisible!==B&&(K={isVisible:B,visibilityRect:z},n.setState(K),n.props.onChange&&n.props.onChange(B)),K}),n.state={isVisible:null,visibilityRect:{}},n}return N(c,[{key:"componentDidMount",value:function(){this.node=p.a.findDOMNode(this),this.props.active&&this.startWatching()}},{key:"componentWillUnmount",value:function(){this.stopWatching()}},{key:"componentDidUpdate",value:function(n){this.node=p.a.findDOMNode(this),this.props.active&&!n.active?(this.setState({isVisible:null,visibilityRect:{}}),this.startWatching()):this.props.active||this.stopWatching()}},{key:"roundRectDown",value:function(n){return{top:Math.floor(n.top),left:Math.floor(n.left),bottom:Math.floor(n.bottom),right:Math.floor(n.right)}}},{key:"render",value:function(){return this.props.children instanceof Function?this.props.children({isVisible:this.state.isVisible,visibilityRect:this.state.visibilityRect}):i.a.Children.only(this.props.children)}}]),c}(i.a.Component);R(u,"defaultProps",{active:!0,partialVisibility:!1,minTopValue:0,scrollCheck:!1,scrollDelay:250,scrollThrottle:-1,resizeCheck:!1,resizeDelay:250,resizeThrottle:-1,intervalCheck:!0,intervalDelay:100,delayedCall:!1,offset:{},containment:null,children:i.a.createElement("span",null)}),R(u,"propTypes",{onChange:h.a.func,active:h.a.bool,partialVisibility:h.a.oneOfType([h.a.bool,h.a.oneOf(["top","right","bottom","left"])]),delayedCall:h.a.bool,offset:h.a.oneOfType([h.a.shape({top:h.a.number,left:h.a.number,bottom:h.a.number,right:h.a.number}),h.a.shape({direction:h.a.oneOf(["top","right","bottom","left"]),value:h.a.number})]),scrollCheck:h.a.bool,scrollDelay:h.a.number,scrollThrottle:h.a.number,resizeCheck:h.a.bool,resizeDelay:h.a.number,resizeThrottle:h.a.number,intervalCheck:h.a.bool,intervalDelay:h.a.number,containment:typeof window<"u"?h.a.instanceOf(window.Element):h.a.any,children:h.a.oneOfType([h.a.element,h.a.func]),minTopValue:h.a.number})},function(d,x,s){var t=s(6);function i(){}function y(){}y.resetWarningCache=i,d.exports=function(){function p(M,k,j,_,C,N){if(N!==t){var g=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw g.name="Invariant Violation",g}}p.isRequired=p;function f(){return p}var h={array:p,bool:p,func:p,number:p,object:p,string:p,symbol:p,any:p,arrayOf:f,element:p,elementType:p,instanceOf:f,node:p,objectOf:f,oneOf:f,oneOfType:f,shape:f,exact:f,checkPropTypes:y,resetWarningCache:i};return h.PropTypes=h,h}},function(d,x,s){var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";d.exports=t}])})})(te);var de=te.exports;const Y=re(de);let P,D,X;const q=30,Q=(o,r,l,v)=>fetch(`/api/v1/rooms/${o}?limit=${l}&skip=${v}`,{method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer "+r}}).then(d=>{if(d.status===304)throw new Error("Already got this");if(d.ok)return d.json();throw d.status==401&&(alert("Token expired"),sessionStorage.removeItem("token")),new Error("Failed to fetch messages")}),he=({room:o,token:r,profile:l})=>{let v;const[d,x]=b.useState(""),[s,t]=b.useState(null),[i,y]=b.useState(),p=b.useRef(o._id),f=b.useRef(null),h=b.useRef(null),M=b.useRef(null),k=b.useRef(null),j=$(),_=u=>{x(u.target.value),console.log("typing ...")},C=()=>{d.trim()!==""&&(P==null||P.emit("msg",[o._id,d,new Date]),D=!0,x(""))},N=u=>{if(u[1]===p.current){const a=u[0];if(a!==(l==null?void 0:l._id)&&!o.participants.some(n=>n._id===a))return;M.current&&(console.log("thissssssssss"),M.current.style.display="block");const c=u[2],m=u[3];v++,t(n=>n!==null?[...n,{sender:a,content:c,timestamp:m}]:[{sender:a,content:c,timestamp:m}])}else console.log("New message, room: "+u[1])},g=()=>{P==null||P.emit("meet",[o._id,new Date])},w=u=>{const a=`/meet/${u}?token=${r}&room=${o._id}`;window.open(a)},S=u=>{if(u[1]==o._id&&y(u[2]),u[0]==(l==null?void 0:l._id))return u[3]?void 0:w(u[2]);Notification.permission==="granted"?new Notification("Incoming Call",{body:"You have an incoming call. Do you want to join?",icon:"path/to/notification-icon.png",requireInteraction:!0}).addEventListener("click",()=>{w(u[2])}):Notification.permission!=="denied"&&Notification.requestPermission().then(a=>{a==="granted"&&S(u)})},U=()=>{y(null)},L=u=>{u.scrollIntoView({behavior:"smooth"}),M.current&&(M.current.style.display="none")};b.useEffect(()=>{try{if(!r||!o)return;Q(o._id,r).then(u=>{t(u.messages),u.conversationLength&&(v=u.conversationLength),u.meeting_uuid?y(u.meeting_uuid):y(null)}).catch(()=>{j("/auth")})}catch(u){console.error(u)}},[r,o._id]),b.useEffect(()=>{r&&(P=J(r),P==null||P.on("msg",N),P==null||P.on("meet",S),P==null||P.on("end_meet",U))},[r]),b.useEffect(()=>{p.current=o._id,f.current&&(f.current.style.display="none");const u=setTimeout(()=>{f.current&&k.current&&k.current.scrollHeight>k.current.clientHeight&&(f.current.style.display="flex")},1e3);return()=>{clearTimeout(u)}},[o._id]),b.useEffect(()=>{if(!(!h.current||!k.current||!s)){if(s.length<=q)return L(h.current);if(s[s.length-1].sender!=l._id){if(X)return L(h.current);k.current.scrollTop=300;return}if(D)return D=!1,L(h.current)}},[s]);const R=b.useMemo(()=>e.jsx(e.Fragment,{children:Array.isArray(s)&&s.map((u,a)=>{let c;if(u.sender&&u.sender==(l==null?void 0:l._id))c=l.avatar;else{const m=o.participants.find(n=>n._id===u.sender);c=m?m.avatar:""}return e.jsxs("div",{className:`message ${u.sender==(l==null?void 0:l._id)?"own":""}`,children:[e.jsxs("div",{className:"message_wrapper",children:[u.sender!=(l==null?void 0:l._id)&&c&&e.jsx("img",{className:"inchat-avatar",src:c,alt:"Sender Avatar"}),e.jsx("p",{children:u.content})]}),e.jsx("p",{className:"message_timestamp",children:u.timestamp})]},a)})}),[s]),A=u=>{if(!u||!s||s.length==0)return;if(s.length>=v){f.current&&(f.current.style.display="none");return}let a,c=q;a=v-s.length-c,a<0&&(c+=a,a=0),Q(o._id,r,`${c}`,`${a}`).then(m=>{t(n=>n?m.messages.concat(n):m.messages),m.conversationLength&&(v=m.conversationLength),m.meeting_uuid?y(m.meeting_uuid):y(null)}).catch(()=>{j("/auth")})};return e.jsxs("div",{id:"chat-box",children:[e.jsxs("div",{id:"chat-box_topbar",className:"flex",children:[e.jsxs("div",{id:"chat-box_topbar_left",children:[e.jsx(ee,{userId:l==null?void 0:l._id,participants:o.participants}),e.jsx("button",{className:"btn",onClick:g,children:e.jsx("i",{className:"bx bxs-video"})}),i&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"This room is in a meeting"}),e.jsx("button",{onClick:()=>w(i),children:"Join"})]})]}),e.jsx(ue,{})]}),e.jsxs("div",{ref:k,id:"messages-container",children:[e.jsx(Y,{onChange:A,children:e.jsx("div",{ref:f,id:"topRef",children:e.jsx(ie,{size:50})})}),R,e.jsx(Y,{onChange:u=>{X=u},children:e.jsx("div",{ref:h,children:"."})})]}),e.jsxs("button",{id:"btn_scroll",ref:M,onClick:()=>{h.current&&L(h.current)},children:[s&&s[s.length-1].content," ",e.jsx("i",{className:"bx bx-down-arrow-alt"})]}),e.jsx("img",{id:"chat-box_bg",src:"/assets/img/img_new/pattern.png"}),e.jsxs("div",{id:"chat-box_input-container",children:[e.jsx("input",{type:"text",value:d,id:"input_message",onChange:_,onKeyDown:u=>{u.key=="Enter"&&C()}}),e.jsx("button",{onClick:C,className:"btn",children:e.jsx("i",{className:"bx bxs-send"})})]})]})};const fe=({token:o,profileData:r,onRefresh:l})=>{const[v,d]=b.useState(!1),[x,s]=b.useState(!1),t=b.useRef(null),i=b.useRef(null),y=b.useRef(null),p=b.useRef(null),f=b.useRef(null),h=$();b.useEffect(()=>{if(o){const g=J(o);g.on("inv",l),y.current=g}return()=>{var g;(g=y.current)==null||g.disconnect()}},[o]),b.useEffect(()=>{p.current&&(x?p.current.classList.add("active"):p.current.classList.remove("active"))},[x]);const M=()=>{sessionStorage.removeItem("token"),h("/auth")},k=g=>{fetch(`/api/v1/rooms/${g}`,{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify({accept:!0})})},j=g=>{fetch(`/api/v1/rooms/${g}`,{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify({accept:!1})})},_=async()=>{if(!f.current)return;let g={};if(f.current.bio.value&&(g.bio=f.current.bio.value),f.current.fullname.value&&(g.fullname=f.current.fullname.value),f.current.password.value)if(g.password=f.current.password.value,f.current.current_password.value)g.current_password=f.current.current_password.value;else return alert("Please enter current password");if(i.current&&(g.avatar=i.current),!g.bio&&!g.fullname&&!g.password&&!g.avatar)return alert("Empty form");const w=await fetch("/api/v1/users/",{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify(g)});if(s(!1),w.ok)return alert("Updated successfully!"),l();const S=await w.json();if(S.message)return alert(S.message);alert("Error updating profile")},C=async()=>{if(window.confirm("Are you sure you want to delete your account?")){const w=window.prompt("Enter your password:");if(w!==null)try{const S={password:w},U=await fetch("/api/v1/users/",{method:"DELETE",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify(S)});if(U.ok)sessionStorage.removeItem("token"),alert("You deleted your account successfully"),h("/auth");else{const L=await U.json();L.message?alert(L.message):alert("Wrong password!")}}catch(S){console.error("Error deleting account:",S)}}},N=()=>{if(t!=null&&t.current&&t.current.length>0){const g=t.current.files[0],w=new FileReader;w.onload=async S=>{var U;if((U=S.target)!=null&&U.result){const L=new Image;L.onload=async()=>{const R=document.createElement("canvas"),A=200,u=200;let a=L.width,c=L.height;a>A&&(c*=A/a,a=A),c>u&&(a*=u/c,c=u),R.width=a,R.height=c;const m=R.getContext("2d");m==null||m.drawImage(L,0,0,a,c);const n=R.toDataURL("image/jpeg");i.current=n},L.src=S.target.result}},w.readAsDataURL(g)}};return e.jsxs("div",{id:"profile",children:[e.jsxs("div",{id:"profile_topbar",children:[e.jsx("img",{src:r==null?void 0:r.avatar,alt:"Profile",id:"profile_img",className:"cover"}),x?e.jsxs("label",{id:"btn_upload-img",htmlFor:"upload-img",children:[e.jsx("i",{className:"bx bxs-camera"}),e.jsx("input",{id:"upload-img",type:"file",accept:"image/*",ref:t,onChange:N})]}):e.jsxs("div",{children:[e.jsx("h3",{children:r==null?void 0:r.fullname}),(r==null?void 0:r.bio)&&e.jsx("p",{children:r==null?void 0:r.bio})]}),e.jsxs("div",{className:"flex",children:[x?e.jsx("button",{className:"btn",onClick:()=>s(!1),children:e.jsx("i",{className:"bx bxs-message-square-x"})}):e.jsx("button",{className:"btn",onClick:()=>s(!0),children:e.jsx("i",{className:"bx bxs-pencil"})}),e.jsx("button",{className:"btn",onClick:()=>d(g=>!g),children:v?e.jsx("i",{className:"bx bxs-message-square-x"}):e.jsxs("div",{id:"bell",children:[e.jsx("i",{className:"bx bxs-bell"}),r!=null&&r.invitations.length&&(r==null?void 0:r.invitations.length)>0?e.jsx("span",{id:"nofcount",children:r==null?void 0:r.invitations.length}):null]})}),v&&e.jsx("div",{id:"notify-container",children:r&&r.invitations.length>0?r.invitations.map(g=>e.jsxs("div",{children:[e.jsx("p",{children:g}),e.jsx("button",{onClick:()=>k(g),children:"Accept"}),e.jsx("button",{onClick:()=>j(g),children:"Refuse"})]},g)):e.jsx("p",{children:"No invitations"})}),e.jsx("button",{id:"logout-btn",className:"btn",onClick:M,children:e.jsx("i",{className:"bx bx-log-in"})})]})]}),e.jsxs("div",{ref:p,id:"profile_editor",children:[e.jsxs("form",{id:"profile_form",ref:f,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fullname",children:"Your name:"}),e.jsx("input",{type:"text",id:"fullname",name:"fullname",placeholder:r==null?void 0:r.fullname})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bio",children:"Bio:"}),e.jsx("input",{type:"text",id:"bio",name:"bio",placeholder:r==null?void 0:r.bio})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"current_password",children:"Current password:"}),e.jsx("input",{type:"password",id:"current_password",name:"current_password"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",children:"New password:"}),e.jsx("input",{type:"password",id:"password",name:"password"})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{id:"btn_delete-account",onClick:C,children:"Delete account"}),e.jsx("button",{id:"btn_submit-edit",onClick:_,children:"Save"})]})]})]})},me=b.memo(fe);const pe=({token:o,onChoose:r})=>{const l=b.useRef(null),[v,d]=b.useState([]),x=()=>{var y;const i=(y=l.current)==null?void 0:y.value;i&&fetch(`/api/v1/search/${i}`,{headers:{"content-type":"application/json",authorization:"Bearer "+o}}).then(p=>{if(p.ok)return p.json().then(f=>{d(f)});console.log(p.status)})},s=i=>{i.key==="Enter"&&x()},t=i=>{l.current&&!l.current.contains(i.target)&&(d([]),l.current.value="")};return b.useEffect(()=>(document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}),[]),e.jsxs("div",{id:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search for users...",ref:l,onKeyPress:s}),e.jsx("button",{className:"btn",onClick:x,children:e.jsx("i",{className:"bx bx-search"})}),v.length>0&&e.jsx("div",{id:"search_dropdown",children:v.map(i=>e.jsxs("div",{onClick:()=>{r({_id:i._id,fullname:i.fullname})},children:[e.jsx("img",{className:"profile-picture",src:i.avatar,alt:"Avatar"}),i.fullname]},i._id))})]})};const ge=({token:o})=>{const[r,l]=b.useState([]),v=s=>{if(r.some(t=>t._id==s._id))return alert("already selected this user");l(t=>[...t,s])},d=s=>{console.log("remove user from users list"),s>=0&&s<r.length&&l(t=>t.filter((y,p)=>p!==s))},x=async()=>{if(r.length==0)return alert("Please select a user");const s=r.map(t=>t._id);try{(await fetch("/api/v1/rooms",{method:"POST",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify({invited:s})})).ok?l([]):alert("deo biet sao bug luon")}catch(t){console.error(t)}};return e.jsxs("div",{id:"room-maker",children:[e.jsx(pe,{token:o,onChoose:v}),r.length>0&&e.jsxs("div",{className:"flex",children:[e.jsx("div",{id:"chosenList",className:"flex",children:r.map((s,t)=>e.jsxs("div",{className:"chosenUser flex",children:[e.jsxs("p",{children:[" ",s.fullname]}),e.jsx("span",{onClick:()=>d(t),children:"X"})]},s.fullname))}),e.jsx("button",{className:"btn",onClick:x,children:e.jsx("i",{className:"bx bxs-message-square-add"})})]})]})};function be(){return e.jsxs("svg",{id:"bgrn-svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 700 700",preserveAspectRatio:"none",children:[e.jsxs("g",{mask:'url("#SvgjsMask1020")',fill:"none",children:[e.jsx("rect",{width:"700",height:"700",x:"0",y:"0",fill:'url("#SvgjsLinearGradient1021")'}),e.jsx("path",{d:"M700 0L426.65 0L700 81.54z",fill:"rgba(255, 255, 255, 0.2)"}),e.jsx("path",{d:"M426.65 0L700 81.54L700 267.52L414.62 0z",fill:"rgba(255, 255, 255, .13)"}),e.jsx("path",{d:"M414.62 0L700 267.52L700 452.46L156.39 0z",fill:"rgba(255, 255, 255, .1)"}),e.jsx("path",{d:"M156.39 0L700 452.46L700 490.96L83.34999999999998 0z",fill:"rgba(255, 255, 255, .1)"}),e.jsx("path",{d:"M0 700L154.99 700L0 376.93z",fill:"rgba(0, 0, 0, .1)"}),e.jsx("path",{d:"M0 376.93L154.99 700L303.17 700L0 371.8z",fill:"rgba(0, 0, 0, .175)"}),e.jsx("path",{d:"M0 371.8L303.17 700L525.89 700L0 229.98000000000002z",fill:"rgba(0, 0, 0, .25)"}),e.jsx("path",{d:"M0 229.98000000000002L525.89 700L592.96 700L0 184.46z",fill:"rgba(0, 0, 0, .325)"})]}),e.jsxs("defs",{children:[e.jsx("mask",{id:"SvgjsMask1020",children:e.jsx("rect",{width:"700",height:"700",fill:"#ffffff"})}),e.jsxs("linearGradient",{x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"userSpaceOnUse",id:"SvgjsLinearGradient1021",children:[e.jsx("stop",{id:"stop_1",offset:"0"}),e.jsx("stop",{id:"stop_2",offset:"1"})]})]})]})}const Z=o=>fetch("/api/v1/users/",{method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer "+o}}).then(r=>{if(r.ok)return r.json();throw r.status==401&&(alert("Token expired"),sessionStorage.removeItem("token"),window.location.reload()),new Error("Failed to fetch user profile")}),ye=({token:o})=>{const[r,l]=b.useState(null),[v,d]=b.useState([]),[x,s]=b.useState(0),t=$(),i=async()=>{try{const f=await Z(o);l(f)}catch{t("/auth")}},y=f=>{s(f)},p=f=>{d(f)};return b.useEffect(()=>{o&&Z(o).then(f=>{l(f)}).catch(f=>{console.error(f),t("/auth")})},[o]),e.jsx("div",{id:"main-page",className:"flex",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"main-page_container",children:[e.jsxs("section",{id:"section-left",children:[e.jsx(me,{token:o,profileData:r,onRefresh:i}),e.jsx(ge,{token:o}),e.jsx(ae,{userId:r._id,currentRoomIndex:x,token:o,onRoomChange:y,onUpdateStatus:p})]}),e.jsx("section",{id:"section-right",children:v.length>0&&e.jsx(he,{profile:r,token:o,room:v[x]})})]}),e.jsx(be,{})]}):e.jsx("div",{children:"Loading skeleton ..."})})};export{ye as default,Z as getProfile};
