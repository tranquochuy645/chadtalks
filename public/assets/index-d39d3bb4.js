import{r as g,j as e,u as F,a as D,c as ee,g as te,P as ne}from"./index-f651cea7.js";import{u as B,S as se}from"./index-0c6c8f05.js";const re=({participants:o,userId:n})=>{if(o=o.filter(a=>a._id!==n),o.length==0)return null;const c=o.length>1,u=o.slice(0,4);return e.jsx("div",{className:"card",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"group-pictures-container",children:u.map((a,d)=>e.jsx("div",{className:"profile",children:e.jsx("img",{src:a.avatar,alt:"Profile",className:"group-profile-picture"})},d))}),e.jsxs("div",{className:"profile-names",children:[u.length>0&&e.jsx("h3",{children:u.map(a=>a.fullname).join(", ")}),o.length>4&&e.jsxs("p",{className:"group-members-count",children:["+",o.length-4," more"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:o[0].avatar,alt:"Profile",className:"profile-picture"}),e.jsxs("h3",{children:[o[0].fullname+"  ",e.jsx("span",{className:o[0].isOnline?"online":"offline",children:"â€¢"})]}),o[0].bio&&e.jsx("p",{children:o[0].bio})]})})},q=g.memo(re);const J=o=>new Promise((n,c)=>{fetch("/api/v1/rooms",{method:"GET",headers:{"content-type":"application/json",authorization:"Bearer "+o}}).then(u=>{if(u.ok)return u.json().then(a=>{n(a)});throw u.status==401&&(alert("Token expired"),sessionStorage.removeItem("token")),new Error("Failed to fetch rooms information")}).catch(u=>{c(u)})}),ie=({userId:o,currentRoomIndex:n,token:c,onRoomChange:u,onUpdateStatus:a})=>{const[d,r]=g.useState([]),t=B(),s=F(),f=C=>{const x=C;r(l=>l&&l.map(_=>{const y=_.participants.map(j=>j._id===x?{...j,isOnline:!0}:j);return{..._,participants:y}}))},h=C=>{const x=C;r(l=>l&&l.map(_=>{const y=_.participants.map(j=>j._id===x?{...j,isOnline:!1}:j);return{..._,participants:y}}))},p=C=>{console.log("set meet"),r(x=>x&&x.map(l=>l._id===C[1]?{...l,isMeeting:!0,meeting_uuid:C[2]}:l))},m=C=>{console.log("set end meet"),r(x=>x&&x.map(l=>l._id===C[0]&&l.isMeeting?{...l,isMeeting:!1,meeting_uuid:null}:l))},L=()=>{J(c).then(C=>{r(C)}).catch(()=>{s("/auth")})},O=C=>{var l,_;const x=document.querySelectorAll(".chat-room");x==null||x.forEach(y=>{var j;(j=y.classList)==null||j.remove("active")}),(_=(l=x[C])==null?void 0:l.classList)==null||_.add("active"),u(C)};g.useEffect(()=>{d.length>0&&a(d)},[d]),g.useEffect(()=>{if(t)return t.on("onl",f),t.on("off",h),t.on("meet",p),t.on("end_meet",m),t.on("room",L),()=>{t.off("onl",f),t.off("off",h),t.off("meet",p),t.off("end_meet",m),t.off("room",L)}},[t]),g.useEffect(()=>{J(c).then(C=>{r(C)}).catch(()=>{s("/auth")})},[]);const N=g.useMemo(()=>d.map((C,x)=>e.jsx("div",{className:`chat-room ${x==n?"active":""}`,onClick:()=>O(x),children:e.jsx(q,{userId:o,participants:C.participants})},C._id)),[d]);return e.jsx("div",{id:"rooms-list",children:d&&d.length>0?e.jsx("div",{children:N}):e.jsx("p",{children:"No rooms to display"})})};const K=({onChange:o,accept:n,id:c,icon:u})=>{const a=g.useRef(null),d=r=>{if(r.target.files){const t=r.target.files[0];o(t)}};return e.jsxs("label",{id:`btn_${c}`,className:"btn_fileinput",htmlFor:c,children:[u,e.jsx("input",{id:c,className:"fileinput",type:"file",accept:n,ref:a,onChange:d,style:{display:"none"}})]})};const oe=({roomId:o,onJustSent:n})=>{const[c,u]=g.useState(""),a=B(),d=f=>{u(f.target.value),console.log("typing ...")},r=()=>{c.trim()!==""&&(a==null||a.emit("msg",[o,c,new Date]),n(),u(""))},t=f=>{console.log(f)},s=f=>{console.log(f)};return e.jsxs("div",{id:"chat-box_input-container",children:[e.jsx(K,{accept:"image/*",onChange:t,id:"chatbox_upload-img",icon:e.jsx("i",{className:"bx bx-image-add"})}),e.jsx(K,{accept:"*",onChange:s,id:"chatbox_upload-file",icon:e.jsx("i",{className:"bx bx-paperclip"})}),e.jsx("input",{type:"text",value:c,id:"input_message",onChange:d,onKeyDown:f=>{f.key=="Enter"&&r()}}),e.jsx("button",{onClick:r,className:"btn",children:e.jsx("i",{className:"bx bxs-send"})})]})},ae=g.memo(oe);const le={light:{text:"#000",background:"#fff",theme:"#009688"},dark:{text:"#ffffff",background:"#000",theme:"#240063"}},ce=()=>{const[o,n]=g.useState(sessionStorage.getItem("theme")||"light");return g.useEffect(()=>{const c=le[o];Object.entries(c).forEach(([u,a])=>{document.documentElement.style.setProperty(`--${u}-color`,a)}),sessionStorage.setItem("theme",o)},[o]),[o,n]},ue=()=>{const[o,n]=ce(),c=o==="light",u=()=>{n(c?"dark":"light")};return e.jsxs("div",{className:"theme-switch-container",children:[e.jsx("input",{type:"checkbox",id:"switcher-input",checked:c,onChange:u}),e.jsxs("label",{className:`switcher-label ${c?"":"active"}`,htmlFor:"switcher-input",children:[e.jsx("i",{className:"fas fa-solid fa-sun"}),e.jsx("span",{className:"switcher-toggler"}),e.jsx("i",{className:"fas fa-solid fa-moon"})]})]})};const de=({token:o,room:n,userId:c})=>{const u=B(),a=()=>{u.emit("meet",[n._id,new Date])},d=t=>{const s=`/meet/${t}?token=${o}&room=${n._id}`;window.open(s)},r=t=>{if(console.log(t),t[0]==c)return t[3]?void 0:d(t[2]);Notification.permission==="granted"?new Notification("Incoming Call",{body:"You have an incoming call. Do you want to join?",icon:"path/to/notification-icon.png",requireInteraction:!0}).addEventListener("click",()=>{d(t[2])}):Notification.permission!=="denied"&&Notification.requestPermission().then(s=>{s==="granted"&&r(t)})};return g.useEffect(()=>{if(u)return u.on("meet",r),()=>{u.off("meet",r)}},[u,n._id]),e.jsxs("div",{id:"chat-box_topbar",className:"flex",children:[e.jsxs("div",{id:"chat-box_topbar_left",children:[e.jsx(q,{userId:c,participants:n.participants}),e.jsx("button",{className:"btn",onClick:a,children:e.jsx("i",{className:"bx bxs-video"})}),n.isMeeting&&n.meeting_uuid&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"This room is in a meeting"}),e.jsx("button",{onClick:()=>d(n.meeting_uuid),children:"Join"})]})]}),e.jsx(ue,{})]})},fe=g.memo(de);var Q={exports:{}};(function(o,n){(function(u,a){o.exports=a(g,D)})(ee,function(c,u){return function(a){var d={};function r(t){if(d[t])return d[t].exports;var s=d[t]={i:t,l:!1,exports:{}};return a[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=a,r.c=d,r.d=function(t,s,f){r.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:f})},r.r=function(t){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,s){if(s&1&&(t=r(t)),s&8||s&4&&typeof t=="object"&&t&&t.__esModule)return t;var f=Object.create(null);if(r.r(f),Object.defineProperty(f,"default",{enumerable:!0,value:t}),s&2&&typeof t!="string")for(var h in t)r.d(f,h,(function(p){return t[p]}).bind(null,h));return f},r.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(s,"a",s),s},r.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},r.p="",r(r.s=4)}([function(a,d,r){a.exports=r(5)()},function(a,d){a.exports=c},function(a,d){a.exports=u},function(a,d){a.exports=function(r,t,s){var f=r.direction,h=r.value;switch(f){case"top":return s.top+h<t.top&&s.bottom>t.bottom&&s.left<t.left&&s.right>t.right;case"left":return s.left+h<t.left&&s.bottom>t.bottom&&s.top<t.top&&s.right>t.right;case"bottom":return s.bottom-h>t.bottom&&s.left<t.left&&s.right>t.right&&s.top<t.top;case"right":return s.right-h>t.right&&s.left<t.left&&s.top<t.top&&s.bottom>t.bottom}}},function(a,d,r){r.r(d),r.d(d,"default",function(){return V});var t=r(1),s=r.n(t),f=r(2),h=r.n(f),p=r(0),m=r.n(p),L=r(3),O=r.n(L);function N(b){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?N=function(w){return typeof w}:N=function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},N(b)}function C(b,v){if(!(b instanceof v))throw new TypeError("Cannot call a class as a function")}function x(b,v){for(var w=0;w<v.length;w++){var i=v[w];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(b,i.key,i)}}function l(b,v,w){return v&&x(b.prototype,v),w&&x(b,w),b}function _(b,v){return v&&(N(v)==="object"||typeof v=="function")?v:j(b)}function y(b){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(w){return w.__proto__||Object.getPrototypeOf(w)},y(b)}function j(b){if(b===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b}function z(b,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function");b.prototype=Object.create(v&&v.prototype,{constructor:{value:b,writable:!0,configurable:!0}}),v&&A(b,v)}function A(b,v){return A=Object.setPrototypeOf||function(i,k){return i.__proto__=k,i},A(b,v)}function R(b,v,w){return v in b?Object.defineProperty(b,v,{value:w,enumerable:!0,configurable:!0,writable:!0}):b[v]=w,b}function Z(b){return b.width===void 0&&(b.width=b.right-b.left),b.height===void 0&&(b.height=b.bottom-b.top),b}var V=function(b){z(v,b);function v(w){var i;return C(this,v),i=_(this,y(v).call(this,w)),R(j(i),"getContainer",function(){return i.props.containment||window}),R(j(i),"addEventListener",function(k,E,S,I){i.debounceCheck||(i.debounceCheck={});var T,U,P=function(){T=null,i.check()};I>-1?U=function(){T||(T=setTimeout(P,I||0))}:U=function(){clearTimeout(T),T=setTimeout(P,S||0)};var $={target:k,fn:U,getLastTimeout:function(){return T}};k.addEventListener(E,$.fn),i.debounceCheck[E]=$}),R(j(i),"startWatching",function(){i.debounceCheck||i.interval||(i.props.intervalCheck&&(i.interval=setInterval(i.check,i.props.intervalDelay)),i.props.scrollCheck&&i.addEventListener(i.getContainer(),"scroll",i.props.scrollDelay,i.props.scrollThrottle),i.props.resizeCheck&&i.addEventListener(window,"resize",i.props.resizeDelay,i.props.resizeThrottle),!i.props.delayedCall&&i.check())}),R(j(i),"stopWatching",function(){if(i.debounceCheck){for(var k in i.debounceCheck)if(i.debounceCheck.hasOwnProperty(k)){var E=i.debounceCheck[k];clearTimeout(E.getLastTimeout()),E.target.removeEventListener(k,E.fn),i.debounceCheck[k]=null}}i.debounceCheck=null,i.interval&&(i.interval=clearInterval(i.interval))}),R(j(i),"check",function(){var k=i.node,E,S;if(!k)return i.state;if(E=Z(i.roundRectDown(k.getBoundingClientRect())),i.props.containment){var I=i.props.containment.getBoundingClientRect();S={top:I.top,left:I.left,bottom:I.bottom,right:I.right}}else S={top:0,left:0,bottom:window.innerHeight||document.documentElement.clientHeight,right:window.innerWidth||document.documentElement.clientWidth};var T=i.props.offset||{},U=N(T)==="object";U&&(S.top+=T.top||0,S.left+=T.left||0,S.bottom-=T.bottom||0,S.right-=T.right||0);var P={top:E.top>=S.top,left:E.left>=S.left,bottom:E.bottom<=S.bottom,right:E.right<=S.right},$=E.height>0&&E.width>0,M=$&&P.top&&P.left&&P.bottom&&P.right;if($&&i.props.partialVisibility){var W=E.top<=S.bottom&&E.bottom>=S.top&&E.left<=S.right&&E.right>=S.left;typeof i.props.partialVisibility=="string"&&(W=P[i.props.partialVisibility]),M=i.props.minTopValue?W&&E.top<=S.bottom-i.props.minTopValue:W}typeof T.direction=="string"&&typeof T.value=="number"&&(console.warn("[notice] offset.direction and offset.value have been deprecated. They still work for now, but will be removed in next major version. Please upgrade to the new syntax: { %s: %d }",T.direction,T.value),M=O()(T,E,S));var G=i.state;return i.state.isVisible!==M&&(G={isVisible:M,visibilityRect:P},i.setState(G),i.props.onChange&&i.props.onChange(M)),G}),i.state={isVisible:null,visibilityRect:{}},i}return l(v,[{key:"componentDidMount",value:function(){this.node=h.a.findDOMNode(this),this.props.active&&this.startWatching()}},{key:"componentWillUnmount",value:function(){this.stopWatching()}},{key:"componentDidUpdate",value:function(i){this.node=h.a.findDOMNode(this),this.props.active&&!i.active?(this.setState({isVisible:null,visibilityRect:{}}),this.startWatching()):this.props.active||this.stopWatching()}},{key:"roundRectDown",value:function(i){return{top:Math.floor(i.top),left:Math.floor(i.left),bottom:Math.floor(i.bottom),right:Math.floor(i.right)}}},{key:"render",value:function(){return this.props.children instanceof Function?this.props.children({isVisible:this.state.isVisible,visibilityRect:this.state.visibilityRect}):s.a.Children.only(this.props.children)}}]),v}(s.a.Component);R(V,"defaultProps",{active:!0,partialVisibility:!1,minTopValue:0,scrollCheck:!1,scrollDelay:250,scrollThrottle:-1,resizeCheck:!1,resizeDelay:250,resizeThrottle:-1,intervalCheck:!0,intervalDelay:100,delayedCall:!1,offset:{},containment:null,children:s.a.createElement("span",null)}),R(V,"propTypes",{onChange:m.a.func,active:m.a.bool,partialVisibility:m.a.oneOfType([m.a.bool,m.a.oneOf(["top","right","bottom","left"])]),delayedCall:m.a.bool,offset:m.a.oneOfType([m.a.shape({top:m.a.number,left:m.a.number,bottom:m.a.number,right:m.a.number}),m.a.shape({direction:m.a.oneOf(["top","right","bottom","left"]),value:m.a.number})]),scrollCheck:m.a.bool,scrollDelay:m.a.number,scrollThrottle:m.a.number,resizeCheck:m.a.bool,resizeDelay:m.a.number,resizeThrottle:m.a.number,intervalCheck:m.a.bool,intervalDelay:m.a.number,containment:typeof window<"u"?m.a.instanceOf(window.Element):m.a.any,children:m.a.oneOfType([m.a.element,m.a.func]),minTopValue:m.a.number})},function(a,d,r){var t=r(6);function s(){}function f(){}f.resetWarningCache=s,a.exports=function(){function h(L,O,N,C,x,l){if(l!==t){var _=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw _.name="Invariant Violation",_}}h.isRequired=h;function p(){return h}var m={array:h,bool:h,func:h,number:h,object:h,string:h,symbol:h,any:h,arrayOf:p,element:h,elementType:h,instanceOf:p,node:h,objectOf:p,oneOf:p,oneOfType:p,shape:p,exact:p,checkPropTypes:f,resetWarningCache:s};return m.PropTypes=m,m}},function(a,d,r){var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";a.exports=t}])})})(Q);var he=Q.exports;const pe=te(he);const me=({content:o,timestamp:n})=>e.jsxs("div",{className:"message own",children:[e.jsx("div",{className:"message_wrapper",children:e.jsx("p",{children:o})}),e.jsx("p",{className:"message_timestamp",children:n})]}),ge=({avatarSRC:o,content:n,timestamp:c})=>e.jsxs("div",{className:"message guest",children:[e.jsxs("div",{className:"message_wrapper",children:[e.jsx("img",{className:"inchat-avatar",src:o,alt:"Sender Avatar"}),e.jsx("p",{children:n})]}),e.jsx("p",{className:"message_timestamp",children:c})]}),xe=({messages:o,userId:n,participants:c})=>e.jsx(e.Fragment,{children:Array.isArray(o)&&o.map((u,a)=>{if(u.sender&&u.sender==n)return e.jsx(me,{content:u.content,timestamp:u.timestamp},a);{const d=c.find(t=>t._id===u.sender),r=d?d.avatar:"";return e.jsx(ge,{avatarSRC:r,content:u.content,timestamp:u.timestamp},a)}})}),be=g.memo(xe);const H=(o,n,c,u)=>fetch(`/api/v1/rooms/${o}?limit=${c}&skip=${u}`,{method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer "+n}}).then(a=>{if(a.status===304)throw new Error("Already got this");if(a.ok)return a.json();throw a.status==401&&(alert("Token expired"),sessionStorage.removeItem("token")),new Error("Failed to fetch messages")}),Y=30,ve=({token:o,room:n,userId:c,justSent:u})=>{const[a,d]=g.useState(null),[r,t]=g.useState(0),s=g.useRef(null),f=g.useRef(null),h=g.useRef(null),p=g.useRef(null),m=B(),L=F();console.log("Render container");const O=x=>{if(x[1]===n._id){const l=x[0];if(l!==c&&!n.participants.some(j=>j._id===l))return;h.current&&(h.current.style.display="block");const _=x[2],y=x[3];t(j=>j++),d(j=>j!==null?[...j,{sender:l,content:_,timestamp:y}]:[{sender:l,content:_,timestamp:y}])}},N=()=>{f.current&&(f.current.scrollIntoView({behavior:"smooth"}),h.current&&(h.current.style.display="none"))},C=x=>{if(!x||!a||a.length==0)return;if(a.length>=r){s.current&&(s.current.style.display="none");return}let l,_=Y;l=r-a.length-_,l<0&&(_+=l,l=0),H(n._id,o,`${_}`,`${l}`).then(y=>{p.current&&(p.current.scrollTop=300),d(j=>j?y.messages.concat(j):y.messages),y.conversationLength&&t(y.conversationLength)}).catch(()=>{L("/auth")})};return g.useEffect(()=>{try{if(!o||!n)return;H(n._id,o).then(x=>{d(x.messages),x.conversationLength&&t(x.conversationLength)}).catch(()=>{L("/auth")})}catch(x){console.error(x)}},[o,n._id]),g.useEffect(()=>{if(m)return m.on("msg",O),()=>{m.off("msg",O)}},[m,n._id]),g.useEffect(()=>{s.current&&(s.current.style.display="none");const x=setTimeout(()=>{s.current&&p.current&&p.current.scrollHeight>p.current.clientHeight&&(s.current.style.display="flex")},1e3);return()=>{clearTimeout(x)}},[n._id]),g.useEffect(()=>{if(!(!p.current||!a)){if(a.length<=Y)return N();if(Math.abs(p.current.scrollHeight-p.current.scrollTop-p.current.clientHeight)<300)return console.log("bottom"),N();if(a[a.length-1].sender==c&&u)return u=!1,N()}},[a]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:p,id:"messages-container",children:[e.jsx(pe,{onChange:C,children:e.jsx("div",{ref:s,id:"topRef",children:e.jsx(ne,{size:50})})}),a&&e.jsx(be,{messages:a,userId:c,participants:n.participants}),e.jsx("div",{ref:f})]}),e.jsxs("button",{id:"btn_scroll",ref:h,onClick:()=>{N()},children:[Array.isArray(a)&&a.length>1&&a[a.length-1].content,e.jsx("i",{className:"bx bx-down-arrow-alt"})]})]})};const ye=({room:o,token:n,profile:c})=>{const[u,a]=g.useState(!1);return e.jsxs("div",{id:"chat-box",children:[e.jsx(fe,{token:n,userId:c._id,room:o}),e.jsx(ve,{justSent:u,room:o,token:n,userId:c._id}),e.jsx(ae,{roomId:o._id,onJustSent:()=>{a(!0)}})]})};const je=({token:o,profileData:n,onRefresh:c})=>{const[u,a]=g.useState(!1),[d,r]=g.useState(!1),t=g.useRef(null),s=g.useRef(null),f=g.useRef(null),h=F(),p=B();g.useEffect(()=>{if(p)return p.on("inv",c),()=>{p.off("inv",c)}},[p]),g.useEffect(()=>{s.current&&(d?s.current.classList.add("active"):s.current.classList.remove("active"))},[d]);const m=()=>{sessionStorage.removeItem("token"),h("/auth")},L=l=>{fetch(`/api/v1/rooms/${l}`,{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify({accept:!0})})},O=l=>{fetch(`/api/v1/rooms/${l}`,{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify({accept:!1})})},N=async()=>{if(!f.current)return;let l={};if(f.current.bio.value&&(l.bio=f.current.bio.value),f.current.fullname.value&&(l.fullname=f.current.fullname.value),f.current.password.value)if(l.password=f.current.password.value,f.current.current_password.value)l.current_password=f.current.current_password.value;else return alert("Please enter current password");if(t.current&&(l.avatar=t.current),!l.bio&&!l.fullname&&!l.password&&!l.avatar)return alert("Empty form");const _=await fetch("/api/v1/users/",{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify(l)});if(r(!1),_.ok)return alert("Updated successfully!"),c();const y=await _.json();if(y.message)return alert(y.message);alert("Error updating profile")},C=async()=>{if(window.confirm("Are you sure you want to delete your account?")){const _=window.prompt("Enter your password:");if(_!==null)try{const y={password:_},j=await fetch("/api/v1/users/",{method:"DELETE",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify(y)});if(j.ok)sessionStorage.removeItem("token"),alert("You deleted your account successfully"),h("/auth");else{const z=await j.json();z.message?alert(z.message):alert("Wrong password!")}}catch(y){console.error("Error deleting account:",y)}}},x=l=>{const _=new FormData;_.append("file",l),fetch(`/media/${n==null?void 0:n._id}/public?token=${o}`,{method:"POST",body:_}).then(y=>y.json()).then(y=>{console.log("File upload response:",y),t.current=y.url,N()}).catch(y=>{console.error("Error uploading file:",y)})};return e.jsxs("div",{id:"profile",children:[e.jsxs("div",{id:"profile_topbar",children:[e.jsx("img",{src:n==null?void 0:n.avatar,alt:"Profile",id:"profile_img",className:"cover"}),d?e.jsx(K,{accept:"image/*",onChange:x,id:"upload-img",icon:e.jsx("i",{className:"bx bxs-camera"})}):e.jsxs("div",{children:[e.jsx("h3",{children:n==null?void 0:n.fullname}),(n==null?void 0:n.bio)&&e.jsx("p",{children:n==null?void 0:n.bio})]}),e.jsxs("div",{className:"flex",children:[d?e.jsx("button",{className:"btn",onClick:()=>r(!1),children:e.jsx("i",{className:"bx bxs-message-square-x"})}):e.jsx("button",{className:"btn",onClick:()=>r(!0),children:e.jsx("i",{className:"bx bxs-pencil"})}),e.jsx("button",{className:"btn",onClick:()=>a(l=>!l),children:u?e.jsx("i",{className:"bx bxs-message-square-x"}):e.jsxs("div",{id:"bell",children:[e.jsx("i",{className:"bx bxs-bell"}),n!=null&&n.invitations.length&&(n==null?void 0:n.invitations.length)>0?e.jsx("span",{id:"nofcount",children:n==null?void 0:n.invitations.length}):null]})}),u&&e.jsx("div",{id:"notify-container",children:n&&n.invitations.length>0?n.invitations.map(l=>e.jsxs("div",{children:[e.jsx("p",{children:l}),e.jsx("button",{onClick:()=>L(l),children:"Accept"}),e.jsx("button",{onClick:()=>O(l),children:"Refuse"})]},l)):e.jsx("p",{children:"No invitations"})}),e.jsx("button",{id:"logout-btn",className:"btn",onClick:m,children:e.jsx("i",{className:"bx bx-log-in"})})]})]}),e.jsxs("div",{ref:s,id:"profile_editor",children:[e.jsxs("form",{id:"profile_form",ref:f,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fullname",children:"Your name:"}),e.jsx("input",{type:"text",id:"fullname",name:"fullname",placeholder:n==null?void 0:n.fullname})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bio",children:"Bio:"}),e.jsx("input",{type:"text",id:"bio",name:"bio",placeholder:n==null?void 0:n.bio})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"current_password",children:"Current password:"}),e.jsx("input",{type:"password",id:"current_password",name:"current_password"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",children:"New password:"}),e.jsx("input",{type:"password",id:"password",name:"password"})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{id:"btn_delete-account",onClick:C,children:"Delete account"}),e.jsx("button",{id:"btn_submit-edit",onClick:N,children:"Save"})]})]})]})},_e=g.memo(je);const we=({token:o,onChoose:n})=>{const c=g.useRef(null),[u,a]=g.useState([]),d=()=>{var f;const s=(f=c.current)==null?void 0:f.value;s&&fetch(`/api/v1/search/${s}`,{headers:{"content-type":"application/json",authorization:"Bearer "+o}}).then(h=>{if(h.ok)return h.json().then(p=>{a(p)});console.log(h.status)})},r=s=>{s.key==="Enter"&&d()},t=s=>{c.current&&!c.current.contains(s.target)&&(a([]),c.current.value="")};return g.useEffect(()=>(document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}),[]),e.jsxs("div",{id:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search for users...",ref:c,onKeyPress:r}),e.jsx("button",{className:"btn",onClick:d,children:e.jsx("i",{className:"bx bx-search"})}),u.length>0&&e.jsx("div",{id:"search_dropdown",children:u.map(s=>e.jsxs("div",{onClick:()=>{n({_id:s._id,fullname:s.fullname})},children:[e.jsx("img",{className:"profile-picture",src:s.avatar,alt:"Avatar"}),s.fullname]},s._id))})]})};const Ce=({token:o})=>{const[n,c]=g.useState([]),u=r=>{if(n.some(t=>t._id==r._id))return alert("already selected this user");c(t=>[...t,r])},a=r=>{console.log("remove user from users list"),r>=0&&r<n.length&&c(t=>t.filter((f,h)=>h!==r))},d=async()=>{if(n.length==0)return alert("Please select a user");const r=n.map(t=>t._id);try{(await fetch("/api/v1/rooms",{method:"POST",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify({invited:r})})).ok?c([]):alert("deo biet sao bug luon")}catch(t){console.error(t)}};return e.jsxs("div",{id:"room-maker",children:[e.jsx(we,{token:o,onChoose:u}),n.length>0&&e.jsxs("div",{className:"flex",children:[e.jsx("div",{id:"chosenList",className:"flex",children:n.map((r,t)=>e.jsxs("div",{className:"chosenUser flex",children:[e.jsxs("p",{children:[" ",r.fullname]}),e.jsx("span",{onClick:()=>a(t),children:"X"})]},r.fullname))}),e.jsx("button",{className:"btn",onClick:d,children:e.jsx("i",{className:"bx bxs-message-square-add"})})]})]})};function Ee(){return e.jsxs("svg",{id:"bgrn-svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 700 700",preserveAspectRatio:"none",children:[e.jsxs("g",{mask:'url("#SvgjsMask1020")',fill:"none",children:[e.jsx("rect",{width:"700",height:"700",x:"0",y:"0",fill:'url("#SvgjsLinearGradient1021")'}),e.jsx("path",{d:"M700 0L426.65 0L700 81.54z",fill:"rgba(255, 255, 255, 0.2)"}),e.jsx("path",{d:"M426.65 0L700 81.54L700 267.52L414.62 0z",fill:"rgba(255, 255, 255, .13)"}),e.jsx("path",{d:"M414.62 0L700 267.52L700 452.46L156.39 0z",fill:"rgba(255, 255, 255, .1)"}),e.jsx("path",{d:"M156.39 0L700 452.46L700 490.96L83.34999999999998 0z",fill:"rgba(255, 255, 255, .1)"}),e.jsx("path",{d:"M0 700L154.99 700L0 376.93z",fill:"rgba(0, 0, 0, .1)"}),e.jsx("path",{d:"M0 376.93L154.99 700L303.17 700L0 371.8z",fill:"rgba(0, 0, 0, .175)"}),e.jsx("path",{d:"M0 371.8L303.17 700L525.89 700L0 229.98000000000002z",fill:"rgba(0, 0, 0, .25)"}),e.jsx("path",{d:"M0 229.98000000000002L525.89 700L592.96 700L0 184.46z",fill:"rgba(0, 0, 0, .325)"})]}),e.jsxs("defs",{children:[e.jsx("mask",{id:"SvgjsMask1020",children:e.jsx("rect",{width:"700",height:"700",fill:"#ffffff"})}),e.jsxs("linearGradient",{x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"userSpaceOnUse",id:"SvgjsLinearGradient1021",children:[e.jsx("stop",{id:"stop_1",offset:"0"}),e.jsx("stop",{id:"stop_2",offset:"1"})]})]})]})}const X=o=>fetch("/api/v1/users/",{method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer "+o}}).then(n=>{if(n.ok)return n.json();throw n.status==401&&(alert("Token expired"),sessionStorage.removeItem("token"),window.location.reload()),new Error("Failed to fetch user profile")}),Ne=({token:o})=>{const[n,c]=g.useState(null),[u,a]=g.useState([]),[d,r]=g.useState(0),t=F(),s=async()=>{try{const p=await X(o);c(p)}catch{t("/auth")}},f=p=>{r(p)},h=p=>{a(p)};return g.useEffect(()=>{o&&X(o).then(p=>{c(p)}).catch(p=>{console.error(p),t("/auth")})},[o]),e.jsx("div",{id:"main-page",className:"flex",children:n?e.jsxs(se,{token:o,children:[e.jsxs("div",{id:"main-page_container",children:[e.jsxs("section",{id:"section-left",children:[e.jsx(_e,{token:o,profileData:n,onRefresh:s}),e.jsx(Ce,{token:o}),e.jsx(ie,{userId:n._id,currentRoomIndex:d,token:o,onRoomChange:f,onUpdateStatus:h})]}),e.jsx("section",{id:"section-right",children:u.length>0&&e.jsx(ye,{profile:n,token:o,room:u[d]})})]}),e.jsx(Ee,{})]}):e.jsx("div",{children:"Loading skeleton ..."})})};export{Ne as default,X as getProfile};
