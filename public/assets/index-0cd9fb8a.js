import{r as g,j as e,u as $,a as ne,c as se,g as re,P as ie}from"./index-b69e7028.js";import{g as J}from"./getSocket-3ac81373.js";const oe=({participants:o,userId:r})=>{if(o=o.filter(d=>d._id!==r),o.length==0)return null;const l=o.length>1,x=o.slice(0,4);return e.jsx("div",{className:"card",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"group-pictures-container",children:x.map((d,b)=>e.jsx("div",{className:"profile",children:e.jsx("img",{src:d.avatar,alt:"Profile",className:"group-profile-picture"})},b))}),e.jsxs("div",{className:"profile-names",children:[x.length>0&&e.jsx("h3",{children:x.map(d=>d.fullname).join(", ")}),o.length>4&&e.jsxs("p",{className:"group-members-count",children:["+",o.length-4," more"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:o[0].avatar,alt:"Profile",className:"profile-picture"}),e.jsxs("h3",{children:[o[0].fullname+"  ",e.jsx("span",{className:o[0].isOnline?"online":"offline",children:"â€¢"})]}),o[0].bio&&e.jsx("p",{children:o[0].bio})]})})},ee=g.memo(oe);const H=o=>new Promise((r,l)=>{fetch("/api/v1/rooms",{method:"GET",headers:{"content-type":"application/json",authorization:"Bearer "+o}}).then(x=>{if(x.ok)return x.json().then(d=>{r(d)});throw x.status==401&&(alert("Token expired"),sessionStorage.removeItem("token")),new Error("Failed to fetch rooms information")}).catch(x=>{l(x)})}),ae=({userId:o,currentRoomIndex:r,token:l,onRoomChange:x,onUpdateStatus:d})=>{const[b,s]=g.useState([]),t=g.useRef(""),i=g.useRef(null),y=$(),m=_=>{const E=_;"onl"+E!=t.current&&(t.current="onl"+E,s(S=>S&&S.map(f=>{const j=f.participants.map(w=>w._id===E?{...w,isOnline:!0}:w);return{...f,participants:j}})))},v=_=>{const E=_;"off"+E!=t.current&&(t.current="off"+E,s(S=>S&&S.map(f=>{const j=f.participants.map(w=>w._id===E?{...w,isOnline:!1}:w);return{...f,participants:j}})))},h=()=>{H(l).then(_=>{s(_)}).catch(()=>{y("/auth")})},M=_=>{var S,f;const E=document.querySelectorAll(".chat-room");E==null||E.forEach(j=>{var w;(w=j.classList)==null||w.remove("active")}),(f=(S=E[_])==null?void 0:S.classList)==null||f.add("active"),x(_)};g.useEffect(()=>{b.length>0&&d(b)},[b]),g.useEffect(()=>(l&&H(l).then(_=>{s(_);const E=J(l);E.on("onl",m),E.on("off",v),E.on("room",h),i.current=E}).catch(()=>{y("/auth")}),()=>{var _;(_=i.current)==null||_.disconnect()}),[l]);const P=g.useMemo(()=>b.map((_,E)=>e.jsx("div",{className:`chat-room ${E==r?"active":""}`,onClick:()=>M(E),children:e.jsx(ee,{userId:o,participants:_.participants})},_._id)),[b]);return e.jsx("div",{id:"rooms-list",children:b&&b.length>0?e.jsx("div",{children:P}):e.jsx("p",{children:"No rooms to display"})})};const le={light:{text:"#000",background:"#d5e356",theme:"#ffffff"},dark:{text:"#ffffff",background:"#000",theme:"#240063"}},ce=()=>{const[o,r]=g.useState(sessionStorage.getItem("theme")||"light");return g.useEffect(()=>{const l=le[o];Object.entries(l).forEach(([x,d])=>{document.documentElement.style.setProperty(`--${x}-color`,d)}),sessionStorage.setItem("theme",o)},[o]),[o,r]},ue=()=>{const[o,r]=ce(),l=o==="light",x=()=>{r(l?"dark":"light")};return e.jsxs("div",{className:"theme-switch-container",children:[e.jsx("input",{type:"checkbox",id:"switcher-input",checked:l,onChange:x}),e.jsxs("label",{className:`switcher-label ${l?"":"active"}`,htmlFor:"switcher-input",children:[e.jsx("i",{className:"fas fa-solid fa-sun"}),e.jsx("span",{className:"switcher-toggler"}),e.jsx("i",{className:"fas fa-solid fa-moon"})]})]})};var te={exports:{}};(function(o,r){(function(x,d){o.exports=d(g,ne)})(se,function(l,x){return function(d){var b={};function s(t){if(b[t])return b[t].exports;var i=b[t]={i:t,l:!1,exports:{}};return d[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=d,s.c=b,s.d=function(t,i,y){s.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:y})},s.r=function(t){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,i){if(i&1&&(t=s(t)),i&8||i&4&&typeof t=="object"&&t&&t.__esModule)return t;var y=Object.create(null);if(s.r(y),Object.defineProperty(y,"default",{enumerable:!0,value:t}),i&2&&typeof t!="string")for(var m in t)s.d(y,m,(function(v){return t[v]}).bind(null,m));return y},s.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.p="",s(s.s=4)}([function(d,b,s){d.exports=s(5)()},function(d,b){d.exports=l},function(d,b){d.exports=x},function(d,b){d.exports=function(s,t,i){var y=s.direction,m=s.value;switch(y){case"top":return i.top+m<t.top&&i.bottom>t.bottom&&i.left<t.left&&i.right>t.right;case"left":return i.left+m<t.left&&i.bottom>t.bottom&&i.top<t.top&&i.right>t.right;case"bottom":return i.bottom-m>t.bottom&&i.left<t.left&&i.right>t.right&&i.top<t.top;case"right":return i.right-m>t.right&&i.left<t.left&&i.top<t.top&&i.bottom>t.bottom}}},function(d,b,s){s.r(b),s.d(b,"default",function(){return c});var t=s(1),i=s.n(t),y=s(2),m=s.n(y),v=s(0),h=s.n(v),M=s(3),P=s.n(M);function _(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_=function(p){return typeof p}:_=function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},_(a)}function E(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")}function S(a,u){for(var p=0;p<u.length;p++){var n=u[p];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}function f(a,u,p){return u&&S(a.prototype,u),p&&S(a,p),a}function j(a,u){return u&&(_(u)==="object"||typeof u=="function")?u:T(a)}function w(a){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(p){return p.__proto__||Object.getPrototypeOf(p)},w(a)}function T(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function I(a,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(u&&u.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),u&&R(a,u)}function R(a,u){return R=Object.setPrototypeOf||function(n,U){return n.__proto__=U,n},R(a,u)}function k(a,u,p){return u in a?Object.defineProperty(a,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):a[u]=p,a}function A(a){return a.width===void 0&&(a.width=a.right-a.left),a.height===void 0&&(a.height=a.bottom-a.top),a}var c=function(a){I(u,a);function u(p){var n;return E(this,u),n=j(this,w(u).call(this,p)),k(T(n),"getContainer",function(){return n.props.containment||window}),k(T(n),"addEventListener",function(U,C,L,F){n.debounceCheck||(n.debounceCheck={});var O,V,z=function(){O=null,n.check()};F>-1?V=function(){O||(O=setTimeout(z,F||0))}:V=function(){clearTimeout(O),O=setTimeout(z,L||0)};var W={target:U,fn:V,getLastTimeout:function(){return O}};U.addEventListener(C,W.fn),n.debounceCheck[C]=W}),k(T(n),"startWatching",function(){n.debounceCheck||n.interval||(n.props.intervalCheck&&(n.interval=setInterval(n.check,n.props.intervalDelay)),n.props.scrollCheck&&n.addEventListener(n.getContainer(),"scroll",n.props.scrollDelay,n.props.scrollThrottle),n.props.resizeCheck&&n.addEventListener(window,"resize",n.props.resizeDelay,n.props.resizeThrottle),!n.props.delayedCall&&n.check())}),k(T(n),"stopWatching",function(){if(n.debounceCheck){for(var U in n.debounceCheck)if(n.debounceCheck.hasOwnProperty(U)){var C=n.debounceCheck[U];clearTimeout(C.getLastTimeout()),C.target.removeEventListener(U,C.fn),n.debounceCheck[U]=null}}n.debounceCheck=null,n.interval&&(n.interval=clearInterval(n.interval))}),k(T(n),"check",function(){var U=n.node,C,L;if(!U)return n.state;if(C=A(n.roundRectDown(U.getBoundingClientRect())),n.props.containment){var F=n.props.containment.getBoundingClientRect();L={top:F.top,left:F.left,bottom:F.bottom,right:F.right}}else L={top:0,left:0,bottom:window.innerHeight||document.documentElement.clientHeight,right:window.innerWidth||document.documentElement.clientWidth};var O=n.props.offset||{},V=_(O)==="object";V&&(L.top+=O.top||0,L.left+=O.left||0,L.bottom-=O.bottom||0,L.right-=O.right||0);var z={top:C.top>=L.top,left:C.left>=L.left,bottom:C.bottom<=L.bottom,right:C.right<=L.right},W=C.height>0&&C.width>0,B=W&&z.top&&z.left&&z.bottom&&z.right;if(W&&n.props.partialVisibility){var G=C.top<=L.bottom&&C.bottom>=L.top&&C.left<=L.right&&C.right>=L.left;typeof n.props.partialVisibility=="string"&&(G=z[n.props.partialVisibility]),B=n.props.minTopValue?G&&C.top<=L.bottom-n.props.minTopValue:G}typeof O.direction=="string"&&typeof O.value=="number"&&(console.warn("[notice] offset.direction and offset.value have been deprecated. They still work for now, but will be removed in next major version. Please upgrade to the new syntax: { %s: %d }",O.direction,O.value),B=P()(O,C,L));var K=n.state;return n.state.isVisible!==B&&(K={isVisible:B,visibilityRect:z},n.setState(K),n.props.onChange&&n.props.onChange(B)),K}),n.state={isVisible:null,visibilityRect:{}},n}return f(u,[{key:"componentDidMount",value:function(){this.node=m.a.findDOMNode(this),this.props.active&&this.startWatching()}},{key:"componentWillUnmount",value:function(){this.stopWatching()}},{key:"componentDidUpdate",value:function(n){this.node=m.a.findDOMNode(this),this.props.active&&!n.active?(this.setState({isVisible:null,visibilityRect:{}}),this.startWatching()):this.props.active||this.stopWatching()}},{key:"roundRectDown",value:function(n){return{top:Math.floor(n.top),left:Math.floor(n.left),bottom:Math.floor(n.bottom),right:Math.floor(n.right)}}},{key:"render",value:function(){return this.props.children instanceof Function?this.props.children({isVisible:this.state.isVisible,visibilityRect:this.state.visibilityRect}):i.a.Children.only(this.props.children)}}]),u}(i.a.Component);k(c,"defaultProps",{active:!0,partialVisibility:!1,minTopValue:0,scrollCheck:!1,scrollDelay:250,scrollThrottle:-1,resizeCheck:!1,resizeDelay:250,resizeThrottle:-1,intervalCheck:!0,intervalDelay:100,delayedCall:!1,offset:{},containment:null,children:i.a.createElement("span",null)}),k(c,"propTypes",{onChange:h.a.func,active:h.a.bool,partialVisibility:h.a.oneOfType([h.a.bool,h.a.oneOf(["top","right","bottom","left"])]),delayedCall:h.a.bool,offset:h.a.oneOfType([h.a.shape({top:h.a.number,left:h.a.number,bottom:h.a.number,right:h.a.number}),h.a.shape({direction:h.a.oneOf(["top","right","bottom","left"]),value:h.a.number})]),scrollCheck:h.a.bool,scrollDelay:h.a.number,scrollThrottle:h.a.number,resizeCheck:h.a.bool,resizeDelay:h.a.number,resizeThrottle:h.a.number,intervalCheck:h.a.bool,intervalDelay:h.a.number,containment:typeof window<"u"?h.a.instanceOf(window.Element):h.a.any,children:h.a.oneOfType([h.a.element,h.a.func]),minTopValue:h.a.number})},function(d,b,s){var t=s(6);function i(){}function y(){}y.resetWarningCache=i,d.exports=function(){function m(M,P,_,E,S,f){if(f!==t){var j=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw j.name="Invariant Violation",j}}m.isRequired=m;function v(){return m}var h={array:m,bool:m,func:m,number:m,object:m,string:m,symbol:m,any:m,arrayOf:v,element:m,elementType:m,instanceOf:v,node:m,objectOf:v,oneOf:v,oneOfType:v,shape:v,exact:v,checkPropTypes:y,resetWarningCache:i};return h.PropTypes=h,h}},function(d,b,s){var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";d.exports=t}])})})(te);var de=te.exports;const Y=re(de);let N,D,X;const q=30,Q=(o,r,l,x)=>fetch(`/api/v1/rooms/${o}?limit=${l}&skip=${x}`,{method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer "+r}}).then(d=>{if(d.status===304)throw new Error("Already got this");if(d.ok)return d.json();throw d.status==401&&(alert("Token expired"),sessionStorage.removeItem("token")),new Error("Failed to fetch messages")}),he=({room:o,token:r,profile:l})=>{let x;const[d,b]=g.useState(""),[s,t]=g.useState(null),[i,y]=g.useState(),m=g.useRef(o._id),v=g.useRef(null),h=g.useRef(null),M=g.useRef(null),P=g.useRef(null),_=$(),E=c=>{b(c.target.value),console.log("typing ...")},S=()=>{d.trim()!==""&&(N==null||N.emit("msg",[o._id,d,new Date]),D=!0,b(""))},f=c=>{if(c[1]===m.current){const a=c[0];if(a!==(l==null?void 0:l._id)&&!o.participants.some(n=>n._id===a))return;M.current&&(console.log("thissssssssss"),M.current.style.display="block");const u=c[2],p=c[3];x++,t(n=>n!==null?[...n,{sender:a,content:u,timestamp:p}]:[{sender:a,content:u,timestamp:p}])}else console.log("New message, room: "+c[1])},j=()=>{N==null||N.emit("meet",[o._id,new Date])},w=c=>{const a=`/meet/${c}?token=${r}&room=${o._id}`;window.open(a)},T=c=>{if(c[1]==o._id&&y(c[2]),c[0]==(l==null?void 0:l._id))return c[3]?void 0:w(c[2]);Notification.permission==="granted"?new Notification("Incoming Call",{body:"You have an incoming call. Do you want to join?",icon:"path/to/notification-icon.png",requireInteraction:!0}).addEventListener("click",()=>{w(c[2])}):Notification.permission!=="denied"&&Notification.requestPermission().then(a=>{a==="granted"&&T(c)})},I=()=>{y(null)},R=c=>{c.scrollIntoView({behavior:"smooth"}),M.current&&(M.current.style.display="none")};g.useEffect(()=>{try{if(!r||!o)return;Q(o._id,r).then(c=>{t(c.messages),c.conversationLength&&(x=c.conversationLength),c.meeting_uuid?y(c.meeting_uuid):y(null)}).catch(()=>{_("/auth")})}catch(c){console.error(c)}},[r,o._id]),g.useEffect(()=>{r&&(N=J(r),N==null||N.on("msg",f),N==null||N.on("meet",T),N==null||N.on("end_meet",I))},[r]),g.useEffect(()=>{m.current=o._id,v.current&&(v.current.style.display="none");const c=setTimeout(()=>{v.current&&P.current&&P.current.scrollHeight>P.current.clientHeight&&(v.current.style.display="flex")},1e3);return()=>{clearTimeout(c)}},[o._id]),g.useEffect(()=>{if(!(!h.current||!P.current||!s)){if(s.length<=q)return R(h.current);if(s[s.length-1].sender!=l._id){if(X)return R(h.current);P.current.scrollTop=300;return}if(D)return D=!1,R(h.current)}},[s]);const k=g.useMemo(()=>e.jsx(e.Fragment,{children:Array.isArray(s)&&s.map((c,a)=>{let u;if(c.sender&&c.sender==(l==null?void 0:l._id))u=l.avatar;else{const p=o.participants.find(n=>n._id===c.sender);u=p?p.avatar:""}return e.jsxs("div",{className:`message ${c.sender==(l==null?void 0:l._id)?"own":""}`,children:[e.jsxs("div",{className:"message_wrapper",children:[c.sender!=(l==null?void 0:l._id)&&u&&e.jsx("img",{className:"inchat-avatar",src:u,alt:"Sender Avatar"}),e.jsx("p",{children:c.content})]}),e.jsx("p",{className:"message_timestamp",children:c.timestamp})]},a)})}),[s]),A=c=>{if(!c||!s||s.length==0)return;if(s.length>=x){v.current&&(v.current.style.display="none");return}let a,u=q;a=x-s.length-u,a<0&&(u+=a,a=0),Q(o._id,r,`${u}`,`${a}`).then(p=>{t(n=>n?p.messages.concat(n):p.messages),p.conversationLength&&(x=p.conversationLength),p.meeting_uuid?y(p.meeting_uuid):y(null)}).catch(()=>{_("/auth")})};return e.jsxs("div",{id:"chat-box",children:[e.jsxs("div",{id:"chat-box_topbar",className:"flex",children:[e.jsxs("div",{id:"chat-box_topbar_left",children:[e.jsx(ee,{userId:l==null?void 0:l._id,participants:o.participants}),e.jsx("button",{className:"btn",onClick:j,children:e.jsx("i",{className:"bx bxs-video"})}),i&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"This room is in a meeting"}),e.jsx("button",{onClick:()=>w(i),children:"Join"})]})]}),e.jsx(ue,{})]}),e.jsxs("div",{ref:P,id:"messages-container",children:[e.jsx(Y,{onChange:A,children:e.jsx("div",{ref:v,id:"topRef",children:e.jsx(ie,{size:50})})}),k,e.jsx(Y,{onChange:c=>{X=c},children:e.jsx("div",{ref:h,children:"."})})]}),e.jsxs("button",{id:"btn_scroll",ref:M,onClick:()=>{h.current&&R(h.current)},children:[s&&s[s.length-1].content," ",e.jsx("i",{className:"bx bx-down-arrow-alt"})]}),e.jsx("img",{id:"chat-box_bg",src:"/assets/img/img_new/pattern.png"}),e.jsxs("div",{id:"chat-box_input-container",children:[e.jsx("input",{type:"text",value:d,id:"input_message",onChange:E,onKeyDown:c=>{c.key=="Enter"&&S()}}),e.jsx("button",{onClick:S,className:"btn",children:e.jsx("i",{className:"bx bxs-send"})})]})]})};const fe=({token:o,profileData:r,onRefresh:l})=>{const[x,d]=g.useState(!1),[b,s]=g.useState(!1),t=g.useRef(null),i=g.useRef(null),y=g.useRef(null),m=g.useRef(null),v=$();g.useEffect(()=>{if(o){const f=J(o);f.on("inv",l),y.current=f}return()=>{var f;(f=y.current)==null||f.disconnect()}},[o]),g.useEffect(()=>{m.current&&(b?m.current.classList.add("active"):m.current.classList.remove("active"))},[b]);const h=()=>{sessionStorage.removeItem("token"),v("/auth")},M=f=>{fetch(`/api/v1/rooms/${f}`,{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify({accept:!0})})},P=f=>{fetch(`/api/v1/rooms/${f}`,{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify({accept:!1})})},_=async f=>{f.preventDefault();let j={};if(f.target.bio.value&&(j.bio=f.target.bio.value),f.target.fullname.value&&(j.fullname=f.target.fullname.value),f.target.password.value)if(j.password=f.target.password.value,f.target.current_password.value)j.current_password=f.target.current_password.value;else return alert("Please enter current password");if(i.current&&(j.avatar=i.current),!j.bio&&!j.fullname&&!j.password&&!j.avatar)return alert("Empty form");const w=await fetch("/api/v1/users/",{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify(j)});if(s(!1),w.ok)return alert("Updated successfully!"),l();const T=await w.json();if(T.message)return alert(T.message);alert("Error updating profile")},E=async()=>{if(window.confirm("Are you sure you want to delete your account?")){const j=window.prompt("Enter your password:");if(j!==null)try{const w={password:j},T=await fetch("/api/v1/users/",{method:"DELETE",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify(w)});if(T.ok)sessionStorage.removeItem("token"),alert("You deleted your account successfully"),v("/auth");else{const I=await T.json();I.message?alert(I.message):alert("Wrong password!")}}catch(w){console.error("Error deleting account:",w)}}},S=()=>{if(t!=null&&t.current&&t.current.length>0){const f=t.current.files[0],j=new FileReader;j.onload=async w=>{var T;if((T=w.target)!=null&&T.result){const I=new Image;I.onload=async()=>{const R=document.createElement("canvas"),k=200,A=200;let c=I.width,a=I.height;c>k&&(a*=k/c,c=k),a>A&&(c*=A/a,a=A),R.width=c,R.height=a;const u=R.getContext("2d");u==null||u.drawImage(I,0,0,c,a);const p=R.toDataURL("image/jpeg");i.current=p},I.src=w.target.result}},j.readAsDataURL(f)}};return e.jsxs("div",{id:"profile",children:[e.jsxs("div",{id:"profile_topbar",children:[e.jsx("img",{src:r==null?void 0:r.avatar,alt:"Profile",id:"profile_img",className:"cover"}),b?e.jsxs("label",{id:"btn_upload-img",htmlFor:"upload-img",children:[e.jsx("i",{className:"bx bxs-camera"}),e.jsx("input",{id:"upload-img",type:"file",accept:"image/*",ref:t,onChange:S})]}):e.jsxs("div",{children:[e.jsx("h3",{children:r==null?void 0:r.fullname}),(r==null?void 0:r.bio)&&e.jsx("p",{children:r==null?void 0:r.bio})]}),e.jsxs("div",{className:"flex",children:[b?e.jsx("button",{className:"btn",onClick:()=>s(!1),children:e.jsx("i",{className:"bx bxs-message-square-x"})}):e.jsx("button",{className:"btn",onClick:()=>s(!0),children:e.jsx("i",{className:"bx bxs-pencil"})}),e.jsx("button",{className:"btn",onClick:()=>d(f=>!f),children:x?e.jsx("i",{className:"bx bxs-message-square-x"}):e.jsxs("div",{id:"bell",children:[e.jsx("i",{className:"bx bxs-bell"}),r!=null&&r.invitations.length&&(r==null?void 0:r.invitations.length)>0?e.jsx("span",{id:"nofcount",children:r==null?void 0:r.invitations.length}):null]})}),x&&e.jsx("div",{id:"notify-container",children:r&&r.invitations.length>0?r.invitations.map(f=>e.jsxs("div",{children:[e.jsx("p",{children:f}),e.jsx("button",{onClick:()=>M(f),children:"Accept"}),e.jsx("button",{onClick:()=>P(f),children:"Refuse"})]},f)):e.jsx("p",{children:"No invitations"})}),e.jsx("button",{id:"logout-btn",className:"btn",onClick:h,children:e.jsx("i",{className:"bx bx-log-in"})})]})]}),e.jsxs("div",{ref:m,id:"profile_editor",children:[e.jsxs("form",{id:"profile_form",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fullname",children:"Your name:"}),e.jsx("input",{type:"text",id:"fullname",name:"fullname",placeholder:r==null?void 0:r.fullname})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bio",children:"Bio:"}),e.jsx("input",{type:"text",id:"bio",name:"bio",placeholder:r==null?void 0:r.bio})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"current_password",children:"Current password:"}),e.jsx("input",{type:"password",id:"current_password",name:"current_password"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",children:"New password:"}),e.jsx("input",{type:"password",id:"password",name:"password"})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{id:"btn_delete-account",onClick:E,children:"Delete account"}),e.jsx("button",{id:"btn_submit-edit",onClick:_,children:"Save"})]})]})]})},me=g.memo(fe);const pe=({token:o,onChoose:r})=>{const l=g.useRef(null),[x,d]=g.useState([]),b=()=>{var y;const i=(y=l.current)==null?void 0:y.value;i&&fetch(`/api/v1/search/${i}`,{headers:{"content-type":"application/json",authorization:"Bearer "+o}}).then(m=>{if(m.ok)return m.json().then(v=>{d(v)});console.log(m.status)})},s=i=>{i.key==="Enter"&&b()},t=i=>{l.current&&!l.current.contains(i.target)&&(d([]),l.current.value="")};return g.useEffect(()=>(document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}),[]),e.jsxs("div",{id:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search for users...",ref:l,onKeyPress:s}),e.jsx("button",{className:"btn",onClick:b,children:e.jsx("i",{className:"bx bx-search"})}),x.length>0&&e.jsx("div",{id:"search_dropdown",children:x.map(i=>e.jsxs("div",{onClick:()=>{r({_id:i._id,fullname:i.fullname})},children:[e.jsx("img",{className:"profile-picture",src:i.avatar,alt:"Avatar"}),i.fullname]},i._id))})]})};const ge=({token:o})=>{const[r,l]=g.useState([]),x=s=>{if(r.some(t=>t._id==s._id))return alert("already selected this user");l(t=>[...t,s])},d=s=>{console.log("remove user from users list"),s>=0&&s<r.length&&l(t=>t.filter((y,m)=>m!==s))},b=async()=>{if(r.length==0)return alert("Please select a user");const s=r.map(t=>t._id);try{(await fetch("/api/v1/rooms",{method:"POST",headers:{"content-type":"application/json",authorization:"Bearer "+o},body:JSON.stringify({invited:s})})).ok?l([]):alert("deo biet sao bug luon")}catch(t){console.error(t)}};return e.jsxs("div",{id:"room-maker",children:[e.jsx(pe,{token:o,onChoose:x}),r.length>0&&e.jsxs("div",{className:"flex",children:[e.jsx("div",{id:"chosenList",className:"flex",children:r.map((s,t)=>e.jsxs("div",{className:"chosenUser flex",children:[e.jsxs("p",{children:[" ",s.fullname]}),e.jsx("span",{onClick:()=>d(t),children:"X"})]},s.fullname))}),e.jsx("button",{className:"btn",onClick:b,children:e.jsx("i",{className:"bx bxs-message-square-add"})})]})]})};function be(){return e.jsxs("svg",{id:"bgrn-svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 700 700",preserveAspectRatio:"none",children:[e.jsxs("g",{mask:'url("#SvgjsMask1020")',fill:"none",children:[e.jsx("rect",{width:"700",height:"700",x:"0",y:"0",fill:'url("#SvgjsLinearGradient1021")'}),e.jsx("path",{d:"M700 0L426.65 0L700 81.54z",fill:"rgba(255, 255, 255, 0.2)"}),e.jsx("path",{d:"M426.65 0L700 81.54L700 267.52L414.62 0z",fill:"rgba(255, 255, 255, .13)"}),e.jsx("path",{d:"M414.62 0L700 267.52L700 452.46L156.39 0z",fill:"rgba(255, 255, 255, .1)"}),e.jsx("path",{d:"M156.39 0L700 452.46L700 490.96L83.34999999999998 0z",fill:"rgba(255, 255, 255, .1)"}),e.jsx("path",{d:"M0 700L154.99 700L0 376.93z",fill:"rgba(0, 0, 0, .1)"}),e.jsx("path",{d:"M0 376.93L154.99 700L303.17 700L0 371.8z",fill:"rgba(0, 0, 0, .175)"}),e.jsx("path",{d:"M0 371.8L303.17 700L525.89 700L0 229.98000000000002z",fill:"rgba(0, 0, 0, .25)"}),e.jsx("path",{d:"M0 229.98000000000002L525.89 700L592.96 700L0 184.46z",fill:"rgba(0, 0, 0, .325)"})]}),e.jsxs("defs",{children:[e.jsx("mask",{id:"SvgjsMask1020",children:e.jsx("rect",{width:"700",height:"700",fill:"#ffffff"})}),e.jsxs("linearGradient",{x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"userSpaceOnUse",id:"SvgjsLinearGradient1021",children:[e.jsx("stop",{id:"stop_1",offset:"0"}),e.jsx("stop",{id:"stop_2",offset:"1"})]})]})]})}const Z=o=>fetch("/api/v1/users/",{method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer "+o}}).then(r=>{if(r.ok)return r.json();throw r.status==401&&(alert("Token expired"),sessionStorage.removeItem("token"),window.location.reload()),new Error("Failed to fetch user profile")}),ye=({token:o})=>{const[r,l]=g.useState(null),[x,d]=g.useState([]),[b,s]=g.useState(0),t=$(),i=async()=>{try{const v=await Z(o);l(v)}catch{t("/auth")}},y=v=>{s(v)},m=v=>{d(v)};return g.useEffect(()=>{o&&Z(o).then(v=>{l(v)}).catch(v=>{console.error(v),t("/auth")})},[o]),e.jsx("div",{id:"main-page",className:"flex",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"main-page_container",children:[e.jsxs("section",{id:"section-left",children:[e.jsx(me,{token:o,profileData:r,onRefresh:i}),e.jsx(ge,{token:o}),e.jsx(ae,{userId:r._id,currentRoomIndex:b,token:o,onRoomChange:y,onUpdateStatus:m})]}),e.jsx("section",{id:"section-right",children:x.length>0&&e.jsx(he,{profile:r,token:o,room:x[b]})})]}),e.jsx(be,{})]}):e.jsx("div",{children:"Loading skeleton ..."})})};export{ye as default,Z as getProfile};
