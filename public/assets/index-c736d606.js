import{r as g,j as e,u as K,a as ee,c as te,g as ne}from"./index-a1bae923.js";import{g as J}from"./getSocket-3ac81373.js";const se=({participants:i,userId:r})=>{if(i=i.filter(h=>h._id!==r),i.length==0)return null;const l=i.length>1,b=i.slice(0,4);return e.jsx("div",{className:"card",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"group-pictures-container",children:b.map((h,f)=>e.jsx("div",{className:"profile",children:e.jsx("img",{src:h.avatar,alt:"Profile",className:"group-profile-picture"})},f))}),e.jsxs("div",{className:"profile-names",children:[b.length>0&&e.jsx("h3",{children:b.map(h=>h.fullname).join(", ")}),i.length>4&&e.jsxs("p",{className:"group-members-count",children:["+",i.length-4," more"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:i[0].avatar,alt:"Profile",className:"profile-picture"}),e.jsxs("h3",{children:[i[0].fullname+"  ",e.jsx("span",{className:i[0].isOnline?"online":"offline",children:"â€¢"})]}),i[0].bio&&e.jsx("p",{children:i[0].bio})]})})},Q=g.memo(se);const H=i=>new Promise((r,l)=>{fetch("/api/v1/rooms",{method:"GET",headers:{"content-type":"application/json",authorization:"Bearer "+i}}).then(b=>{if(b.ok)return b.json().then(h=>{r(h)});throw b.status==401&&(alert("Token expired"),sessionStorage.removeItem("token")),new Error("Failed to fetch rooms information")}).catch(b=>{l(b)})}),re=({userId:i,currentRoomIndex:r,token:l,onRoomChange:b,onUpdateStatus:h})=>{const[f,o]=g.useState([]),t=g.useRef(""),n=g.useRef(null),y=K(),d=w=>{const _=w;"onl"+_!=t.current&&(t.current="onl"+_,o(L=>L&&L.map(p=>{const v=p.participants.map(C=>C._id===_?{...C,isOnline:!0}:C);return{...p,participants:v}})))},x=w=>{const _=w;"off"+_!=t.current&&(t.current="off"+_,o(L=>L&&L.map(p=>{const v=p.participants.map(C=>C._id===_?{...C,isOnline:!1}:C);return{...p,participants:v}})))},m=()=>{H(l).then(w=>{o(w)}).catch(()=>{y("/auth")})},U=w=>{var L,p;const _=document.querySelectorAll(".chat-room");_==null||_.forEach(v=>{var C;(C=v.classList)==null||C.remove("active")}),(p=(L=_[w])==null?void 0:L.classList)==null||p.add("active"),b(w)};g.useEffect(()=>{f.length>0&&h(f)},[f]),g.useEffect(()=>(l&&H(l).then(w=>{o(w);const _=J(l);_.on("onl",d),_.on("off",x),_.on("room",m),n.current=_}).catch(()=>{y("/auth")}),()=>{var w;(w=n.current)==null||w.disconnect()}),[l]);const z=g.useMemo(()=>f.map((w,_)=>e.jsx("div",{className:`chat-room ${_==r?"active":""}`,onClick:()=>U(_),children:e.jsx(Q,{userId:i,participants:w.participants})},w._id)),[f]);return e.jsx("div",{id:"rooms-list",children:f&&f.length>0?e.jsx("div",{children:z}):e.jsx("p",{children:"No rooms to display"})})};const ie={light:{text:"#000",background:"#d5e356",theme:"#ffffff"},dark:{text:"#ffffff",background:"#000",theme:"#240063"}},oe=()=>{const[i,r]=g.useState(sessionStorage.getItem("theme")||"light");return g.useEffect(()=>{const l=ie[i];Object.entries(l).forEach(([b,h])=>{document.documentElement.style.setProperty(`--${b}-color`,h)}),sessionStorage.setItem("theme",i)},[i]),[i,r]},ae=()=>{const[i,r]=oe(),l=i==="light",b=()=>{r(l?"dark":"light")};return e.jsxs("div",{className:"theme-switch-container",children:[e.jsx("input",{type:"checkbox",id:"switcher-input",checked:l,onChange:b}),e.jsxs("label",{className:`switcher-label ${l?"":"active"}`,htmlFor:"switcher-input",children:[e.jsx("i",{className:"fas fa-solid fa-sun"}),e.jsx("span",{className:"switcher-toggler"}),e.jsx("i",{className:"fas fa-solid fa-moon"})]})]})};var Z={exports:{}};(function(i,r){(function(b,h){i.exports=h(g,ee)})(te,function(l,b){return function(h){var f={};function o(t){if(f[t])return f[t].exports;var n=f[t]={i:t,l:!1,exports:{}};return h[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=h,o.c=f,o.d=function(t,n,y){o.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:y})},o.r=function(t){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,n){if(n&1&&(t=o(t)),n&8||n&4&&typeof t=="object"&&t&&t.__esModule)return t;var y=Object.create(null);if(o.r(y),Object.defineProperty(y,"default",{enumerable:!0,value:t}),n&2&&typeof t!="string")for(var d in t)o.d(y,d,(function(x){return t[x]}).bind(null,d));return y},o.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(n,"a",n),n},o.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},o.p="",o(o.s=4)}([function(h,f,o){h.exports=o(5)()},function(h,f){h.exports=l},function(h,f){h.exports=b},function(h,f){h.exports=function(o,t,n){var y=o.direction,d=o.value;switch(y){case"top":return n.top+d<t.top&&n.bottom>t.bottom&&n.left<t.left&&n.right>t.right;case"left":return n.left+d<t.left&&n.bottom>t.bottom&&n.top<t.top&&n.right>t.right;case"bottom":return n.bottom-d>t.bottom&&n.left<t.left&&n.right>t.right&&n.top<t.top;case"right":return n.right-d>t.right&&n.left<t.left&&n.top<t.top&&n.bottom>t.bottom}}},function(h,f,o){o.r(f),o.d(f,"default",function(){return S});var t=o(1),n=o.n(t),y=o(2),d=o.n(y),x=o(0),m=o.n(x),U=o(3),z=o.n(U);function w(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?w=function(j){return typeof j}:w=function(j){return j&&typeof Symbol=="function"&&j.constructor===Symbol&&j!==Symbol.prototype?"symbol":typeof j},w(a)}function _(a,u){if(!(a instanceof u))throw new TypeError("Cannot call a class as a function")}function L(a,u){for(var j=0;j<u.length;j++){var s=u[j];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(a,s.key,s)}}function p(a,u,j){return u&&L(a.prototype,u),j&&L(a,j),a}function v(a,u){return u&&(w(u)==="object"||typeof u=="function")?u:N(a)}function C(a){return C=Object.setPrototypeOf?Object.getPrototypeOf:function(j){return j.__proto__||Object.getPrototypeOf(j)},C(a)}function N(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function k(a,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(u&&u.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),u&&I(a,u)}function I(a,u){return I=Object.setPrototypeOf||function(s,M){return s.__proto__=M,s},I(a,u)}function c(a,u,j){return u in a?Object.defineProperty(a,u,{value:j,enumerable:!0,configurable:!0,writable:!0}):a[u]=j,a}function E(a){return a.width===void 0&&(a.width=a.right-a.left),a.height===void 0&&(a.height=a.bottom-a.top),a}var S=function(a){k(u,a);function u(j){var s;return _(this,u),s=v(this,C(u).call(this,j)),c(N(s),"getContainer",function(){return s.props.containment||window}),c(N(s),"addEventListener",function(M,T,O,W){s.debounceCheck||(s.debounceCheck={});var P,$,B=function(){P=null,s.check()};W>-1?$=function(){P||(P=setTimeout(B,W||0))}:$=function(){clearTimeout(P),P=setTimeout(B,O||0)};var A={target:M,fn:$,getLastTimeout:function(){return P}};M.addEventListener(T,A.fn),s.debounceCheck[T]=A}),c(N(s),"startWatching",function(){s.debounceCheck||s.interval||(s.props.intervalCheck&&(s.interval=setInterval(s.check,s.props.intervalDelay)),s.props.scrollCheck&&s.addEventListener(s.getContainer(),"scroll",s.props.scrollDelay,s.props.scrollThrottle),s.props.resizeCheck&&s.addEventListener(window,"resize",s.props.resizeDelay,s.props.resizeThrottle),!s.props.delayedCall&&s.check())}),c(N(s),"stopWatching",function(){if(s.debounceCheck){for(var M in s.debounceCheck)if(s.debounceCheck.hasOwnProperty(M)){var T=s.debounceCheck[M];clearTimeout(T.getLastTimeout()),T.target.removeEventListener(M,T.fn),s.debounceCheck[M]=null}}s.debounceCheck=null,s.interval&&(s.interval=clearInterval(s.interval))}),c(N(s),"check",function(){var M=s.node,T,O;if(!M)return s.state;if(T=E(s.roundRectDown(M.getBoundingClientRect())),s.props.containment){var W=s.props.containment.getBoundingClientRect();O={top:W.top,left:W.left,bottom:W.bottom,right:W.right}}else O={top:0,left:0,bottom:window.innerHeight||document.documentElement.clientHeight,right:window.innerWidth||document.documentElement.clientWidth};var P=s.props.offset||{},$=w(P)==="object";$&&(O.top+=P.top||0,O.left+=P.left||0,O.bottom-=P.bottom||0,O.right-=P.right||0);var B={top:T.top>=O.top,left:T.left>=O.left,bottom:T.bottom<=O.bottom,right:T.right<=O.right},A=T.height>0&&T.width>0,V=A&&B.top&&B.left&&B.bottom&&B.right;if(A&&s.props.partialVisibility){var G=T.top<=O.bottom&&T.bottom>=O.top&&T.left<=O.right&&T.right>=O.left;typeof s.props.partialVisibility=="string"&&(G=B[s.props.partialVisibility]),V=s.props.minTopValue?G&&T.top<=O.bottom-s.props.minTopValue:G}typeof P.direction=="string"&&typeof P.value=="number"&&(console.warn("[notice] offset.direction and offset.value have been deprecated. They still work for now, but will be removed in next major version. Please upgrade to the new syntax: { %s: %d }",P.direction,P.value),V=z()(P,T,O));var D=s.state;return s.state.isVisible!==V&&(D={isVisible:V,visibilityRect:B},s.setState(D),s.props.onChange&&s.props.onChange(V)),D}),s.state={isVisible:null,visibilityRect:{}},s}return p(u,[{key:"componentDidMount",value:function(){this.node=d.a.findDOMNode(this),this.props.active&&this.startWatching()}},{key:"componentWillUnmount",value:function(){this.stopWatching()}},{key:"componentDidUpdate",value:function(s){this.node=d.a.findDOMNode(this),this.props.active&&!s.active?(this.setState({isVisible:null,visibilityRect:{}}),this.startWatching()):this.props.active||this.stopWatching()}},{key:"roundRectDown",value:function(s){return{top:Math.floor(s.top),left:Math.floor(s.left),bottom:Math.floor(s.bottom),right:Math.floor(s.right)}}},{key:"render",value:function(){return this.props.children instanceof Function?this.props.children({isVisible:this.state.isVisible,visibilityRect:this.state.visibilityRect}):n.a.Children.only(this.props.children)}}]),u}(n.a.Component);c(S,"defaultProps",{active:!0,partialVisibility:!1,minTopValue:0,scrollCheck:!1,scrollDelay:250,scrollThrottle:-1,resizeCheck:!1,resizeDelay:250,resizeThrottle:-1,intervalCheck:!0,intervalDelay:100,delayedCall:!1,offset:{},containment:null,children:n.a.createElement("span",null)}),c(S,"propTypes",{onChange:m.a.func,active:m.a.bool,partialVisibility:m.a.oneOfType([m.a.bool,m.a.oneOf(["top","right","bottom","left"])]),delayedCall:m.a.bool,offset:m.a.oneOfType([m.a.shape({top:m.a.number,left:m.a.number,bottom:m.a.number,right:m.a.number}),m.a.shape({direction:m.a.oneOf(["top","right","bottom","left"]),value:m.a.number})]),scrollCheck:m.a.bool,scrollDelay:m.a.number,scrollThrottle:m.a.number,resizeCheck:m.a.bool,resizeDelay:m.a.number,resizeThrottle:m.a.number,intervalCheck:m.a.bool,intervalDelay:m.a.number,containment:typeof window<"u"?m.a.instanceOf(window.Element):m.a.any,children:m.a.oneOfType([m.a.element,m.a.func]),minTopValue:m.a.number})},function(h,f,o){var t=o(6);function n(){}function y(){}y.resetWarningCache=n,h.exports=function(){function d(U,z,w,_,L,p){if(p!==t){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}d.isRequired=d;function x(){return d}var m={array:d,bool:d,func:d,number:d,object:d,string:d,symbol:d,any:d,arrayOf:x,element:d,elementType:d,instanceOf:x,node:d,objectOf:x,oneOf:x,oneOfType:x,shape:x,exact:x,checkPropTypes:y,resetWarningCache:n};return m.PropTypes=m,m}},function(h,f,o){var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";h.exports=t}])})})(Z);var le=Z.exports;const Y=ne(le),X=(i,r,l,b)=>fetch(`/api/v1/rooms/${i}?limit=${l}&skip=${b}`,{method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer "+r}}).then(h=>{if(h.ok)return h.json();throw h.status==401&&(alert("Token expired"),sessionStorage.removeItem("token")),new Error("Failed to fetch messages")});let F,R;const ce=({room:i,token:r,profile:l})=>{const[b,h]=g.useState(""),[f,o]=g.useState(null),[t,n]=g.useState(),y=g.useRef(i._id),d=g.useRef(null),x=g.useRef(null),m=g.useRef(null),U=K();let z;const w=c=>{h(c.target.value),console.log("typing ...")},_=()=>{b.trim()!==""&&(R==null||R.emit("msg",[i._id,b,new Date]),h(""))},L=c=>{if(c[1]===y.current){const E=c[0];if(E!==(l==null?void 0:l._id)&&!i.participants.some(u=>u._id===E))return;const S=c[2],a=c[3];F++,o(u=>u!==null?[...u,{sender:E,content:S,timestamp:a}]:[{sender:E,content:S,timestamp:a}])}else console.log("New message, room: "+c[1])},p=()=>{R==null||R.emit("meet",[i._id,new Date])},v=c=>{const E=`/meet/${c}?token=${r}&room=${i._id}`;window.open(E)},C=c=>{if(c[1]==i._id&&n(c[2]),c[0]==(l==null?void 0:l._id))return c[3]?void 0:v(c[2]);Notification.permission==="granted"?new Notification("Incoming Call",{body:"You have an incoming call. Do you want to join?",icon:"path/to/notification-icon.png",requireInteraction:!0}).addEventListener("click",()=>{v(c[2])}):Notification.permission!=="denied"&&Notification.requestPermission().then(E=>{E==="granted"&&C(c)})},N=()=>{n(null)};g.useEffect(()=>{try{if(!r||!i)return;X(i._id,r).then(c=>{o(c.messages),c.conversationLength&&(F=c.conversationLength),c.meeting_uuid?n(c.meeting_uuid):n(null)}).catch(()=>{U("/auth")})}catch(c){console.error(c)}},[r,i._id]),g.useEffect(()=>{r&&(R=J(r),R==null||R.on("msg",L),R==null||R.on("meet",C),R==null||R.on("end_meet",N))},[r]),g.useEffect(()=>{y.current=i._id,d.current&&(d.current.style.display="none");const c=setTimeout(()=>{d.current&&m.current&&m.current.scrollHeight>m.current.clientHeight&&(d.current.style.display="block")},1e3);return()=>{clearTimeout(c)}},[i._id]),g.useEffect(()=>{x.current&&m.current&&(z?x.current.scrollIntoView({behavior:"smooth"}):m.current.scrollTop=300)},[f]);const k=g.useMemo(()=>e.jsx(e.Fragment,{children:Array.isArray(f)&&f.map((c,E)=>{let S;if(c.sender&&c.sender==(l==null?void 0:l._id))S=l.avatar;else{const a=i.participants.find(u=>u._id===c.sender);S=a?a.avatar:""}return e.jsxs("div",{className:`message ${c.sender==(l==null?void 0:l._id)?"own":""}`,children:[e.jsxs("div",{className:"message_wrapper",children:[c.sender!=(l==null?void 0:l._id)&&S&&e.jsx("img",{className:"inchat-avatar",src:S,alt:"Sender Avatar"}),e.jsx("p",{children:c.content})]}),e.jsx("p",{className:"message_timestamp",children:c.timestamp})]},E)})}),[f]),I=c=>{if(!c||!f||f.length==0)return;if(f.length>=F){console.log("All messages have been received");return}let E,S=20;E=F-f.length-S,E<0&&(S+=E,E=0),X(i._id,r,`${S}`,`${E}`).then(a=>{o(u=>u?a.messages.concat(u):a.messages),a.conversationLength&&(F=a.conversationLength),a.meeting_uuid?n(a.meeting_uuid):n(null)}).catch(()=>{U("/auth")})};return e.jsxs("div",{id:"chat-box",children:[e.jsxs("div",{id:"chat-box_topbar",className:"flex",children:[e.jsxs("div",{id:"chat-box_topbar_left",children:[e.jsx(Q,{userId:l==null?void 0:l._id,participants:i.participants}),e.jsx("button",{className:"btn",onClick:p,children:e.jsx("i",{className:"bx bxs-video"})})]}),e.jsx(ae,{})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"This room is in a meeting"}),e.jsx("button",{onClick:()=>v(t),children:"Join"})]}),e.jsxs("div",{ref:m,id:"messages-container",children:[e.jsx(Y,{onChange:I,children:e.jsx("h1",{ref:d,id:"topRef",children:"top"})}),k,e.jsx(Y,{onChange:c=>{z=c},children:e.jsx("div",{ref:x})})]}),e.jsx("img",{id:"chat-box_bg",src:"/assets/img/img_new/pattern.png"}),e.jsxs("div",{id:"chat-box_input-container",children:[e.jsx("input",{type:"text",value:b,id:"input_message",onChange:w,onKeyDown:c=>{c.key=="Enter"&&_()}}),e.jsx("button",{onClick:_,className:"btn",children:e.jsx("i",{className:"bx bxs-send"})})]})]})};const ue=({token:i,profileData:r,onRefresh:l})=>{const[b,h]=g.useState(!1),[f,o]=g.useState(!1),t=g.useRef(null),n=g.useRef(null),y=g.useRef(null),d=g.useRef(null),x=K();g.useEffect(()=>{if(i){const p=J(i);p.on("inv",l),y.current=p}return()=>{var p;(p=y.current)==null||p.disconnect()}},[i]),g.useEffect(()=>{d.current&&(f?d.current.classList.add("active"):d.current.classList.remove("active"))},[f]);const m=()=>{sessionStorage.removeItem("token"),x("/auth")},U=p=>{fetch(`/api/v1/rooms/${p}`,{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({accept:!0})})},z=p=>{fetch(`/api/v1/rooms/${p}`,{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({accept:!1})})},w=async p=>{p.preventDefault();let v={};if(p.target.bio.value&&(v.bio=p.target.bio.value),p.target.fullname.value&&(v.fullname=p.target.fullname.value),p.target.password.value)if(v.password=p.target.password.value,p.target.current_password.value)v.current_password=p.target.current_password.value;else return alert("Please enter current password");if(n.current&&(v.avatar=n.current),!v.bio&&!v.fullname&&!v.password&&!v.avatar)return alert("Empty form");const C=await fetch("/api/v1/users/",{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify(v)});if(o(!1),C.ok)return alert("Updated successfully!"),l();const N=await C.json();if(N.message)return alert(N.message);alert("Error updating profile")},_=async()=>{if(window.confirm("Are you sure you want to delete your account?")){const v=window.prompt("Enter your password:");if(v!==null)try{const C={password:v},N=await fetch("/api/v1/users/",{method:"DELETE",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify(C)});if(N.ok)sessionStorage.removeItem("token"),alert("You deleted your account successfully"),x("/auth");else{const k=await N.json();k.message?alert(k.message):alert("Wrong password!")}}catch(C){console.error("Error deleting account:",C)}}},L=()=>{if(t!=null&&t.current&&t.current.length>0){const p=t.current.files[0],v=new FileReader;v.onload=async C=>{var N;if((N=C.target)!=null&&N.result){const k=new Image;k.onload=async()=>{const I=document.createElement("canvas"),c=200,E=200;let S=k.width,a=k.height;S>c&&(a*=c/S,S=c),a>E&&(S*=E/a,a=E),I.width=S,I.height=a;const u=I.getContext("2d");u==null||u.drawImage(k,0,0,S,a);const j=I.toDataURL("image/jpeg");n.current=j},k.src=C.target.result}},v.readAsDataURL(p)}};return e.jsxs("div",{id:"profile",children:[e.jsxs("div",{id:"profile_topbar",children:[e.jsx("img",{src:r==null?void 0:r.avatar,alt:"Profile",id:"profile_img",className:"cover"}),f?e.jsxs("label",{id:"btn_upload-img",htmlFor:"upload-img",children:[e.jsx("i",{className:"bx bxs-camera"}),e.jsx("input",{id:"upload-img",type:"file",accept:"image/*",ref:t,onChange:L})]}):e.jsxs("div",{children:[e.jsx("h3",{children:r==null?void 0:r.fullname}),(r==null?void 0:r.bio)&&e.jsx("p",{children:r==null?void 0:r.bio})]}),e.jsxs("div",{className:"flex",children:[f?e.jsx("button",{className:"btn",onClick:()=>o(!1),children:e.jsx("i",{className:"bx bxs-message-square-x"})}):e.jsx("button",{className:"btn",onClick:()=>o(!0),children:e.jsx("i",{className:"bx bxs-pencil"})}),e.jsx("button",{className:"btn",onClick:()=>h(p=>!p),children:b?e.jsx("i",{className:"bx bxs-message-square-x"}):e.jsxs("div",{id:"bell",children:[e.jsx("i",{className:"bx bxs-bell"}),r!=null&&r.invitations.length&&(r==null?void 0:r.invitations.length)>0?e.jsx("span",{id:"nofcount",children:r==null?void 0:r.invitations.length}):null]})}),b&&e.jsx("div",{id:"notify-container",children:r&&r.invitations.length>0?r.invitations.map(p=>e.jsxs("div",{children:[e.jsx("p",{children:p}),e.jsx("button",{onClick:()=>U(p),children:"Accept"}),e.jsx("button",{onClick:()=>z(p),children:"Refuse"})]},p)):e.jsx("p",{children:"No invitations"})}),e.jsx("button",{id:"logout-btn",className:"btn",onClick:m,children:e.jsx("i",{className:"bx bx-log-in"})})]})]}),e.jsxs("div",{ref:d,id:"profile_editor",children:[e.jsxs("form",{id:"profile_form",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fullname",children:"Your name:"}),e.jsx("input",{type:"text",id:"fullname",name:"fullname",placeholder:r==null?void 0:r.fullname})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bio",children:"Bio:"}),e.jsx("input",{type:"text",id:"bio",name:"bio",placeholder:r==null?void 0:r.bio})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"current_password",children:"Current password:"}),e.jsx("input",{type:"password",id:"current_password",name:"current_password"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",children:"New password:"}),e.jsx("input",{type:"password",id:"password",name:"password"})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{id:"btn_delete-account",onClick:_,children:"Delete account"}),e.jsx("button",{id:"btn_submit-edit",onClick:w,children:"Save"})]})]})]})},de=g.memo(ue);const he=({token:i,onChoose:r})=>{const l=g.useRef(null),[b,h]=g.useState([]),f=()=>{var y;const n=(y=l.current)==null?void 0:y.value;n&&fetch(`/api/v1/search/${n}`,{headers:{"content-type":"application/json",authorization:"Bearer "+i}}).then(d=>{if(d.ok)return d.json().then(x=>{h(x)});console.log(d.status)})},o=n=>{n.key==="Enter"&&f()},t=n=>{l.current&&!l.current.contains(n.target)&&(h([]),l.current.value="")};return g.useEffect(()=>(document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}),[]),e.jsxs("div",{id:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search for users...",ref:l,onKeyPress:o}),e.jsx("button",{className:"btn",onClick:f,children:e.jsx("i",{className:"bx bx-search"})}),b.length>0&&e.jsx("div",{id:"search_dropdown",children:b.map(n=>e.jsxs("div",{onClick:()=>{r({_id:n._id,fullname:n.fullname})},children:[e.jsx("img",{className:"profile-picture",src:n.avatar,alt:"Avatar"}),n.fullname]},n._id))})]})};const fe=({token:i})=>{const[r,l]=g.useState([]),b=o=>{if(r.some(t=>t._id==o._id))return alert("already selected this user");l(t=>[...t,o])},h=o=>{console.log("remove user from users list"),o>=0&&o<r.length&&l(t=>t.filter((y,d)=>d!==o))},f=async()=>{if(r.length==0)return alert("Please select a user");const o=r.map(t=>t._id);try{(await fetch("/api/v1/rooms",{method:"POST",headers:{"content-type":"application/json",authorization:"Bearer "+i},body:JSON.stringify({invited:o})})).ok?l([]):alert("deo biet sao bug luon")}catch(t){console.error(t)}};return e.jsxs("div",{id:"room-maker",children:[e.jsx(he,{token:i,onChoose:b}),r.length>0&&e.jsxs("div",{className:"flex",children:[e.jsx("div",{id:"chosenList",className:"flex",children:r.map((o,t)=>e.jsxs("div",{className:"chosenUser flex",children:[e.jsxs("p",{children:[" ",o.fullname]}),e.jsx("span",{onClick:()=>h(t),children:"X"})]},o.fullname))}),e.jsx("button",{className:"btn",onClick:f,children:e.jsx("i",{className:"bx bxs-message-square-add"})})]})]})};function me(){return e.jsxs("svg",{id:"bgrn-svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 700 700",preserveAspectRatio:"none",children:[e.jsxs("g",{mask:'url("#SvgjsMask1020")',fill:"none",children:[e.jsx("rect",{width:"700",height:"700",x:"0",y:"0",fill:'url("#SvgjsLinearGradient1021")'}),e.jsx("path",{d:"M700 0L426.65 0L700 81.54z",fill:"rgba(255, 255, 255, 0.2)"}),e.jsx("path",{d:"M426.65 0L700 81.54L700 267.52L414.62 0z",fill:"rgba(255, 255, 255, .13)"}),e.jsx("path",{d:"M414.62 0L700 267.52L700 452.46L156.39 0z",fill:"rgba(255, 255, 255, .1)"}),e.jsx("path",{d:"M156.39 0L700 452.46L700 490.96L83.34999999999998 0z",fill:"rgba(255, 255, 255, .1)"}),e.jsx("path",{d:"M0 700L154.99 700L0 376.93z",fill:"rgba(0, 0, 0, .1)"}),e.jsx("path",{d:"M0 376.93L154.99 700L303.17 700L0 371.8z",fill:"rgba(0, 0, 0, .175)"}),e.jsx("path",{d:"M0 371.8L303.17 700L525.89 700L0 229.98000000000002z",fill:"rgba(0, 0, 0, .25)"}),e.jsx("path",{d:"M0 229.98000000000002L525.89 700L592.96 700L0 184.46z",fill:"rgba(0, 0, 0, .325)"})]}),e.jsxs("defs",{children:[e.jsx("mask",{id:"SvgjsMask1020",children:e.jsx("rect",{width:"700",height:"700",fill:"#ffffff"})}),e.jsxs("linearGradient",{x1:"0%",y1:"0%",x2:"100%",y2:"100%",gradientUnits:"userSpaceOnUse",id:"SvgjsLinearGradient1021",children:[e.jsx("stop",{id:"stop_1",offset:"0"}),e.jsx("stop",{id:"stop_2",offset:"1"})]})]})]})}const q=i=>fetch("/api/v1/users/",{method:"GET",headers:{"content-type":"application/json",Authorization:"Bearer "+i}}).then(r=>{if(r.ok)return r.json();throw r.status==401&&(alert("Token expired"),sessionStorage.removeItem("token"),window.location.reload()),new Error("Failed to fetch user profile")}),be=({token:i})=>{const[r,l]=g.useState(null),[b,h]=g.useState([]),[f,o]=g.useState(0),t=K(),n=async()=>{try{const x=await q(i);l(x)}catch{t("/auth")}},y=x=>{o(x)},d=x=>{h(x)};return g.useEffect(()=>{i&&q(i).then(x=>{l(x)}).catch(x=>{console.error(x),t("/auth")})},[i]),e.jsx("div",{id:"main-page",className:"flex",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"main-page_container",children:[e.jsxs("section",{id:"section-left",children:[e.jsx(de,{token:i,profileData:r,onRefresh:n}),e.jsx(fe,{token:i}),e.jsx(re,{userId:r._id,currentRoomIndex:f,token:i,onRoomChange:y,onUpdateStatus:d})]}),e.jsx("section",{id:"section-right",children:b.length>0&&e.jsx(ce,{profile:r,token:i,room:b[f]})})]}),e.jsx(me,{})]}):e.jsx("div",{children:"Loading skeleton ..."})})};export{be as default,q as getProfile};
